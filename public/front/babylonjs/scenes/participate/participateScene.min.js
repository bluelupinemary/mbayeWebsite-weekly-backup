var earthScene,initCamera,exploreCamera,initLight,initLight2,earthNormalTask,earthBordersTask,earthNamesTask;let earthDivisionTask;var earthNormal_object,earthBorders_object,earthNames_object,mbayeInit_object;let earthDivision_object;var isBorderOn,isCountryOn,isEarthModelLoaded,home_btn,showBorders_btn,showBorders2_btn,showNames_btn,showNames2_btn,exploreEarth_btn,moveEarth_btn,rotateEarth_btn,resetEarth_btn,designPanel_btn,showLabels_btn,isExploreBtnActive,isEarthExplored,isMoveEarthBtnActive,exploreBtnCounter,currExploreCameraRotZ,currExploreCameraRotX,currExploreCameraRotY,currExploreCameraPosX,currExploreCameraPosY,currExploreCameraPosZ,initSkybox,sun,earthMercury,earthVenus,earthMars,earthJupiter,earthSaturn,earthNeptune,earthPluto,earthMoon,earthNorthAmerica,earthSouthAmerica,mbayeEarthFeet_object,currentEarthGizmoScale,earthCamTargetY,dolphinEarth_object,starfishEarth_object,crabEarth_object,isEarthSeaObjectLoaded,currentDraggableMesh,initinitCameraState={alpha:0,beta:0},initinitCameraPos={x:-1135,y:486,z:995},initEarthMbayeRot={x:0,y:0,z:0},initEarthMbayePos={x:0,y:0,z:0},isEarthClicked=!1,isMbayeDragged=!1;let isFirstClickOfMbaye=!1,isStartZoomInMbaye=!1,mbayeLastPos={x:0,y:0,z:0},mbayeLastRot={x:0,y:0,z:0,w:0},mbayeLastRot2={x:0,y:0,z:0},isOnOverPlanetOrbitActive=!0,isEarthSceneActive=!1;var planetAxis=new BABYLON.Vector3(0,4,0),redAngle=.01,yellowAngle=.02,grayAngle=-.005;const UPPER_RADIUS_VAL=1700,BTN_LBL_FONTSIZE="10vw";var mbaye_eyes_material,starsLight,mbaye_object_with_panels=null,isLabelShown=!1;let orbit;var leoStars,ariesStars,taurusStars,piscesStars,scorpioStars,sagittariusStars,virgoStars,libraStars,geminiStars,capricornStars,aquariusStars,cancerStars,earthNames_object2,earthSea_obj,water,mbayeEarthTask,mbayeGizmoManager,isMbayeGizmoDragging,isMbayeFromDesignScene=!1,planetsOrbitArr=[];function createEarthScene(){return engine.enableOfflineSupport=!0,startAstronautScene=createAstronautScene(),earthScene=new BABYLON.Scene(engine),initCamera=create_camera(earthScene),initLight=create_light(earthScene),initSkybox=create_skybox(earthScene),create_solar_orbit(earthScene),load_meshes(),add_hdr_environment(earthScene),create_planets(earthScene),create_planet_orbit(earthScene),create_constellation_planes(earthScene),addMouseListener(),enable_init_webcamera(earthScene),create_planet_labels(),earthScene.autoClear=!1,earthScene}function load_meshes(){Promise.all([BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/participateScene/earth/","earth122319.babylon",earthScene,function(e){var t=0;if(e.lengthComputable)t=(100*e.loaded/e.total).toFixed();else{var a=e.loaded/1048576;t=Math.floor(100*a)/100}document.getElementById("loadingScreenPercent").innerHTML="Loading: "+t+" %"}).then(function(e){earthNormalMesh=e.meshes,e.meshes[9].scaling=new BABYLON.Vector3(.6,.6,.6);for(let t=0;t<e.meshes.length-1;t++)e.meshes[t].isPickable=!0,"Sea"===e.meshes[t].name&&((water=new BABYLON.WaterMaterial("water",earthScene,new BABYLON.Vector2(2048,2048))).backFaceCulling=!0,water.bumpTexture=new BABYLON.Texture("front/textures/participate/waterbump.png",earthScene),water.windForce=10,water.windDirection=new BABYLON.Vector2(-1,0),water.waveHeight=.2,water.bumpHeight=.3,water.waveLength=.1,water.colorBlendFactor=.25714,water.waterColor=new BABYLON.Color3(.31428,.2,.80357),water.addToRenderList(initSkybox),e.meshes[t].material=water),e.meshes[t].actionManager=new BABYLON.ActionManager(earthScene),e.meshes[t].actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOverTrigger,onOverPlanet)),e.meshes[t].actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOutTrigger,onOutPlanet));earthNormal_object=e.meshes[9]}),BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/participateScene/earth/","border.babylon",earthScene).then(function(e){earthBordersTask=e.meshes,e.meshes[1].position=new BABYLON.Vector3(.2,6.8,-5.7),e.meshes[1].scaling=new BABYLON.Vector3(1.001,1.001,1.001),e.meshes[1].isVisible=!1,e.meshes[1].setEnabled(!1),earthBorders_object=e.meshes[1]}),BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/participateScene/earth/","names.glb",earthScene).then(function(e){earthNamesTask=e.meshes,e.meshes[0].scaling=new BABYLON.Vector3(1,1,-1),e.meshes[0].position=new BABYLON.Vector3(2,6.8,-5.85),e.meshes[0].isVisible=!1,e.meshes[0].setEnabled(!1),earthNames_object=e.meshes[0]}),BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/participateScene/mbaye/","MbayePipes.glb",earthScene).then(function(e){mbayeInitTask=e.meshes,e.meshes[0].position=new BABYLON.Vector3(-467.95,285.39,642.78),e.meshes[0].rotationQuaternion=new BABYLON.Quaternion(.1173,.9809,-.0854,-.1289),e.meshes[0].scaling=new BABYLON.Vector3(20,20,-20),(mbayeInit_object=e.meshes[0]).isPickable=!1,e.meshes.forEach(function(e){if(e.isPickable=!0,e.checkCollistio,"MbayeBody"===e.name){let t=new BABYLON.PBRMaterial("pbr",earthScene);e.material=t,e.material.backFaceCulling=!1,t.albedoColor=new BABYLON.Color3(.5,.5,.5),t.emissiveColor=new BABYLON.Color3(0,0,0),t.metallic=1,t.metallicF0Factor=.5,t.roughness=.15,t.microSurface=1}else"R_EYEAventurine_primitive1"!==e.name&&"L_EYEAventurine_primitive1"!==e.name||(e.material.albedoColor=new BABYLON.Color3(.01,.2,.07))})})]).then(()=>{earthBorders_object.parent=earthNormal_object,earthNames_object.parent=earthNormal_object,isEarthModelLoaded=!0,initCamera.target=new BABYLON.Vector3(0,0,0),initCamera.radius=1360,initCamera.attachControl(canvas,!0),isEarthSceneActive=!0,enable_mbaye_utility(),enable_earth_utility()})}function set_orbit_enability(e){for(const[t,a]of planetOrbitsObjMap.entries())a.isPickable=e}function set_constellation_enability(e){for(const[t,a]of starsObjMap.entries())a.isPickable=e}function set_solar_orbit_enability(e){solarOrbit.isVisible=e,solarOrbit.setEnabled(e)}function set_earth_gizmo_enability(){earthGizmo.attachedMesh=earthNormal_object}function enable_mbaye_utility(){(mbayeGizmoManager=new BABYLON.GizmoManager(earthScene)).attachableMeshes=[mbayeInit_object],mbayeGizmoManager.positionGizmoEnabled=!1,mbayeGizmoManager.boundingBoxGizmoEnabled=!1,mbayeGizmoManager.rotationGizmoEnabled=!1,mbayeGizmoManager.scaleGizmoEnabled=!1,document.onkeydown=(e=>{if(earthScene&&("p"==e.key||"P"==e.key||"R"==e.key||"r"==e.key||"+"==e.key||"-"==e.key)){if(mbayeGizmoManager.positionGizmoEnabled=!1,mbayeGizmoManager.rotationGizmoEnabled=!1,mbayeGizmoManager.scaleGizmoEnabled=!1,mbayeGizmoManager.boundingBoxGizmoEnabled=!1,"p"==e.key||"P"==e.key){mbayeGizmoManager.positionGizmoEnabled=!0;var t=new BABYLON.SixDofDragBehavior;mbayeInit_object&&mbayeInit_object.addBehavior(t),mbayeGizmoManager.gizmos.positionGizmo.onDragStartObservable.add(function(){isMbayeGizmoDragging=!0}),mbayeGizmoManager.gizmos.positionGizmo.onDragEndObservable.add(function(){isMbayeGizmoDragging=!1})}"r"!=e.key&&"R"!=e.key||(mbayeGizmoManager.rotationGizmoEnabled=!0,mbayeGizmoManager.gizmos.rotationGizmo.onDragStartObservable.add(function(){isMbayeGizmoDragging=!0}),mbayeGizmoManager.gizmos.rotationGizmo.onDragEndObservable.add(function(){isMbayeGizmoDragging=!1})),"+"==e.key&&mbaye_scale_up(),"-"==e.key&&mbaye_scale_down()}"o"!=e.key&&"O"!=e.key||(mbayeGizmoManager.attachToMesh(null),earthGizmo&&(earthGizmo.attachedMesh=null),isEarthWithGizmo=!1),"z"!=e.key&&"Z"!=e.key||(earthGizmo&&(earthGizmo.scaleRatio+=.05),currentEarthGizmoScale=earthGizmo.scaleRatio),"x"!=e.key&&"X"!=e.key||(earthGizmo&&(earthGizmo.scaleRatio-=.05),currentEarthGizmoScale=earthGizmo.scaleRatio)}),document.onkeydown({key:"p"})}let earthGizmo;function enable_earth_utility(){var e=new BABYLON.UtilityLayerRenderer(earthScene);e.utilityLayerScene.autoClearDepthAndStencil=!1,earthGizmo=new BABYLON.RotationGizmo(e)}var isInitViewClicked=!1;function earth_rotate_earth_with_mbaye(e){null!=mbayeInit_object.parent?(mbayeInit_object.setParent(null),set_btn_active(e)):(mbayeInit_object.setParent(earthNormal_object),set_btn_active(e))}function earth_rotate(e){isEarthRotating?(isEarthRotating=!1,set_btn_active(e)):(isEarthRotating=!0,set_btn_active(e))}function earth_initial_view(){initCamera.position=new BABYLON.Vector3(-1135,486,1e3),initCamera.radius=1360,mbayeInit_object.setParent(null),mbayeInit_object.scaling=new BABYLON.Vector3(20,20,-20),mbayeInit_object.position=new BABYLON.Vector3(-467.95,285.39,642.78),mbayeInit_object.rotationQuaternion=new BABYLON.Quaternion(.1173,.9809,-.0854,-.1289),set_solar_orbit_enability(!0),storyCareLbl.isVisible=!0}function earth_place_mbaye_on_earth(){earthScene.activeCamera==initCamera&&(null===mbayeInit_object.parent&&mbayeInit_object.setParent(earthNormal_object),earthNormal_object.rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(-120),0),earthNormal_object.position=new BABYLON.Vector3(0,0,0),mbayeInit_object.position=new BABYLON.Vector3(350,30,150),mbayeInit_object.rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(-110),0),mbayeInit_object.scaling=new BABYLON.Vector3(5,5,-5),initCamera.alpha=initinitCameraState.alpha,initCamera.beta=initinitCameraState.beta,initCamera.position=initinitCameraPos,initCamera.radius=600,initCamera.target=new BABYLON.Vector3(0,0,0),isEarthRotating=!1,solarOrbit.isVisible&&set_solar_orbit_enability(!1),storyCareLbl.isVisible=!1)}function earth_handle_gizmo(e){mbayeGizmoManager&&(0==e?(mbayeGizmoManager.attachToMesh(null),earthGizmo.attachedMesh=null):2==e?(mbayeGizmoManager.positionGizmoEnabled&&(mbayeGizmoManager.positionGizmoEnabled=!1),mbayeGizmoManager.boundingBoxGizmoEnabled&&(mbayeGizmoManager.boundingBoxGizmoEnabled=!1),mbayeGizmoManager.rotationGizmoEnabled=!0):1==e?(mbayeGizmoManager.boundingBoxGizmoEnabled&&(mbayeGizmoManager.boundingBoxGizmoEnabled=!1),mbayeGizmoManager.rotationGizmoEnabled&&(mbayeGizmoManager.rotationGizmoEnabled=!1),mbayeGizmoManager.positionGizmoEnabled=!0):3==e?(mbayeGizmoManager.positionGizmoEnabled&&(mbayeGizmoManager.positionGizmoEnabled=!1),mbayeGizmoManager.rotationGizmoEnabled&&(mbayeGizmoManager.rotationGizmoEnabled=!1),mbayeGizmoManager.boundingBoxGizmoEnabled=!0,mbaye_scale_up()):4==e&&(mbayeGizmoManager.positionGizmoEnabled&&(mbayeGizmoManager.positionGizmoEnabled=!1),mbayeGizmoManager.rotationGizmoEnabled&&(mbayeGizmoManager.rotationGizmoEnabled=!1),mbayeGizmoManager.boundingBoxGizmoEnabled=!0,mbaye_scale_down()))}function mbaye_scale_up(){let e=!1;null===mbayeInit_object.parent&&(mbayeInit_object.setParent(earthNormal_object),e=!0);var t=mbayeInit_object.scaling.x+.5,a=mbayeInit_object.scaling.y-.5,n=mbayeInit_object.scaling.z+.5;t>=30&&(t=30),(a=a<0?mbayeInit_object.scaling.y-.5:mbayeInit_object.scaling.y+.5)>=30&&(a=30),a<=-30&&(a=-30),n>=30&&(n=30),mbayeInit_object.scaling=new BABYLON.Vector3(t,a,n),mbayeGizmoManager.boundingBoxGizmoEnabled=!0,e&&mbayeInit_object.setParent(null)}function mbaye_scale_down(){let e=!1;null===mbayeInit_object.parent&&(mbayeInit_object.setParent(earthNormal_object),e=!0);var t=mbayeInit_object.scaling.x-.5,a=mbayeInit_object.scaling.y+.5,n=mbayeInit_object.scaling.z-.5;t<1&&(t=mbayeInit_object.scaling.x,a=mbayeInit_object.scaling.y,n=mbayeInit_object.scaling.z),mbayeInit_object.scaling=new BABYLON.Vector3(t,a,n),mbayeGizmoManager.boundingBoxGizmoEnabled=!0,e&&mbayeInit_object.setParent(null)}function earth_show_countries(e){isCountryOn?(earthNames_object.setEnabled(!1),isCountryOn=!1,set_btn_active(e)):(earthNames_object.setEnabled(!0),isCountryOn=!0,set_btn_active(e))}function earth_show_borders(e){isBorderOn?(earthBorders_object.setEnabled(!1),isBorderOn=!1,set_btn_active(e)):(earthBorders_object.setEnabled(!0),isBorderOn=!0,set_btn_active(e))}$("#infoIcon").on("click",function(){$("#instruction-left-div").toggle(),$("#infoIconTextdown").toggle(),$("#infoIconTextup").toggle(),$("#infoIconTextastro").toggle()});let isPlanetClicked,isPlanetOrbitVisible=!0,isEarthWithGizmo=!1;function addMouseListener(){var e=function(e){if(earthScene){var t=earthScene.pick(earthScene.pointerX,earthScene.pointerY);if(t.hit){var a=t.pickedMesh;if(console.log("the mesH: ",a.name),"MbayeBody"===a.name&&(isPlanetOrbitVisible&&(set_solar_orbit_enability(!1),isPlanetOrbitVisible=!isPlanetOrbitVisible),mbayeGizmoManager.attachToMesh(mbayeInit_object),isEarthRotating=!1),earthCountriesMap.has(a.name)&&("Sao_Tome_and_Principe"===a.name?showPage("São_Tomé_and_Príncipe"):showPage(a.name)),planetsLinkTextMap.has(a.name)){let t=planetsLinkTextMap.get(a.name);e.preventDefault(),isAstronautClicked&&astronautBtnsMap.has(a.name)||checkScreenAndDoubleClick(t)}earthPartsMap.has(a.name)&&!isMbayeGizmoDragging&&(e.preventDefault(),isAstronautClicked&&astronautBtnsMap.has(a.name)||checkScreenAndDoubleClick(userStoryCare))}}},t=function(){isEarthClicked=!1},a=function(e){if(isEarthClicked&&"MBAYE"==currentDraggableMesh)earthScene.pick(earthScene.pointerX,earthScene.pointerY)};canvas.addEventListener("pointerdown",e,!1),canvas.addEventListener("pointerup",t,!1),canvas.addEventListener("pointermove",a,!1),earthScene.onDispose=function(){canvas.removeEventListener("pointerdown",e),canvas.removeEventListener("pointerup",t),canvas.removeEventListener("pointermove",a)}}function checkScreenAndDoubleClick(e){let t=e[0],a=e[1];isMobile()?isPlanetClicked?(isPlanetClicked=!1,window.location.href=a):(isPlanetClicked=!0,setTimeout(function(){isPlanetClicked&&(isPlanetClicked=!1,Swal.fire({width:"10vw",padding:"3em",title:"Double Tap to enter the planet.",showConfirmButton:!1,position:"top-end",showClass:{backdrop:"swal2-backdrop-hide"},timer:2e3,width:100,customClass:{popup:"trevor-popup-class"}}))},500)):show_alert_box(t,a)}var isEarthRotating=!0;function set_earth_animation(e){isEarthRotating=e}function show_alert_box(e,t){Swal.fire({title:"Are you sure you want to view the "+e+" page? ",imageUrl:"../../front/icons/alert-icon.png",imageWidth:"10vw",imageHeight:"auto",imageAlt:"Warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",allowOutsideClick:!1,confirmButtonText:"Yes, I'm sure!",width:"20%",padding:"1rem",background:"rgba(8, 64, 147, 0.62)"}).then(e=>{e.value&&(window.location.href=t)})}let storyCareLbl;function create_planet_labels(){for(const[e,t]of planet_labels_map.entries()){let a=init_planet_label(e,"front/images3D/participateScene/planetTexts/"+e+".png",t[0],t[1],t[2],t[3]);"storyCare"==e&&(storyCareLbl=a)}}function init_planet_label(e,t,a,n,i,o){var r=BABYLON.MeshBuilder.CreatePlane(e,{height:n,width:a},earthScene);r.position=new BABYLON.Vector3(i.x,i.y,i.z),r.rotationQuaternion=new BABYLON.Quaternion(o.x,o.y,o.z,o.w);let s=new BABYLON.StandardMaterial(e+"Matl",earthScene);return s.diffuseTexture=new BABYLON.Texture(t,earthScene),s.opacityTexture=new BABYLON.Texture(t,earthScene),s.hasAlpha=!0,r.isPickable=!1,r.material=s,r}let isAstroToolsActive=!1;$("#astronautToolIcon").on("click",function(){isAstroToolsActive?($(".astronaut-rotate-controls").hide(),$(".astronaut-scale-controls").hide(),show_astro_backpack(!1)):($(".astronaut-rotate-controls").css("display","flex"),$(".astronaut-scale-controls").show(),show_astro_backpack(!0)),isAstroToolsActive=!isAstroToolsActive}),$(".astro-rotate-left").on("click",function(){astronaut_obj.rotation.y+=BABYLON.Tools.ToRadians(10)}),$(".astro-rotate-right").on("click",function(){astronaut_obj.rotation.y+=BABYLON.Tools.ToRadians(-10)}),$(".astro-scale-up").on("click",function(){set_astronaut_scaling("up")}),$(".astro-scale-down").on("click",function(){set_astronaut_scaling("down")}),$(".astro-reset").on("click",function(){reset_astro()});var engine=new BABYLON.Engine(canvas,!0,{preserveDrawingBuffer:!0,stencil:!0},!0);let img_path,user_gender,userStoryCare,isImgPathSet=!1,isSceneLoaded=!1;$(window).on("load",function(){isImgPathSet=!0,img_path=document.getElementById("userPhoto").src,isSceneLoaded=!0});var theScene=createEarthScene();let yt_player;theScene.executeWhenReady(function(){document.getElementById("loadingScreenPercent").style.visibility="hidden",document.getElementById("loadingScreenPercent").innerHTML="Loading: 0 %",document.getElementById("loadingScreenDiv").remove(),userStoryCare=["Story of Care","viewStoryCare?id="+userId];var e=new BABYLON.SceneOptimizerOptions;e.addOptimization(new BABYLON.HardwareScalingOptimization(0,1.5));new BABYLON.SceneOptimizer(theScene,e);(isSmallDevice()||isMobile())&&(sun&&(sun.material.diffuseTexture=initVideo),$(".sliding-images-controls").show(),set_touch_icons()),engine.runRenderLoop(function(){theScene&&(theScene.render(),isEarthSceneActive&&startAstronautScene.render(),isEarthRotating&&earthNormal_object&&(earthNormal_object.rotation.y=Math.PI/2,earthNormal_object.rotate(planetAxis,grayAngle,BABYLON.Space.LOCAL))),isImgPathSet&&theAstroFace&&(isImgPathSet=!1,create_face_texture(img_path))})}),window.addEventListener("resize",function(e){engine.resize(),testOrientation(),testFullscreen()},!1),$(document).ready(function(){testOrientation()});let isMusicChanged=!1,theClick=0;function setup_music_player(){$(".player").empty();var e=document.getElementById("player");yt_player=new YT.Player(e,{host:"https://www.youtube.com",height:"0",width:"0",videoId:"",playerVars:{autoplay:0,loop:1,start:0,enablejsapi:1,origin:window.location.href,widget_referrer:window.location.href},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})}function onPlayerReady(e){e.target.playVideo()}function onPlayerStateChange(e){switch(e.data){case 0:isMusicPlaying&&yt_player.playVideo()}}let isMusicPlaying=!1;function load_music(e,t){isMusicPlaying?yt_player.playVideo():($(".player").empty(),yt_player.loadVideoById(e,t),yt_player.playVideo(),isMusicPlaying=!0)}function stop_music(){yt_player.pauseVideo()}