let astronautCamera,astronautScene,astronautLight,ASTRO_CAMERA_INIT_ALPHA=-1.649277713156782,ASTRO_CAMERA_INIT_BETA=1.3138466593021418;var astronaut_obj,hl;let astro_curr_state={rot:null,pos:null,scale:null,alpha:null,beta:null,radius:null,target:null};function createAstronautScene(){return(astronautScene=new BABYLON.Scene(engine)).autoClear=!1,astronautCamera=create_astro_camera(),astronautLight=create_astro_light(),load_astro_meshes(),listen_to_astronaut_rotation(),listen_to_astronaut_wheelscroll(),astronautScene}function create_astro_camera(){var t=new BABYLON.ArcRotateCamera("astronautCamera",0,0,10,BABYLON.Vector3(0,0,0),astronautScene);return t.checkCollisions=!0,t.lowerRadiusLimit=1,t.upperRadiusLimit=100,t.wheelPrecision=30,t.panningSensibility=1e3,t.panningDistanceLimit=15,t.speed=.1,t.maxZ=28e3,t}function create_astro_light(){var t=new BABYLON.HemisphericLight("astronautLight1",new BABYLON.Vector3(0,20,-20),astronautScene);return t.radius=300,t.intensity=.8,t.groundColor=new BABYLON.Color3(.3,.3,.3),t}var astronautTask,muteBtn,astronautRotateMap=new Map;function load_astro_meshes(){let t,e;user_gender=document.getElementById("userGender").value,"female"===user_gender.toLowerCase()?(user_gender="female",t="front/objects/astronaut/thomasina/",e="MajorThomasina3.babylon"):(user_gender="male",t="front/objects/astronaut/tom/",e="MajorTom2.babylon"),Promise.all([BABYLON.SceneLoader.ImportMeshAsync(null,t,e,astronautScene,function(t){}).then(function(t){let e;t.meshes.forEach(function(t){t.isPickable=!0,astronautPartsMap.set(t.name,t),add_action_mgr_astrobody(t),"face"===t.name?(t.scaling=new BABYLON.Vector3(1.5,1.2,2),t.position.y+=.02,t.position.z+=.02,theAstroFace=t):"helmetFace"===t.name?t.visibility=.2:"screenBag"===t.name?create_instruction_texture(t):"screenTop"===t.name?e=t:"helmet"===t.name?t.material.backFaceCulling=!1:"helmetStars"===t.name?add_action_mgr(t):"Navigator"===t.name?(navigator_obj=t,add_action_mgr(t)):astronautChestParts.has(t.name)?add_action_mgr(t):"Down"===t.name?astronautRotateMap.set(t.name,t):"body"===t.name?(astronautRotateMap.set(t.name,t),astronaut=t,astronaut_obj=t,isMobile()&&(isSmallDevice()||isMediumDevice())?t.position=new BABYLON.Vector3(4,0,0):t.position=new BABYLON.Vector3(6,0,0)):astronautBtnsMap.has(t.name)?add_action_mgr(t):"BackPack"!==t.name&&"bagWires"!==t.name||astronautRotateMap.set(t.name,t)}),astronaut.rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(30),BABYLON.Tools.ToRadians(0)),"female"===user_gender&&(astronaut.rotation.x=BABYLON.Tools.ToRadians(20)),add_video_to_mesh(e)})]).then(()=>{astronautCamera.alpha=ASTRO_CAMERA_INIT_ALPHA,astronautCamera.beta=ASTRO_CAMERA_INIT_BETA,astronautCamera.viewport=new BABYLON.Viewport(0,0,1,1),setup_music_player(),"female"===user_gender?((muteBtn=init_image("muteBtn","front/images3D/participateScene/mute.png",.06,.06,1,{x:5.7657,y:2.2499,z:.6994},{x:.7370258410517831,y:.1144321008595977,z:-.12906116658846986,w:.6534840619277505})).setParent(astronaut_obj),muteBtn.position=new BABYLON.Vector3(-.4663,1.9472,-.0486),muteBtn.rotation.x=BABYLON.Tools.ToRadians(100),muteBtn.rotation.y=BABYLON.Tools.ToRadians(-170)):((muteBtn=init_image("muteBtn","front/images3D/participateScene/mute.png",.06,.06,1,{x:5.7657,y:2.2499,z:.6994},{x:.7370258410517831,y:.1144321008595977,z:-.12906116658846986,w:.6534840619277505})).setParent(astronaut_obj),muteBtn.position=new BABYLON.Vector3(-.5145,1.9048,.7094),muteBtn.rotation.x=BABYLON.Tools.ToRadians(90),muteBtn.rotation.y=BABYLON.Tools.ToRadians(-180))})}function test_gizmo(t){designUtilLayer=new BABYLON.UtilityLayerRenderer(astronautScene),designUtilLayer.utilityLayerScene.autoClearDepthAndStencil=!1,homeGizmo=new BABYLON.RotationGizmo(designUtilLayer),homeGizmo.attachedMesh=t,homeGizmo2=new BABYLON.PositionGizmo(designUtilLayer),homeGizmo2.attachedMesh=t,homeGizmo2.scaleRatio=1.5}let theAstroFace;function create_face_texture(t){let e=new BABYLON.StandardMaterial("facePhoto",astronautScene);e.diffuseColor=new BABYLON.Color3(0,0,0),e.emissiveColor=new BABYLON.Color3(.5,.5,.5),e.diffuseTexture=new BABYLON.Texture(t,astronautScene),e.diffuseTexture.hasAlpha=!0,e.backFaceCulling=!1,theAstroFace.material=e,theAstroFace.material.canRescale=!0,theAstroFace.material.diffuseTexture.level=2,theAstroFace.material.diffuseTexture.uScale=1,theAstroFace.material.diffuseTexture.vScale=1}var onOverAstronaut=t=>{},onOutAstronaut=t=>{},isAstronautClicked=!1;function remove_astro_scene_objects(){astronautPartsMap.clear(),astronaut_obj.dispose(),astronautCamera.dispose(),astronautLight.dispose(),astronautScene.dispose(),astronaut_obj=null,astronautPartsMap=null}var isAstronautScalingOn=!1,isAstronautRightClicked=!1,astroMouseMov=!1,astroLastAngleDiff={x:0,y:0},astroOldAngle={x:0,y:0},astroNewAngle={x:0,y:0},astroFramecount=0,astroMxframecount=120;let isAstronautFirstClick=!1;var astronautArr={currentPos:{x:null,y:null,z:null},currentRot:{x:null,y:null,z:null}};let origScaling,origColor,partTooltip,astroToolsDiv,isPlanetLabelActive=!0,astronautPartsMap=new Map,isAstroVideoPlaying=!1;function listen_to_astronaut_rotation(){var t=function(t){var e;if(1!=t.button)if(2==t.button)if((e=astronautScene.pick(astronautScene.pointerX,astronautScene.pointerY)).hit){var a=e.pickedMesh.name;astronautPartsMap.has(a)&&(astronautCamera&&astronautCamera.attachControl(canvas,!0),initCamera&&initCamera.detachControl(canvas),isAstronautRightClicked=!0,earthScene&&(earthScene.doNotHandleCursors=!0))}else initCamera&&initCamera.attachControl(canvas,!0),astronautCamera&&astronautCamera.detachControl(canvas),isAstronautRightClicked=!1;else if((e=astronautScene.pick(astronautScene.pointerX,astronautScene.pointerY)).hit){let a=e.pickedMesh.name,n=e.pickedMesh;if(astronautRotateMap.has(a)&&(initCamera&&initCamera.detachControl(canvas),astronautCamera&&astronautCamera.detachControl(canvas),astronautArr.currentPos.x=t.clientX,astronautArr.currentPos.y=t.clientY,astronautArr.currentRot.x=astronaut_obj.rotation.x,astronautArr.currentRot.y=astronaut_obj.rotation.y,isAstronautClicked=!0,isAstronautScalingOn=!0),isAstroVideoPlaying||(discvideoTexture.video.play(),isAstroVideoPlaying=!0),"btn1"===a)earth_place_mbaye_on_earth(),set_btn_active(n),setTimeout(function(){set_btn_active(n)},1e3);else if("btn2"===a)earth_show_countries(n);else if("btn3"===a)earth_show_borders(n);else if("btn4"===a)isPlanetLabelActive=!isPlanetLabelActive,set_orbit_enability(isPlanetLabelActive),set_constellation_enability(isPlanetLabelActive),set_btn_active(n);else if("btn5"===a)earth_rotate_earth_with_mbaye(n);else if("btn6"===a)earth_rotate(n);else if("btn8"===a){let t=astronautChestParts.get(a);checkScreenAndDoubleClick(t)}else if("btn9"===a){let t=astronautChestParts.get(a);checkScreenAndDoubleClick(t)}else if("btn10"===a)earth_initial_view();else if("btn16"===a)earth_handle_gizmo(1);else if("btn17"===a)earth_handle_gizmo(2);else if("btn18"===a)earth_handle_gizmo(3);else if("btn19"===a)earth_handle_gizmo(4);else if("btn20"===a)earth_handle_gizmo(0);else if("helmetStars"===a){let t=wikiMap.get(a);t&&showPage(t)}else if(astronautChestParts.has(a)){let t=astronautChestParts.get(a);checkScreenAndDoubleClick(t)}else if("screenBag"===a){let t=astronautChestParts.get(a);checkScreenAndDoubleClick(t)}else"muteBtn"===a?(change_mesh_material("unmuteBtn",n,"front/images3D/participateScene/unmute.png"),n.name="unmuteBtn",load_music("SBH_u-vEK30",3)):"unmuteBtn"===a&&(change_mesh_material("muteBtn",n,"front/images3D/participateScene/mute.png"),n.name="muteBtn",stop_music())}else isAstronautScalingOn=!1,initCamera&&initCamera.attachControl(canvas,!0),astronautCamera&&astronautCamera.detachControl(canvas);else astronautCamera&&astronautCamera.detachControl(canvas)},e=function(){isAstronautClicked=!1},a=function(t){isAstronautClicked&&(isAstronautClicked&&(astroMouseMov=!0),astroOldAngle.x=astronaut_obj.rotation.x,astroOldAngle.y=astronaut_obj.rotation.y,astronaut_obj.rotation.y+=(t.clientX-astronautArr.currentPos.x)/300,astronaut_obj.rotation.x+=(t.clientY-astronautArr.currentPos.y)/300,astroNewAngle.x=astronaut_obj.rotation.x,astroNewAngle.y=astronaut_obj.rotation.y,astroLastAngleDiff.x=astroNewAngle.x-astroOldAngle.x,astroLastAngleDiff.y=astroNewAngle.y-astroOldAngle.y,astronautArr.currentPos.x=t.clientX,astronautArr.currentPos.y=t.clientY)},n=function(t){var e=astronautScene.pick(astronautScene.pointerX,astronautScene.pointerY),a=e.pickedMesh;e.hit&&a==navigator_obj&&window.open("communicator")};canvas.addEventListener("pointerdown",t,!1),canvas.addEventListener("pointerup",e,!1),canvas.addEventListener("pointermove",a,!1),canvas.addEventListener("dblclick",n,!1),astronautScene.onDispose=function(){canvas.removeEventListener("pointerdown",t),canvas.removeEventListener("pointerup",e),canvas.removeEventListener("pointermove",a),canvas.removeEventListener("dblclick",n)},astronautScene.beforeRender=function(){astroMouseMov=!1},astronautScene.afterRender=function(){astronaut_obj&&(!astroMouseMov&&astroFramecount<astroMxframecount?(astroLastAngleDiff.x=astroLastAngleDiff.x/1.04,astroLastAngleDiff.y=astroLastAngleDiff.y/1.04,astronaut_obj.rotation.x+=astroLastAngleDiff.x,astronaut_obj.rotation.y+=astroLastAngleDiff.y,astroFramecount++,astronautArr.currentRot.x=astronaut_obj.rotation.x,astronautArr.currentRot.y=astronaut_obj.rotation.y):astroFramecount>=astroMxframecount&&(astroFramecount=0))}}function add_action_mgr(t){t.actionManager=new BABYLON.ActionManager(astronautScene),t.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOverTrigger,onOverPart)),t.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOutTrigger,onOutPart))}function add_action_mgr_astrobody(t){t.actionManager=new BABYLON.ActionManager(astronautScene),t.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOverTrigger,onOverAstronaut)),t.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOutTrigger,onOutAstronaut))}var onOverPart=t=>{(partTooltip=document.createElement("span")).setAttribute("id","partTooltip");var e=partTooltip.style;if(e.position="absolute",e.padding="0.2%",e.color="#00BFFF",e.textShadow="1px 1px 3px black",e.fontFamily="Courgette-Regular",e.fontSize="2rem",e.top=astronautScene.pointerY+"px",e.left=astronautScene.pointerX+"px",e.cursor="pointer",e.pointerEvents="none",astronautChestParts.has(t.source.name)){let e=astronautChestParts.get(t.source.name);"btn8"!=t.source.name&&"btn9"!=t.source.name&&(t.source.material.emissiveColor=new BABYLON.Color3(0,1,1),document.body.appendChild(partTooltip),partTooltip.textContent=e[0])}else"helmetStars"===t.source.name&&(t.source.material.emissiveColor=new BABYLON.Color3(0,1,1));astronautBtnsMap.has(t.source.name)&&(origScaling=t.source.scaling,t.source.scaling=new BABYLON.Vector3(1.1*origScaling.x,1.1*origScaling.y,1.1*origScaling.z))},onOutPart=t=>{for(astronautBtnsMap.has(t.source.name)&&(t.source.scaling=origScaling),astronautChestParts.has(t.source.name)&&"btn8"!=t.source.name&&"btn9"!=t.source.name&&(t.source.material.emissiveColor=new BABYLON.Color3(1,1,1));document.getElementById("partTooltip");)document.getElementById("partTooltip").parentNode.removeChild(document.getElementById("partTooltip"));for(;document.getElementById("astroToolsDiv");)document.getElementById("astroToolsDiv").parentNode.removeChild(document.getElementById("astroToolsDiv"))};function listen_to_astronaut_wheelscroll(){astronautScene&&astronautScene.onPrePointerObservable.add(function(t,e){if(isAstronautScalingOn){astronautCamera&&astronautCamera.detachControl(canvas);var a=t.event,n=0;a.wheelDelta?n=a.wheelDelta:a.detail&&(n=-a.detail),n&&set_astronaut_scaling(n<0?"down":"up")}},BABYLON.PointerEventTypes.POINTERWHEEL,!1)}function create_instruction_texture(t){let e=new BABYLON.StandardMaterial("trevorInstructionScreen",astronautScene);e.diffuseColor=new BABYLON.Color3(0,0,0),e.emissiveColor=new BABYLON.Color3(.5,.5,.5),e.diffuseTexture=new BABYLON.Texture("front/images3D/participateScene/trevorInstructionImg.png",astronautScene),e.diffuseTexture.hasAlpha=!0,e.backFaceCulling=!1,t.material=e}function init_image(t,e,a,n,o,r,s){var i=BABYLON.MeshBuilder.CreatePlane(t,{height:a,width:n},astronautScene);i.scaling=new BABYLON.Vector3(o,o,o),i.position=new BABYLON.Vector3(r.x,r.y,r.z);var u=new BABYLON.StandardMaterial(t+"matl",astronautScene);return u.diffuseTexture=new BABYLON.Texture(e,astronautScene),u.opacityTexture=new BABYLON.Texture(e,astronautScene),u.ambientColor=new BABYLON.Color3(1,1,1),u.emissiveColor=new BABYLON.Color3(.5,.5,.5),u.diffuseTexture.hasAlpha=!0,i.material=u,i}function change_mesh_material(t,e,a){var n=new BABYLON.StandardMaterial(t+"matl",astronautScene);n.diffuseTexture=new BABYLON.Texture(a,astronautScene),n.opacityTexture=new BABYLON.Texture(a,astronautScene),n.ambientColor=new BABYLON.Color3(1,1,1),n.emissiveColor=new BABYLON.Color3(.5,.5,.5),n.diffuseTexture.hasAlpha=!0,e.material=n}let videoTexture,videoTexture2,discvideoTexture,videoHome_obj,videoHome_obj2,theVideoMatl;function add_video_to_mesh(t){let e=new BABYLON.StandardMaterial("videoMat",astronautScene);discvideoTexture||(discvideoTexture=new BABYLON.VideoTexture("astroVid",["front/videos/participate/astronautVideo.webm","front/videos/participate/astronautVideo.mp4"],astronautScene,!0,!1,{streaming:!0,autoplay:!1}),e.backFaceCulling=!1,e.diffuseTexture=discvideoTexture,discvideoTexture.vScale=-1,discvideoTexture.uScale=-1,t.material=e,discvideoTexture.video.autoplay=!0,discvideoTexture.video.loop=!0,discvideoTexture.video.autoUpdateTexture=!0,discvideoTexture.video.pause(),theVideoMatl=e)}function set_astronaut_scaling(t){let e=astronaut_obj.scaling.x,a=astronaut_obj.scaling.y,n=astronaut_obj.scaling.z;"down"===t?astronaut_obj.scaling.x<=.2&&astronaut_obj.scaling.y<=.2&&astronaut_obj.scaling.z<=.2?astronaut_obj.scaling=new BABYLON.Vector3(.2,.2,.2):astronaut_obj.scaling=new BABYLON.Vector3(e-.05,a-.05,n-.05):astronaut_obj.scaling.x>=4&&astronaut_obj.scaling.y>=4&&astronaut_obj.scaling.z>=4?astronaut_obj.scaling=new BABYLON.Vector3(4,4,4):astronaut_obj.scaling=new BABYLON.Vector3(e+.05,a+.05,n+.05)}function show_astro_backpack(t){astronaut_obj&&t?null===astro_curr_state.rot?reset_astro():(astronaut_obj.rotation=astro_curr_state.rot,astronaut_obj.scaling=astro_curr_state.scale,astronautCamera.position=astro_curr_state.pos,astronautCamera.alpha=astro_curr_state.alpha,astronautCamera.beta=astro_curr_state.beta,astronautCamera.radius=astro_curr_state.radius,astronautCamera.target=astro_curr_state.target):(astro_curr_state.rot=astronaut_obj.rotation,astro_curr_state.pos=astronautCamera.position,astro_curr_state.scale=astronaut_obj.scaling,astro_curr_state.alpha=astronautCamera.alpha,astro_curr_state.beta=astronautCamera.beta,astro_curr_state.radius=astronautCamera.radius,astro_curr_state.target=astronautCamera.target)}function reset_astro(){"male"===user_gender?(astronaut_obj.scaling=new BABYLON.Vector3(3.3,3.3,3.3),astronaut_obj.rotation=new BABYLON.Vector3(-.1454,3.4757,0)):(astronaut_obj.scaling=new BABYLON.Vector3(3.5,3.5,3.5),astronaut_obj.rotation=new BABYLON.Vector3(.2664,3.5101,0)),astronautCamera.position=new BABYLON.Vector3(1.7257,5.563,-9.0408),astronautCamera.alpha=-1.64927,astronautCamera.beta=1.3138,astronautCamera.radius=10,astronautCamera.target=new BABYLON.Vector3(2.0222,3.237,.5651)}function set_btn_active(t){let e=astronautBtnsMap.get(t.name);null!=e&&e?(t.material.emissiveColor=new BABYLON.Color3(0,0,0),astronautBtnsMap.set(t.name,null)):(t.material.emissiveColor=BABYLON.Color3.Red(),astronautBtnsMap.set(t.name,!0))}