var visitScene,visitCamera,visitLight,visitSkybox,mbayeTask,mbayeObject;const LOWER_RADIUS_VAL=.5,UPPER_RADIUS_VAL=3e3;var isHomeCounterReady=!1;let visitCamInitPos={x:-2123,y:-215,z:1653},currentCameraScene=1;function createScene(){return engine.enableOfflineSupport=!0,visitScene=new BABYLON.Scene(engine),visitCamera=create_visit_camera(),create_visit_light(),visitSkybox=create_visit_skybox(),create_visit_planets(),set_vr_next_scene(1),add_visit_mouse_listener(),create_part_disc(),add_vr_clickable_parts(1),visitScene}let cameraInitDict={x:-1135,y:486,z:900,radius:2700};function create_visit_camera(){var e=new BABYLON.ArcRotateCamera("Initial Camera",BABYLON.Tools.ToRadians(0),BABYLON.Tools.ToRadians(0),30,new BABYLON.Vector3(-2123,-215,1653),visitScene);return e.fovMode=BABYLON.Camera.FOVMODE_HORIZONTAL_FIXED,e.fov=1.4,e.lowerRadiusLimit=LOWER_RADIUS_VAL,e.upperRadiusLimit=UPPER_RADIUS_VAL,e.wheelPrecision=1,e.angularSensibilityX=4e3,e.angularSensibilityY=4e3,e.panningSensibility=10,e.upperBetaLimit=10,e.panningDistanceLimit=1500,e.attachControl(canvas,!0),e.pinchPrecision=1,e.maxZ=25e3,visitScene.activeCamera=e,e}var planetsLight;function create_visit_light(){(visitLight=new BABYLON.HemisphericLight("hemiLight",new BABYLON.Vector3(0,0,100),visitScene)).radius=500,visitLight.specular=new BABYLON.Color3(0,0,0),visitLight.diffuse=new BABYLON.Color3(1,1,1),visitLight.groundColor=new BABYLON.Color3(.13,.13,.13),visitLight.intensity=1.2}function create_visit_skybox(){var e=BABYLON.MeshBuilder.CreateBox("visitSkybox",{size:2e4},visitScene);e.position.y=-500,e.position.z=1e3,e.rotation.y=BABYLON.Tools.ToRadians(-60),e.isPickable=!1,e.checkCollisions=!0;var t=new BABYLON.StandardMaterial("visitSkyboxMaterial",visitScene);t.backFaceCulling=!1;return t.reflectionTexture=new BABYLON.CubeTexture.CreateFromImages(["front/finalSkybox/px.png","front/finalSkybox/py.png","front/finalSkybox/pz.png","front/finalSkybox/nx.png","front/finalSkybox/ny.png","front/finalSkybox/nz.png"],visitScene),t.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,t.disableLighting=!0,t.specular=new BABYLON.Vector3(0,0,0),e.material=t,t.freeze(),e.freezeWorldMatrix(),e}let vrDome;function set_vr_next_scene(e){vrDome&&vrDome.dispose(),vrDome=new BABYLON.PhotoDome("testdome","front/finalSkybox/vr/"+e+".jpg",{resolution:64,size:2e3},visitScene),visitCamera.target=new BABYLON.Vector3(0,0,0),4===e?vrDome.rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(120),0):5===e?vrDome.rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(140),0):8===e?vrDome.rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(-50),0):(visitCamera.position=visitCamInitPos,visitCamera.radius=2700,vrDome.rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(-50),0)),vrDome.mesh.isPickable=!1}let neptune,planetAxis=new BABYLON.Vector3(0,4,0);function create_visit_planets(){let e=init_planet("mercury","mercurymatl","front/textures/home/planets/mercury.jpg","front/textures/home/planets/mercurynormal.jpg",-944,1698,-3107,400);add_action_mgr(e),neptune=BABYLON.Mesh.CreateSphere("outerSphere",30,2050,visitScene);var t=new BABYLON.StandardMaterial("matl",visitScene);t.diffuseTexture=new BABYLON.Texture("front/textures/visiting/vrSky2.png",visitScene),t.opacityTexture=new BABYLON.Texture("front/textures/visiting/vrSky2.png",visitScene),t.diffuseTexture.hasAlpha=!0,t.backFaceCulling=!1,neptune.material=t,neptune.isPickable=!1;let n=init_planet("saturn","saturnMatl","front/textures/home/planets/saturn.jpg","front/textures/home/planets/saturnnormal.jpg",4340,-208,1369,400),i=BABYLON.Mesh.CreateGround("rings",895,895,1,visitScene);i.parent=n,n.rotationQuaternion=new BABYLON.Quaternion(.352,.2328,.3009,.8505);let o=new BABYLON.StandardMaterial("ringsMaterial",visitScene);o.diffuseTexture=new BABYLON.Texture("front/textures/home/planets/saturnRing2.png",visitScene),o.diffuseTexture.hasAlpha=!0,o.backFaceCulling=!1,i.material=o,engine.runRenderLoop(function(){visitScene&&(e.rotation.y=Math.PI/2,e.rotate(planetAxis,-.01,BABYLON.Space.LOCAL),neptune.rotation.y=Math.PI/2,neptune.rotate(planetAxis,-.005,BABYLON.Space.LOCAL),n.rotation.y=Math.PI/2,n.rotate(planetAxis,-.02,BABYLON.Space.LOCAL))})}function init_planet(e,t,n,i,o,r,a,s){var c=BABYLON.Mesh.CreateSphere(e,30,s,visitScene);c.position=new BABYLON.Vector3(o,r,a);var l=new BABYLON.StandardMaterial(t,visitScene);return l.diffuseTexture=new BABYLON.Texture(n,visitScene),l.bumpTexture=new BABYLON.Texture(i,visitScene),l.specularColor=new BABYLON.Color3(0,0,0),c.material=l,c}var homeGizmo;function enable_visit_gizmo(e){var t=new BABYLON.UtilityLayerRenderer(visitScene);t.utilityLayerScene.autoClearDepthAndStencil=!1,homeGizmo=new BABYLON.PositionGizmo(t),homeGizmo2=new BABYLON.RotationGizmo(t),homeGizmo.attachedMesh=e,homeGizmo2.attachedMesh=e,homeGizmo.scaleRatio=2}let toolTip;var onOverVRPart=e=>{(toolTip=document.createElement("span")).setAttribute("id","toolTipLabel");let t=toolTip.style;t.position="absolute",t.lineHeight="1.2em",t.paddingLeft="10px",t.paddingRight="10px",t.color="#ffffff",t.border="1px ridge gray",t.borderRadius="5px",t.backgroundColor="none",t.fontSize="1.5em",t.fontFamily="Courgette-Regular",t.top=visitScene.pointerY+"px",t.left=visitScene.pointerX+"px",t.cursor="pointer",document.body.appendChild(toolTip),"pond"===e.source.name?toolTip.textContent="To the lift":"mbayeBot"===e.source.name?toolTip.textContent="Underneath Mbaye":"mbayeHead"===e.source.name?toolTip.textContent="Head of Mbaye":"mercury"===e.source.name?toolTip.textContent="Home":toolTip.textContent=e.source.name,"Ground"===e.source.name?toolTip.setAttribute("onclick"," set_vr_next_scene(2)"):"Back"===e.source.name?toolTip.setAttribute("onclick"," set_vr_next_scene(1)"):"Museum"===e.source.name?toolTip.setAttribute("onclick"," set_vr_next_scene(3)"):"Exit"===e.source.name?toolTip.setAttribute("onclick"," set_vr_next_scene(1)"):"Window"===e.source.name?toolTip.setAttribute("onclick"," set_vr_next_scene(4)"):"Museum Entrance"===e.source.name?toolTip.setAttribute("onclick"," set_vr_next_scene(3)"):"Captain Mbaye"===e.source.name?toolTip.setAttribute("onclick"," set_vr_next_scene(5)"):"mbayeHead"===e.source.name?toolTip.setAttribute("onclick"," set_vr_next_scene(6)"):"mbayeBot"===e.source.name?toolTip.setAttribute("onclick"," set_vr_next_scene(7)"):"Foot"===e.source.name?toolTip.setAttribute("onclick"," set_vr_next_scene(8)"):"Lift"===e.source.name?toolTip.setAttribute("onclick"," set_vr_next_scene(9)"):"Head"===e.source.name?toolTip.setAttribute("onclick"," set_vr_next_scene(10)"):"Night"===e.source.name?toolTip.setAttribute("onclick"," set_vr_next_scene(11)"):"pond"===e.source.name?toolTip.setAttribute("onclick"," set_vr_next_scene(12)"):"Side View"===e.source.name?toolTip.setAttribute("onclick"," set_vr_next_scene(13)"):"View Head"===e.source.name?toolTip.setAttribute("onclick","set_vr_next_scene(14)"):"mercury"===e.source.name&&toolTip.setAttribute("onclick","window.open('/','_self')")},onOutVRPart=e=>{for(;document.getElementById("toolTipLabel");)document.getElementById("toolTipLabel").parentNode.removeChild(document.getElementById("toolTipLabel"))};function add_action_mgr(e){e.actionManager=new BABYLON.ActionManager(visitScene),e.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOverTrigger,onOverVRPart)),e.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOutTrigger,onOutVRPart))}let museumDisc,exitDisc,discTemp,vrPartsNamesMap=new Map;function add_vr_clickable_parts(e){vrSceneDiscs.clear();let t=vrPartsMap.get(e).length;for(i=0;i<t;i++)vrSceneDiscs.set(i,set_part_in_scene(e,vrPartsMap.get(e)[i]));discTemp.isVisible=!1,discTemp.setEnabled(!1)}let vrSceneDiscs=new Map;function create_part_disc(){(discTemp=BABYLON.MeshBuilder.CreateDisc("tempDisc",{radius:120,tessellation:0},visitScene)).position=new BABYLON.Vector3(0,0,0);let e=new BABYLON.StandardMaterial("discMatl",visitScene);e.diffuseColor=new BABYLON.Color3(1,1,1),e.alpha=.001,discTemp.material=e}function set_part_in_scene(e,t){let n=discTemp.clone(t.name);return n.position=new BABYLON.Vector3(t.x,t.y,t.z),n.rotationQuaternion=new BABYLON.Quaternion(t.rotX,t.rotY,t.rotZ,t.rotW),n.scaling=new BABYLON.Vector3(t.scale,t.scale,t.scale),add_action_mgr(n),n.isVisible=!0,n.setEnabled(!0),"Museum"===vrPartsMap.get(e)[i].name?museumDisc=n:"Exit"===vrPartsMap.get(e)[i].name&&(exitDisc=n),vrPartsNamesMap.set(t.name,null),n}async function remove_prev_scene_parts(){for(;document.getElementById("toolTipLabel");)document.getElementById("toolTipLabel").parentNode.removeChild(document.getElementById("toolTipLabel"));for(i=0;i<vrSceneDiscs.size;i++)vrSceneDiscs.get(i).dispose();vrPartsNamesMap.clear()}function change_vr_sky(e){if("Museum"===e){var t=new BABYLON.StandardMaterial("matl",visitScene);t.diffuseTexture=new BABYLON.Texture("front/textures/visiting/vrSky3.png",visitScene),t.opacityTexture=new BABYLON.Texture("front/textures/visiting/vrSky3.png",visitScene),t.diffuseTexture.hasAlpha=!0,t.backFaceCulling=!1,neptune.material=t}}function add_visit_mouse_listener(){var e=async function(e){if(visitScene){var t=visitScene.pick(visitScene.pointerX,visitScene.pointerY);if(t.hit){let e=t.pickedMesh;if("mercury"===e.name&&window.open("/","_self"),vrPartsNamesMap.has(e.name)){let t;"Ground"===e.name?(set_vr_next_scene(2),t=2):"Back"===e.name?(playSound(1),set_vr_next_scene(1),t=1):"Museum"===e.name?(playSound(2),change_vr_sky("Museum"),set_vr_next_scene(3),t=3):"Exit"===e.name?(playSound(1),change_vr_sky("Park"),set_vr_next_scene(1),t=1):"Window"===e.name?(set_vr_next_scene(4),t=4):"Museum Entrance"===e.name?(set_vr_next_scene(3),t=3):"Captain Mbaye"===e.name?(set_vr_next_scene(5),t=5):"mbayeHead"===e.name?(set_vr_next_scene(6),t=6):"mbayeBot"===e.name?(set_vr_next_scene(7),t=7):"Foot"===e.name?(set_vr_next_scene(8),t=8):"Lift"===e.name?(set_vr_next_scene(9),t=9):"Head"===e.name?(set_vr_next_scene(10),t=10):"Night"===e.name?(playSound(3),set_vr_next_scene(11),t=11):"pond"===e.name?(set_vr_next_scene(12),t=12):"Side View"===e.name?(set_vr_next_scene(13),t=13):"View Head"===e.name&&(set_vr_next_scene(14),t=14),currentCameraScene=t,t&&(await remove_prev_scene_parts(),add_vr_clickable_parts(t))}}}},t=function(){},n=function(e){};canvas.addEventListener("pointerdown",e,!1),canvas.addEventListener("pointerup",t,!1),canvas.addEventListener("pointermove",n,!1),visitScene.onDispose=function(){canvas.removeEventListener("pointerdown",e),canvas.removeEventListener("pointerup",t),canvas.removeEventListener("pointermove",n)}}var engine=new BABYLON.Engine(canvas,!0,{preserveDrawingBuffer:!0,stencil:!0},!0),theScene=createScene(),i=0;let loadingCount=0;function stopSound(){document.getElementById("vrSceneAudio").pause()}function playSound(e){let t;t=2==e?"front/audio/visitingScene/VRSceneMuseum.mp3":"front/audio/visitingScene/VRSceneInitial.mp3",document.getElementById("vrSceneAudio").src=t}function set_touch_icons(){$(".touch-rotate").attr("src","front/images3D/icons/rotateTouch.png"),$(".touch-zoom").attr("src","front/images3D/icons/zoomTouch.png"),$(".touch-panning").attr("src","front/images3D/icons/panningTouch.png")}setInterval(function(){loadingCount<100&&(loadingCount+=1,document.getElementById("loadingScreenPercent").innerHTML="Loading: "+loadingCount+"%")},200),theScene.executeWhenReady(function(){document.getElementById("loadingScreenPercent").innerHTML="Loading: 100%",setTimeout(()=>{document.getElementById("loadingScreenPercent").style.visibility="hidden",document.getElementById("loadingScreenDiv").remove()},200),(isSmallDevice()||isMobile())&&set_touch_icons(),engine.runRenderLoop(function(){theScene&&(theScene.render(),10===currentCameraScene||9===currentCameraScene?visitCamera.radius>1e3?(museumDisc.isVisible=!1,museumDisc.isPickable=!1):(museumDisc.isVisible=!0,museumDisc.isPickable=!0):3===currentCameraScene&&(visitCamera.radius>1e3?(exitDisc.isVisible=!1,exitDisc.isPickable=!1):(exitDisc.isVisible=!0,exitDisc.isPickable=!0)))})}),window.addEventListener("resize",function(){engine.resize(),testFullscreen()}),$("#div-click").on("click",function(){$(this).remove(),$("#vrSceneAudio")[0].play()}),$("#infoIcon").on("click",function(){$("#instructionMousediv").toggle(),$("#instructionTopLeft").toggle(),$("#visitMbayeInstruction").toggle()});