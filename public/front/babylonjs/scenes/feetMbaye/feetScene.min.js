let canvas,engine,theAstroFace,footCamera,hl,starColor,rfoot_obj,rfoot_meshes,foot_plane,foot_heart_label,homeGizmo,homeGizmo2,DISC_CAM_INIT_POS={x:2.83,y:.44,z:580.01},cameraInitState={position:null,a:null,b:null,r:null,upperA:null,lowerA:null,upperB:null,lowerB:null,upperR:null,lowerR:null,angularY:null},astroInitState={x:0,y:0,z:0},createContactScene=function(){canvas=document.getElementById("canvas"),(engine=new BABYLON.Engine(canvas,!0,{preserveDrawingBuffer:!0,stencil:!0})).enableOfflineSupport=!0,scene=new BABYLON.Scene(engine),BABYLON.Database.IDBStorageEnabled=!0,scene.collisionsEnabled=!0;let e=new BABYLON.CubeTexture.CreateFromPrefilteredData("front/textures/environment.dds",scene);return e.gammaSpace=!1,scene.environmentTexture=e,load_3D_mesh(),load_orig_flowers(),create_skybox(),footCamera=create_camera(),create_light(),hl=new BABYLON.HighlightLayer("hl1",scene),starColor=new BABYLON.HighlightLayer("starColor",scene),scene};function create_camera(){let e=new BABYLON.ArcRotateCamera("Main Camera",BABYLON.Tools.ToRadians(0),BABYLON.Tools.ToRadians(0),30,new BABYLON.Vector3(-60.752,10,7.05),scene);return e.fovMode=BABYLON.Camera.FOVMODE_HORIZONTAL_FIXED,e.fov=1.4,e.upperAlphaLimit=1e3,e.lowerRadiusLimit=40,e.upperRadiusLimit=200,e.wheelPrecision=3,e.panningSensibility=300,e.target=new BABYLON.Vector3(0,0,0),e.panningDistanceLimit=70,e.pinchPrecision=1,e.radius=100,e.maxZ=28e4,e.alpha=2.8985,e.beta=1.5703,e.attachControl(canvas,!0),scene.activeCamera=e,e.checkCollisions=!0,cameraInitState.position=new BABYLON.Vector3(-198.34,80.42,162.37),cameraInitState.a=e.alpha,cameraInitState.b=e.beta,cameraInitState.r=e.radius,e}function create_light(){let e=new BABYLON.HemisphericLight("hemiLight",new BABYLON.Vector3(-30,200,10),scene);e.diffuse=new BABYLON.Color3(1,1,1),e.radius=500,e.specular=new BABYLON.Color3(0,0,0),e.groundColor=new BABYLON.Color3(.3,.3,.3)}function create_skybox(){let e=BABYLON.MeshBuilder.CreateBox("contactSkybox",{size:25e3},scene);e.position=new BABYLON.Vector3(942,-500,-1500),e.rotation.y=BABYLON.Tools.ToRadians(-60),e.isPickable=!1,e.checkCollisions=!0,e.infiniteDistance=!0,e.renderingGroupId=0;let o=new BABYLON.StandardMaterial("contactSkyboxMaterial",scene);o.backFaceCulling=!1;return o.reflectionTexture=new BABYLON.CubeTexture.CreateFromImages(["front/skybox/px.png","front/skybox/py.png","front/skybox/pz.png","front/skybox/nx.png","front/skybox/ny.png","front/skybox/nz.png"],scene),o.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,o.disableLighting=!0,o.specular=new BABYLON.Vector3(0,0,0),e.material=o,o.freeze(),e.freezeWorldMatrix(),e}function load_3D_mesh(){var e=0;Promise.all([BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/feetMbayeScene/","FrontRFoot.babylon",scene,function(o){if(o.lengthComputable)e=(100*o.loaded/o.total).toFixed();else{var t=o.loaded/1048576;e+=Math.floor(100*t)/100}document.getElementById("loadingScreenPercent").innerHTML="Loading: "+e+" %"}).then(function(e){e.meshes[0].scaling=new BABYLON.Vector3(12,12,12),e.meshes[0].isPickable=!0,(rfoot_obj=e.meshes[0]).checkCollisions=!0,rfoot_meshes=e.meshes,e.meshes.forEach(function(e){e.isPickable=!0,"25PilosellaAurantica"===e.name&&(e.name="25PilosellaAurantiaca")})})]).then(()=>{add_mouse_listener();for(const[e,o]of marblePhotos.entries())init_flower_photo(e,o[0],o[1],o[2]);init_foot_label(),init_foot_heart_label(),add_action_mgr(rfoot_obj),setup_music_player()})}let isGizmoDragging=!1;function enable_gizmo(e){let o=new BABYLON.UtilityLayerRenderer(scene);homeGizmo=new BABYLON.PositionGizmo(o),homeGizmo2=new BABYLON.RotationGizmo(o),o.utilityLayerScene.autoClearDepthAndStencil=!1,homeGizmo.attachedMesh=e,homeGizmo.scaleRatio=2,homeGizmo2.attachedMesh=e,homeGizmo.onDragStartObservable.add(function(){isGizmoDragging=!0}),homeGizmo.onDragEndObservable.add(function(){isGizmoDragging=!1,homeGizmo2.attachedMesh=null,homeGizmo.attachedMesh=null})}let currFlower,currFootFlower,isPlane2Selected=!1,isLaunchEnabled=!1,isPointerDown=!1;function add_mouse_listener(){var e=function(e){if(scene){var o=scene.pick(scene.pointerX,scene.pointerY);if(o.hit){let e=o.pickedMesh;if(rFootFlowersMap.has(e.name))if(e.parent){if(litFlowersMap.has(e)){currFootFlower=e.name;let o=rFoot3DFlowersMap.get(e.name);o.length>1?$(".modelArrow").css("display","block"):$(".modelArrow").css("display","none"),showFlowerModelDiv(o[0])}}else{let o=rFootFlowersMap.get(e.name);clearTimeout(focusTimer);let t=flowersMbayeMap.get(e.name),i=t[3].id,n=t[3].start;get_foot_mesh(e.name,o[1]),set_instructions_overlay(1),e.name!=currFlower?(load_flower_music(i,n),currFlower=e.name):e.name==currFlower&&$("#musicVideoDiv").css("display","flex")}e===foot_plane&&(isGalleryVisible?(set_gallery_visible(!1),isGalleryVisible=!1):(set_gallery_visible(!0),isGalleryVisible=!0,set_camera_specs("init")))}else isPointerDown||(isPointerDown=!0)}},o=function(){isPointerDown=!1},t=function(e){isPointerDown&&set_flower_angle()};canvas.addEventListener("pointerdown",e,!1),canvas.addEventListener("pointerup",o,!1),canvas.addEventListener("pointermove",t,!1),scene.onDispose=function(){canvas.removeEventListener("pointerdown",e),canvas.removeEventListener("pointerup",o),canvas.removeEventListener("pointermove",t)}}function set_flower_angle(){for(const[e,o]of origFlowersMap.entries())o.rotation.y+=.015}let focusTimer,litFlowersMap=new Map;function get_foot_mesh(e,o){if(litFlowersMap.size>0){for(const[e,o]of litFlowersMap.entries())e.material=o,e.actionManager=null;litFlowersMap.clear()}let t=0;rfoot_meshes.forEach(function(i){if(i.name===e){litFlowersMap.set(i,i.material),0==t&&set_camera_specs(o),t++;let e=i.material.clone();e.emissiveColor=new BABYLON.Color3(0,0,.5),i.material.isWorldMatrixFrozen=!1,i.material=e,add_action_mgr(i)}})}function set_camera_specs(e){if("init"===e)footCamera.position=cameraInitState.position,footCamera.alpha=cameraInitState.a,footCamera.beta=cameraInitState.b,footCamera.radius=cameraInitState.r;else{"b"==e?footCamera.position=new BABYLON.Vector3(127.24,-4.45,-11.36):"f"==e&&(footCamera.position=new BABYLON.Vector3(-60.752,10,7.05));let o=cameraAngleMap.get(e);footCamera.alpha=o[0].a,footCamera.beta=o[0].b,footCamera.radius=115}}function set_scale(){return getRandomInt(4,5)}function getRandomInt(e,o){return Math.floor(Math.random()*(o-e+1)+e)}document.onkeydown=(e=>{"o"!=e.key&&"O"!=e.key||(homeGizmo.attachedMesh=null,homeGizmo2.attachedMesh=null)});let nb=100;var TWO_PI=2*Math.PI,angle=TWO_PI/nb,origFlowersMap=new Map;function load_orig_flowers(){for(const[e,o]of rFootFlowersMap.entries()){let t;null!==o[0]&&(t=o[0]);let i=init_flower(e,e+"Matl","front/images3D/flowers2D/orig/"+e+".png",set_scale(),t.x,t.y,t.z);origFlowersMap.set(e,i)}}function init_flower(e,o,t,i,n,r,l){let a=BABYLON.Mesh.CreatePlane(e,i,scene);a.isVisible=!0,a.position=new BABYLON.Vector3(n,r,l),a.rotation.y=BABYLON.Tools.ToRadians(-250);let s=new BABYLON.StandardMaterial(o,scene);return s.diffuseColor=BABYLON.Color3.Black(),s.diffuseTexture=new BABYLON.Texture(t,scene),s.diffuseTexture.hasAlpha=!0,s.specularColor=new BABYLON.Color3(0,0,0),s.emissiveColor=BABYLON.Color3.White(),s.backFaceCulling=!1,s.freeze(),a.material=s,add_action_mgr(a),a}function init_foot_label(){let e=BABYLON.Mesh.CreatePlane("footHoverLbl",10,scene);e.isVisible=!0,e.position=new BABYLON.Vector3(0,3,-0),e.rotationQuaternion=new BABYLON.Quaternion(0,-.7324,0,-.6808);let o=new BABYLON.StandardMaterial("footHoverLblMatl",scene);o.alpha=0,o.backFaceCulling=!1,o.freeze(),e.material=o,foot_plane=e,add_action_mgr(e)}function init_foot_heart_label(){let e=BABYLON.MeshBuilder.CreatePlane("footHeartLbl",{width:24,height:21},scene);e.isVisible=!1,e.position=new BABYLON.Vector3(-2.2,.4,-21.28),e.rotationQuaternion=new BABYLON.Quaternion(0,-.82,0,-.5721);let o=new BABYLON.StandardMaterial("footHeartLbl",scene);o.diffuseTexture=new BABYLON.Texture("front/images3D/feetScene/footHeartLabel.png",scene),o.emissiveColor=new BABYLON.Color3(1,1,1),o.diffuseTexture.hasAlpha=!0,o.backFaceCulling=!1,o.freeze(),foot_heart_label=e,e.material=o}function add_action_mgr(e){e.actionManager=new BABYLON.ActionManager(scene),e.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOverTrigger,onOverFlower)),e.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOutTrigger,onOutFlower))}function remove_action_mgr(){}let origScaling,origColor,flowerLbl,footMatl;var onOverFlower=e=>{if(null==e.source.parent)if(e.source==rfoot_obj);else if("footHoverLbl"==e.source.name)foot_heart_label.isVisible=!0;else{origScaling=e.source.scaling,e.source.scaling=new BABYLON.Vector3(1.4*origScaling.x,1.4*origScaling.y,1.4*origScaling.z);let t=(.98*Math.random()+.01).toFixed(1),i=(.98*Math.random()+.01).toFixed(1),n=(.98*Math.random()+.01).toFixed(1);"Safari"===testBrowser()?e.source.material.emissiveColor=new BABYLON.Color3(.4,.7,.4):hl.addMesh(e.source,new BABYLON.Color3(t,i,n)),(flowerLbl=document.createElement("span")).setAttribute("id","flowerLbl");var o=flowerLbl.style;o.position="absolute",o.padding="0.5%",o.color="#00BFFF  ",o.fontFamily="Courgette-Regular",o.top=scene.pointerY+"px",o.left=scene.pointerX+20+"px",o.cursor="pointer",o.textShadow="2px 0px 5px black",o.fontSize="2em";let r=e.meshUnderPointer.name;document.body.appendChild(flowerLbl),flowerLbl.textContent=flowerName.get(r)}else"footHoverLbl"!==e.source.name&&(footMatl=e.source.material,e.source.material.emissiveColor=new BABYLON.Color3(0,.7,.7))},onOutFlower=e=>{if(null==e.source.parent)if(e.source==rfoot_obj);else if(e.source==foot_plane)foot_heart_label.isVisible=!1;else{"Safari"===testBrowser()?e.source.material.emissiveColor=new BABYLON.Color3(1,1,1):hl.removeMesh(e.source),e.source.scaling=origScaling}else e.source.material.emissiveColor=new BABYLON.Color3(0,0,.5);for(;document.getElementById("flowerLbl");)document.getElementById("flowerLbl").parentNode.removeChild(document.getElementById("flowerLbl"))};let footGalleryMap=new Map;function init_flower_photo(e,o,t,i){let n=BABYLON.MeshBuilder.CreatePlane(e,{width:i.w,height:i.h},scene);n.isVisible=!1,n.position=new BABYLON.Vector3(o.x,o.y,o.z),n.rotationQuaternion=new BABYLON.Quaternion(t.x,t.y,t.z,t.w);let r=new BABYLON.StandardMaterial(e,scene);return r.diffuseColor=BABYLON.Color3.Black(),r.diffuseTexture=new BABYLON.Texture("front/images3D/feetScene/gallery/"+e+".png",scene),r.diffuseTexture.uScale=-1,r.diffuseTexture.hasAlpha=!0,r.specularColor=new BABYLON.Color3(0,0,0),r.emissiveColor=BABYLON.Color3.White(),r.backFaceCulling=!1,n.material=r,footGalleryMap.set(n,null),n}let isGalleryVisible=!1;function set_gallery_visible(e){for(const[o,t]of footGalleryMap.entries())o.isVisible=!!e}var theScene=createContactScene();let yt_player;theScene.executeWhenReady(function(){$("#loadingScreenDiv").css("display","none"),$("#loadingScreenPercent").css("display","none"),testFullscreen();var e=new BABYLON.SceneOptimizerOptions;e.addOptimization(new BABYLON.HardwareScalingOptimization(0,1.5));new BABYLON.SceneOptimizer(theScene,e);(isSmallDevice()||isMobile())&&set_touch_icons(),engine.runRenderLoop(function(){scene&&scene.render()})}),window.addEventListener("resize",function(){engine.resize(),testOrientation(),testFullscreen()}),$(document).ready(function(){testOrientation()});let isMusicChanged=!1,theClick=0;function setup_music_player(){$(".player").empty();var e=document.getElementById("player");window.YT.ready(function(){yt_player=new YT.Player(e,{host:"https://www.youtube.com",height:"0",width:"0",videoId:"",playerVars:{autoplay:0,loop:0,start:0,enablejsapi:1,origin:window.location.href,widget_referrer:window.location.href},events:{onReady:onPlayerReady}})})}function onPlayerReady(e){e.target.playVideo()}function load_flower_music(e,o){$(".player").empty(),yt_player.loadVideoById(e,o),yt_player.playVideo(),$("#musicVideoDiv").css("display","flex")}function stop_flower_music(){yt_player.stopVideo()}$("#musicVideoDivHeader #close-btn").on("click",function(e){$("#musicVideoDiv").hide()});let isMusicFullscreen=!1;function resize_window(e,o){let t;"youtube"===o?t=$("#musicVideoDiv #player"):"3dflower"===o&&(t=$("#flowerModelDiv")),"full"===e?(t.css({width:"100vw",height:"95vh"}),"youtube"===o&&$("#musicVideoDiv").css({width:"100vw",height:"auto"}),"3dflower"===o&&t.css("height","100%"),$("#minimize-btn").css("padding-right","1%"),$("#flowerModelDiv #minimize-btn").css("padding-right","1%")):isMobile()||isSmallDevice()?(t.css({width:"30vw",height:"18vw"}),"youtube"===o&&$("#musicVideoDiv").css("width","30vw")):(t.css({width:"20vw",height:"12vw"}),"youtube"===o&&$("#musicVideoDiv").css("width","20vw"))}$("#musicVideoDivHeader #fullscreen-btn, #musicVideoDivHeader #minimize-btn").on("click",function(e){isMusicFullscreen?(resize_window("window","youtube"),$("#musicVideoDivHeader #fullscreen-btn").show(),$("#musicVideoDivHeader #minimize-btn").hide(),$("#flowerModelDiv").show()):(resize_window("full","youtube"),$("#musicVideoDivHeader #fullscreen-btn").hide(),$("#musicVideoDivHeader #minimize-btn").show(),$("#flowerModelDiv").hide()),isMusicFullscreen=!isMusicFullscreen}),$("#flowerModelDiv #close-btn").on("click",function(e){document.getElementById("flowerModelDiv").style.visibility="hidden",$(".modelArrow").css("display","none")});let isFlowerFullscreen=!1;$("#flowerModelDivHeader #fullscreen-btn, #flowerModelDivHeader #minimize-btn").on("click",function(e){isFlowerFullscreen?(resize_window("window","3dflower"),$("#flowerModelDivHeader").css("height","25%"),$("#flowerModelDivHeader #fullscreen-btn").show(),$("#flowerModelDivHeader #minimize-btn").hide()):(resize_window("full","3dflower"),isSmallDevice()?$("#flowerModelDivHeader").css("height","10%"):$("#flowerModelDivHeader").css("height","5%"),$("#flowerModelDivHeader #fullscreen-btn").hide(),$("#flowerModelDivHeader #minimize-btn").show()),isFlowerFullscreen=!isFlowerFullscreen});let modelCount=0;function showFlowerModelDiv(e){document.getElementById("flowerViewer").src="front/objects/flowersMbayeScene/flowers3D/"+e+".glb",document.getElementById("flowerModelDiv").style.visibility="visible"}$("#flowerModelDiv #rightArrow").on("click",function(e){let o=rFoot3DFlowersMap.get(currFootFlower),t=o.length;showFlowerModelDiv(modelCount<t-1?o[++modelCount]:o[modelCount=0])}),$("#flowerModelDiv #leftArrow").on("click",function(e){modelCount--;let o=rFoot3DFlowersMap.get(currFootFlower),t=o.length;showFlowerModelDiv(modelCount<0?o[modelCount=t-1]:o[modelCount])}),$("#MbayeHeadinfoIcon").on("click",function(){show_overlay_text()});let isIns2Active=!1;function set_circle_type(){try{isIns2Active?(circleType=new CircleType(document.getElementById("textCurve")),circleType3=new CircleType(document.getElementById("textCurve2")),circleType1=new CircleType(document.getElementById("textCurveanticlock")),circleType2=new CircleType(document.getElementById("textCurveanticlock2")),circleType.radius(150).dir(-1),circleType3.radius(150).dir(-1),circleType1.radius(200),circleType2.radius(200)):(circleType.destroy(),circleType1.destroy(),circleType2.destroy(),circleType3.destroy())}catch(e){}}function show_overlay_text(){currFlower?($("#footInstruction").toggle(),$("#footTextMiddle").toggle(),$("#footTextdown").toggle()):($("#flowerInstruction").toggle(),$("#infoIconTextflowers").toggle(),$("#infoIconTextdownflower").toggle(),isIns2Active=!isIns2Active,$("#textCurve").toggle(),$("#textCurve2").toggle(),$("#textCurveanticlock").toggle(),$("#textCurveanticlock2").toggle(),set_circle_type())}function set_instructions_overlay(e){1==e&&($("#flowerInstruction").hide(),$("#infoIconTextflowers").hide(),$("#infoIconTextdownflower").hide(),$("#textCurve").hide(),$("#textCurve2").hide(),$("#textCurveanticlock").hide(),$("#textCurveanticlock2").hide(),isIns2Active=!1,set_circle_type())}