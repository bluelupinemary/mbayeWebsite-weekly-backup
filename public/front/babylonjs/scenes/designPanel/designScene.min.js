let designLight,designCamera,panelCamera,designScene,mbayeDesign_object,returnPanel_btn,theDesignMesh,designSkybox,designGizmoManager,bookFlowers_object,panelInitScale,timeoutID,focusCamera,bookTask,panelFlowerBox,designOrigFlower,overHighlight,cameraPosForRightPanelsPos={x:-81,y:17,z:111},cameraPosForLeftPanelsPos={x:29,y:17,z:-87},panelInitPos={x:0,y:0,z:0},panelInitRot={x:0,y:0,z:0,w:0},isPanelReturned=!1,isPanelCameraMoving=!1,isPanelMovementDone=!1,isDesignSceneActive=!1,isCurrentPanelInLocation=!1,mbayeDesignInitPos={x:-5.5129,y:.7417,z:1.3953},isReturnPanelBtnActive=!0,isBookFlowersActive=!1,flowersPanelsMap=new Map,theCurrentPanel={obj:null,isActive:!1,isDragPanelAttached:!1,initPos:null,isDelta1:!1},currentPanel=null,isPanelMeshClicked=!1,isAnimatePanelOn=!1,currentPanelPos={x:-23.05,y:.32,z:6},currentPanelDesignPos=new Map([[0,{x:-23.05,y:.32,z:6}],[1,{x:-23.05,y:.32,z:5.7}]]),isPanelRotationActive=!1,isStartOfDesignPanel=!1,isCurrPanelClicked=!1,currentPosition={x:0,y:0},currentRotation={x:0,y:0},lastAngleDiff={x:0,y:0},oldAngle={x:0,y:0},newAngle={x:0,y:0},mousemov=!1,framecount=0,mxframecount=120,flowerSelectionCount=0,selectedFlowersMap=new Map,flowerVarietyArr=[],theCurrentFlower={obj:null,hasParent:!1,initPos:{x:467.9,y:25.15,z:150.25}},panelsWithFlowersCount=0,isEarthButtonClicked=!1,bookFlowersInitPos={x:461.19,y:24.22,z:150.54},bookFlowersInitRot={x:.0987,y:.8133,z:.2029,w:-.5354},isLightsDisabled=!1,panelFlowerBoxInitPos={x:0,y:-.2459,z:0,w:.969},isMbayeModelReady=!1,isBookFlowerReady=!1,panelPointerDragBehavior=new BABYLON.PointerDragBehavior({dragPlaneNormal:new BABYLON.Vector3(1,1,1)}),charPointerDragBehavior=new BABYLON.PointerDragBehavior({dragPlaneNormal:new BABYLON.Vector3(1,1,1)}),isOpenBookFlowers=!1,isGizmoDragging=!1,isRuruClicked=!1,modified_panels_list=new Map,panels_from_db=new Map,is_design_saved=null;function create_design_scene(){(designScene=new BABYLON.Scene(engine)).enableSceneOffline=!0,BABYLON.Database.IDBStorageEnabled=!0;try{designCamera=create_design_camera(),designLight=create_design_light(),create_design_skybox(),create_design_hdr(designScene);create_design_focusCamera().then(function(e){focusCamera=e});create_orig_flower(),create_panel_box(),load_design_meshes()}catch(e){}add_designScene_mouse_listener(),designScene.autoClear=!1,overHighlight=new BABYLON.HighlightLayer("hoverHighlight",designScene);let e=user_panels.split(",");for(const n of e)panels_from_db.set(n,null);return designScene}function create_design_camera(){let e=new BABYLON.ArcRotateCamera("Design Camera",BABYLON.Tools.ToRadians(25),BABYLON.Tools.ToRadians(85),110,new BABYLON.Vector3(0,0,0),designScene);return e.checkCollisions=!0,e.target=new BABYLON.Vector3(-30,5,10),e.angularSensibilityX=2e3,e.angularSensibilityY=2e3,e.pinchPrecision=2,designScene.activeCamera=e,e.lowerRadiusLimit=1,e.upperRadiusLimit=300,e.wheelPrecision=5,camera2=new BABYLON.ArcRotateCamera("Screenshot",BABYLON.Tools.ToRadians(25),BABYLON.Tools.ToRadians(85),105,new BABYLON.Vector3(0,0,0),designScene),panelCamera=new BABYLON.ArcRotateCamera("Panel Camera",BABYLON.Tools.ToRadians(25),BABYLON.Tools.ToRadians(85),110,new BABYLON.Vector3(0,0,0),designScene),e}function create_design_light(){let e=new BABYLON.HemisphericLight("designHemiLight",new BABYLON.Vector3(.5,5,-2),designScene);return e.radius=500,e.specular=new BABYLON.Color3(0,0,0),e.diffuse=new BABYLON.Color3(1,1,1),e.groundColor=new BABYLON.Color3(0,0,0),e.intensity=1,e}async function create_design_skybox(){(designSkybox=BABYLON.MeshBuilder.CreateBox("designSkybox",{size:7e3},designScene)).backFaceCulling=!1,designSkybox.checkCollisions=!0,designSkybox.isPickable=!1,designSkybox.rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(-30),0);let e=new BABYLON.StandardMaterial("designSkyboxMaterial",designScene);e.backFaceCulling=!1;e.reflectionTexture=new BABYLON.CubeTexture.CreateFromImages(["front/finalSkybox/px.png","front/finalSkybox/py.png","front/finalSkybox/pz.png","front/finalSkybox/nx.png","front/finalSkybox/ny.png","front/finalSkybox/nz.png"],designScene),e.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,e.disableLighting=!0,e.specular=new BABYLON.Vector3(0,0,0),designSkybox.material=e}async function create_design_hdr(e){let n=await new BABYLON.CubeTexture.CreateFromPrefilteredData("front/textures/dds/environment.dds",e);n.gammaSpace=!1,n.level=.5,e.environmentTexture=n}async function create_design_focusCamera(){let e=await new BABYLON.ArcRotateCamera("Panel Camera",BABYLON.Tools.ToRadians(0),BABYLON.Tools.ToRadians(0),70,new BABYLON.Vector3(469,23,167),designScene);return e.viewport=new BABYLON.Viewport(0,0,1,1),e.fov=focusCameraDesignFOV,e.fovMode=BABYLON.Camera.FOVMODE_HORIZONTAL_FIXED,e}var mbayePanelsMeshes=[];let nuvolaSpeechCloud,currCharSelected;function load_design_meshes(){Promise.all([BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/designScene/mbaye/","mbaye062020-2.babylon",designScene).then(function(e){e.meshes[0].position=new BABYLON.Vector3(-5.252,1.5579,.9552),e.meshes[0].rotationQuaternion=new BABYLON.Quaternion(.0017,.9644,-.0058,.2641);for(let n=0;n<e.meshes.length;n++){if("BODYPIPES"===e.meshes[n].name||"HEAD"===e.meshes[n].name||"TAIL"===e.meshes[n].name){let o=new BABYLON.PBRMaterial("pbr",designScene);e.meshes[n].material=o,e.meshes[n].material.backFaceCulling=!1,o.albedoColor=new BABYLON.Color3(.5,.5,.5),o.emissiveColor=new BABYLON.Color3(0,0,0),o.metallic=1,o.metallicF0Factor=.5,o.roughness=.15,o.microSurface=1}else if(mbayePanelsMap.has(e.meshes[n].name)){if(e.meshes[n].material){let o=new BABYLON.PBRMaterial("panelMatl"+n,designScene);o.diffuseColor=BABYLON.Color3.Black(),o.alpha=.1,o.metallic=1,o.roughness=.06,o.reflectivityColor=new BABYLON.Color3(1,1,1),e.meshes[n].material=o,e.meshes[n].isPickable=!0,mbayePanelsMap.set(e.meshes[n].name,e.meshes[n]);let t={};t.pos=e.meshes[n].position,t.rot=e.meshes[n].rotationQuaternion}}else"R_EYE"!==e.meshes[n].name&&"L_EYE"!==e.meshes[n].name||(e.meshes[n].material.subMaterials[2].emissiveColor=new BABYLON.Color3(.5,.5,.5));n===e.meshes.length-1&&(isMbayeModelReady=!0)}mbayeDesign_object=e.meshes[0]}),BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/designScene/seaObjects/nuvola/","nuvolaSwimming.babylon",designScene).then(function(e){nuvolaDesign_obj=e.meshes[0],nuvolaDesign_obj.scaling=new BABYLON.Vector3(.07,.07,.07),nuvolaDesign_obj.position=new BABYLON.Vector3(12.5,-8.3,55.92),nuvolaDesign_obj.rotationQuaternion=new BABYLON.Quaternion(.057,-.4064,.0516,.9102),nuvolaDesign_obj.isPickable=!0}),BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/designScene/seaObjects/ruru/","ruruAnimated.babylon",designScene).then(function(e){e.meshes[0].scaling=new BABYLON.Vector3(.3,.3,.3),e.meshes[0].position=new BABYLON.Vector3(59,8.5,9),e.meshes[0].rotationQuaternion=new BABYLON.Quaternion(.6481,-.3413,.2794,.6202),ruruDesign_obj=e.meshes[0],ruruDesign_obj.isPickable=!0}),BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/designScene/book/","bookFlowersDesign.glb",designScene).then(function(e){e.meshes.forEach(e=>{"wood001_primitive0"===e.name||"wood001_primitive1"===e.name?(e.scaling=new BABYLON.Vector3(2,2,2),add_action_mgr(e)):"wood"===e.name?(e.scaling=new BABYLON.Vector3(.8,.8,-.8),add_action_mgr(e)):"postBottom_primitive0"!==e.name&&"postBottom_primitive1"!==e.name&&"postTop_primitive0"!==e.name&&"postTop_primitive1"!==e.name||(e.scaling=new BABYLON.Vector3(1.25,1.25,1.25),add_action_mgr(e),"postBottom_primitive1"!==e.name&&"postTop_primitive1"!==e.name||(e.isPickable=!1))}),e.animationGroups[0].loopAnimation=!1,e.meshes[0].position=new BABYLON.Vector3(461.19,24.22,150.54),e.meshes[0].rotationQuaternion=new BABYLON.Quaternion(.0987,.8133,.2029,-.5354),e.meshes[0].scaling=new BABYLON.Vector3(.012,.012,-.012),(bookFlowers_object=e.meshes[0]).isPickable=!1,bookFlowers_object.isVisible=!1,bookFlowers_object.setEnabled(!1),bookLabel=e.meshes[20],bookLeftPages=e.meshes[16],bookRightPages=e.meshes[22],bookTask=e})]).then(()=>{isBookFlowerReady=!0,enable_design_utility(),listen_to_panel_rotation(),listen_to_wheelscroll(),enable_home_gizmo2(),create_cloud_speeches()})}function enable_home_gizmo2(){designUtilLayer=new BABYLON.UtilityLayerRenderer(designScene),designUtilLayer.utilityLayerScene.autoClearDepthAndStencil=!1,homeGizmo=new BABYLON.RotationGizmo(designUtilLayer),homeGizmo2=new BABYLON.PositionGizmo(designUtilLayer),homeGizmo2.scaleRatio=1.5}function set_current_panel_color(e,n){1==n?(e.material.microSurface=1,e.material.reflectivityColor=new BABYLON.Color3(1,1,1),e.material.disableLighting=!0,e.material.albedoColor=new BABYLON.Color3(.5,.5,.5),e.material.emissiveColor=new BABYLON.Color3(0,0,0),e.material.metallic=1,e.material.roughness=.15,e.material.alpha=1,e.material.ambientColor=new BABYLON.Color3(0,0,0),e.material.backFaceCulling=!1):(e.material.alpha=.1,e.material.metallic=1,e.material.roughness=.06,e.material.reflectivityColor=new BABYLON.Color3(1,1,1))}function set_current_panel(e){if(theCurrentPanel.isActive){theCurrentPanel.obj.getChildren().length<1?(set_current_panel_color(theCurrentPanel.obj,2),set_current_panel_color(e,1)):set_current_panel_color(e,1)}else set_current_panel_color(e,1);theCurrentPanel.obj=e,theCurrentPanel.initPos=e.position,theCurrentPanel.isActive=!0,panelInitPos.x=e.position.x,panelInitPos.y=e.position.y,panelInitPos.z=e.position.z,panelInitScale=e.scaling,currentPanel=e}function create_panel_box(){(panelFlowerBox=BABYLON.Mesh.CreateBox("FlowerBox",5,designScene)).position=new BABYLON.Vector3(467.75,24.43,152.02),panelFlowerBox.rotationQuaternion=new BABYLON.Quaternion(0,-.2459,0,.969),panelFlowerBox.scaling=new BABYLON.Vector3(1.8,1.8,1.5),panelFlowerBox.material=new BABYLON.StandardMaterial("flowerBoxMatl",designScene),panelFlowerBox.material.diffuseColor=BABYLON.Color3.White(),panelFlowerBox.material.alpha=0,panelFlowerBox.isPickable=!1}function create_cloud_speeches(){ruruSpeechCloud=init_image("ruruSpeech1","front/images3D/designScene/ruruDesign1.png",14,20,1,{x:54.8,y:20.9,z:15.6},{x:.0028,y:-.8282,z:.0128,w:.5599}),nuvolaSpeechCloud=init_image("nuvolaSpeech1","front/images3D/designScene/nuvolaDesign1.png",14,20,1,{x:34.53,y:10.21,z:52.4},{x:.0161,y:-.6941,z:-.0069,w:.7191}),ruruSpeech2=init_image("ruruSpeech2","front/images3D/designScene/ruruDesign2.png",14,20,1,{x:394.5,y:51,z:120.6},{x:-.0593,y:-.838,z:-.0787,w:.5366}),ruruSpeech3=init_image("ruruSpeech3","front/images3D/designScene/ruruDesign3.png",14,20,1,{x:394.5,y:51,z:120.6},{x:-.0593,y:-.838,z:-.0787,w:.5366}),nuvolaSpeech2=init_image("nuvolaSpeech2","front/images3D/designScene/nuvolaDesign2.png",14,20,1,{x:396.8,y:21.42,z:160.54},{x:-.0242,y:-.7339,z:-.0253,w:.6782}),nuvolaSpeech3=init_image("nuvolaSpeech3","front/images3D/designScene/nuvolaDesign3.png",14,20,1,{x:510.81,y:48.43,z:90.73},{x:.0372,y:.964,z:.1858,w:.1847}),nuvolaSpeech3.isVisible=!1}function init_image(e,n,o,t,i,a,r){var s=BABYLON.MeshBuilder.CreatePlane(e,{height:o,width:t},designScene);s.scaling=new BABYLON.Vector3(i,i,i),s.position=new BABYLON.Vector3(a.x,a.y,a.z),s.rotationQuaternion=new BABYLON.Quaternion(r.x,r.y,r.z,r.w);var l=new BABYLON.StandardMaterial(e+"matl",designScene);return l.diffuseTexture=new BABYLON.Texture(n,designScene),l.opacityTexture=new BABYLON.Texture(n,designScene),l.ambientColor=new BABYLON.Color3(1,1,1),l.emissiveColor=new BABYLON.Color3(.5,.5,.5),l.diffuseTexture.hasAlpha=!0,s.material=l,s}function check_if_mesh_is_flower(e){let n=e.uniqueId,o=selectedFlowersMap.has(n),t=!1;return flowersPanelsMap.has(currentPanel)&&(t=flowersPanelsMap.get(currentPanel).has(n)),!(!o&&!t)}function check_if_mesh_is_flower_variety(e){for(let n of flowerVarietyMap.values())if(n===e)return!0;return!1}let flowerCtr=0;function create_black_flower_copy(e){e.makeGeometryUnique();let n=e.clone(e.name);n.material=e.material.clone(e.name+flowerCtr+"Matl"),n.material.id=n.material.name,n.material.emissiveColor=BABYLON.Color3.Green(),flowerCtr++;let o=!1;designScene.activeCamera,e.parent===bookLeftPages&&(o=!0),o?(n.position.y+=50,n.position.x-=50,n.rotation=new BABYLON.Vector3(BABYLON.Tools.ToRadians(155),BABYLON.Tools.ToRadians(0),BABYLON.Tools.ToRadians(0)),n.setParent(null)):(n.position.y+=2.5,n.position.x+=.1),flowerSelectionCount++,theCurrentFlower.obj&&(theCurrentFlower.obj.showBoundingBox=!1),designGizmoManager.positionGizmoEnabled=!0,designGizmoManager.attachToMesh(n),theCurrentFlower.obj=n,theCurrentFlower.obj.showBoundingBox=!0,selectedFlowersMap.set(n.uniqueId,n),set_gizmo_style("#positionGizmo"),$("#gizmoToolsDiv").css("display","flex"),designGizmoManager.positionGizmoEnabled=!0,designGizmoManager.attachToMesh(n)}function create_black_flower(e,n,o,t,i,a,r){let s=BABYLON.Mesh.CreatePlane(e,t,designScene);s.isVisible=!1,s.makeGeometryUnique(),s.position=new BABYLON.Vector3(i,a,r),s.rotation.y=BABYLON.Tools.ToRadians(-120);let l=new BABYLON.StandardMaterial(n,designScene);return l.diffuseColor=BABYLON.Color3.Green(),l.diffuseTexture=new BABYLON.Texture(o,designScene),l.diffuseTexture.hasAlpha=!0,l.specularColor=new BABYLON.Color3(0,0,0),l.emissiveColor=BABYLON.Color3.Green(),l.backFaceCulling=!1,s.material=l,add_action_mgr(s),s}function add_flower_to_panel(){let e=theCurrentFlower.obj.uniqueId,n=flowersPanelsMap.get(currentPanel);n.set(e,theCurrentFlower.obj),flowersPanelsMap.set(currentPanel,n),theCurrentFlower.obj.parent&&flowerSelectionCount--}function remove_flower_from_panel(e){let n=flowersPanelsMap.get(currentPanel);theCurrentFlower.obj.parent&&flowerSelectionCount++,n.delete(e,theCurrentFlower.obj),flowersPanelsMap.set(currentPanel,n)}function open_book_of_flowers(e){set_orig_flower(e),set_flower_field(e),set_flower_label(e),designScene.activeCamera===focusCamera&&set_book_flowers_position(),bookTask.animationGroups[0].reset(),bookTask.animationGroups[0].play(),bookFlowers_object.setEnabled(!0),bookFlowers_object.isVisible=!0,isOpenBookFlowers=!0}function set_book_flowers_position(){bookFlowers_object.position=1.2===focusCameraDesignFOV?new BABYLON.Vector3(468.72,23.31,145.86):1.25===focusCameraDesignFOV?new BABYLON.Vector3(469.31,23.59,145.2):1.3===focusCameraDesignFOV?new BABYLON.Vector3(469.28,23.85,144.6):1.5===focusCameraDesignFOV?new BABYLON.Vector3(469.26,24.14,143.95):focusCameraBookPosition}function remove_book_of_flowers(){for(let e of flowerVarietyMap.values())e.dispose();flowerVarietyMap.clear();for(let e of selectedFlowersMap.values())e.parent===bookLeftPages&&e.setParent(null);isBookFlowersActive&&(designOrigFlower.isVisible=!1,designOrigFlower.setEnabled(!1),designOrigFlower.scaling=new BABYLON.Vector3(.1,.1,.1),bookTask.meshes[19].scaling=new BABYLON.Vector3(.1,.1,-.1),designOrigFlower&&(designOrigFlower.material.dispose(),bookLabel.material.dispose()),bookFlowers_object.setEnabled(!1),bookFlowers_object.isVisible=!1,designScene.activeCamera===focusCamera?bookFlowers_object.position=focusCameraBookPosition:designScene.activeCamera===panelCamera&&(bookFlowers_object.position=bookFlowersInitPos),isBookFlowersActive=!1)}function delete_flower_selected(e){let n=flowersPanelsMap.get(currentPanel),o=e.uniqueId;if(e.parent===currentPanel){n.get(o).dispose(),n.delete(o),flowersPanelsMap.set(currentPanel,n)}else e.setParent(null),e.dispose(),flowerSelectionCount--;selectedFlowersMap.delete(o),designGizmoManager.attachToMesh(null)}function remove_flowers_not_in_panel(e){for(const[e,n]of selectedFlowersMap.entries()){flowersPanelsMap.get(currentPanel).has(e)||(n.dispose(),selectedFlowersMap.delete(e),flowerSelectionCount--)}let n=flowersPanelsMap.get(currentPanel);for(let o of n.values())o.showBoundingBox&&(o.showBoundingBox=!1),e&&(o.isPickable=!1);n.size>0&&panelsWithFlowersCount++,designGizmoManager.attachToMesh(null),selectedFlowersMap.clear()}let returnPanel=e=>{show_saving_alert()};function set_flower_field(e){let n=new BABYLON.StandardMaterial("flowerFieldMatl",designScene);n.diffuseTexture=new BABYLON.Texture("front/images3D/flowers2D/field/"+e+".png",designScene),n.specularColor=new BABYLON.Color3(0,0,0),n.backFaceCulling=!1,bookLeftPages.material=n,bookRightPages.material=n}function create_orig_flower(){let e=BABYLON.Mesh.CreatePlane("origFlower",2,designScene);e.position=new BABYLON.Vector3(467.71,19.9,153.5),e.rotationQuaternion=new BABYLON.Quaternion(.5406,-.2502,.7903,.1409),e.scaling=new BABYLON.Vector3(.1,.1,.1),e.isVisible=!1,e.setEnabled(!1),designOrigFlower=e}function create_post_labels(){let e=BABYLON.Mesh.CreatePlane("postTop",2,designScene);e.position=new BABYLON.Vector3(0,0,0);let n=new BABYLON.StandardMaterial("postTopMatl",designScene);n.diffuseTexture=new BABYLON.Texture("images/postTop.png",designScene),n.diffuseTexture.hasAlpha=!0,n.specularColor=new BABYLON.Color3(0,0,0),n.backFaceCulling=!1,e.material=n}function set_flower_label(e){let n=new BABYLON.StandardMaterial("labelMatl",designScene);n.diffuseTexture=new BABYLON.Texture("front/images3D/flowers2D/label/"+e+".png",designScene),n.diffuseTexture.hasAlpha=!0,n.diffuseTexture.uScale=-3.4,n.diffuseTexture.vScale=-8,n.diffuseTexture.uOffset=-.77,n.diffuseTexture.vOffset=-1.08,n.specularColor=new BABYLON.Color3(0,0,0),n.backFaceCulling=!1,bookLabel.material=n}function set_orig_flower(e){designOrigFlower.setParent(bookLeftPages);let n=new BABYLON.StandardMaterial(e,designScene);n.diffuseTexture=new BABYLON.Texture("front/images3D/flowers2D/orig/"+e+".png",designScene),n.diffuseTexture.hasAlpha=!0,n.specularColor=new BABYLON.Color3(0,0,0),n.backFaceCulling=!1,n.diffuseTexture.uScale=-1,designOrigFlower.material=n,designOrigFlower.position=new BABYLON.Vector3(122.22,86.6,-13.85),designOrigFlower.rotationQuaternion=new BABYLON.Quaternion(-.0326,-.0415,.9982,.0275),designOrigFlower.isVisible=!0,designOrigFlower.setEnabled(!0)}let screenshotData,flowerVarietyMap=new Map;function load_design_flower_versions(e){let n=e.length;for(let o=0;o<n;o++){let n=blackFlowerPositionMap.get(o).x,t=blackFlowerPositionMap.get(o).y,i=blackFlowerPositionMap.get(o).z;designScene.activeCamera===focusCamera&&(n=blackFlowerPositionMap_focus.get(o).x,t=blackFlowerPositionMap_focus.get(o).y,i=blackFlowerPositionMap_focus.get(o).z);let a=create_black_flower(e[o],e[o]+"_matl","front/images3D/flowers2D/"+e[o]+".png",1,n,t,i);flowerVarietyMap.set(a.name,a),designScene.activeCamera===focusCamera&&(a.rotationQuaternion=new BABYLON.Quaternion(.009,.9778,.2058,-.0194),a.setParent(bookLeftPages))}isBookFlowersActive=!0}function set_flowers_to_pickable(){let e,n=flowersPanelsMap.has(currentPanel);currentPanel.uniqueId;if(n){e=flowersPanelsMap.get(currentPanel);for(let n of e.values())n.isPickable=!0}}function show_book_flowers(e){bookFlowers_object.isVisible=e,bookFlowers_object.setEnabled(e);for(let n of flowerVarietyMap.values())n.isVisible=e}function show_nuvola(e){designScene.activeCamera===panelCamera?e?nuvolaDesign_obj.position.z-=100:nuvolaDesign_obj.position.z+=100:(nuvolaSpeech3.isVisible=e,nuvolaSpeech3.setEnabled(e)),nuvolaSpeechCloud.isVisible=e,nuvolaSpeechCloud.setEnabled(e),nuvolaSpeech2.isVisible=e,nuvolaSpeech2.setEnabled(e)}function show_ruru(e){ruruDesign_obj.isVisible=e,ruruSpeechCloud.isVisible=e,ruruSpeechCloud.setEnabled(e),ruruSpeech2.isVisible=e,ruruSpeech2.setEnabled(e),ruruSpeech3.isVisible=e,ruruSpeech3.setEnabled(e)}function take_panel_screenshot(){let e="";if(currentPanel&&(e=currentPanel.name),designScene.activeCamera===panelCamera||designScene.activeCamera===focusCamera){let n;n=designScene.activeCamera===panelCamera?camera2:focusCamera,show_book_flowers(!1),show_ruru(!1),show_nuvola(!1),BABYLON.Tools.CreateScreenshotUsingRenderTarget(engine,n,{width:1024,height:650,precision:1},function(n){modified_panels_list.has(e)||panels_from_db.has(e)?($("#modalScreenshot").css({"background-image":"url("+n+")"}),$("#showScreenshotModal").modal("show"),screenshotData=n):selectedFlowersMap.size>0?($("#modalScreenshot").css({"background-image":"url("+n+")"}),$("#showScreenshotModal").modal("show"),screenshotData=n):Swal.fire({width:"10vw",padding:"3em",background:"rgba(8, 64, 147, 0.6) url(front/images3D/designScene/trevorSaved.png) ",title:'<br/><br/><br/><span style="color:red; padding-top:20%;">Please save or design your panel first! Click Ruru to save your progress.</span>',showConfirmButton:!1,position:"top-end",allowOutsideClick:!1,timer:3e3,customClass:{popup:"trevor-popup-class"}})}),isOpenBookFlowers&&show_book_flowers(!0),show_ruru(!0),show_nuvola(!0)}else designScene.activeCamera===designCamera&&BABYLON.Tools.CreateScreenshotUsingRenderTarget(engine,designCamera,{width:1600,height:800,precision:1},function(e){$("#modalScreenshot").css({"background-image":"url("+e+")"}),$("#showScreenshotModal").modal("show"),screenshotData=e})}let theReturnedPanel,isDesignMermaidActive=!1;async function returnPanelViaButton(){if(!isPanelReturned&&isStartOfDesignPanel){$("#takeScreenshotMain").show(),$("#takeScreenshotPanel").hide(),$("#gizmoToolsDiv").hide(),designLight.direction=new BABYLON.Vector3(.5,5,-2),designScene.activeCamera=panelCamera,remove_flowers_not_in_panel(!0),remove_book_of_flowers(),bookFlowers_object.isVisible=!1,bookFlowers_object.setEnabled(!1),bookFlowers_object.position=bookFlowersInitPos,bookFlowers_object.rotationQuaternion=bookFlowersInitRot;let e=theCurrentPanel.obj;e.showBoundingBox&&(e.showBoundingBox=!1),e.position=new BABYLON.Vector3(panelInitPos.x,panelInitPos.y,panelInitPos.z),e.rotation=panelInitRot,e.scaling=panelInitScale,mbayeDesign_object.scaling=new BABYLON.Vector3(1,1,1),mbayeDesign_object.position=mbayeDesignInitPos,flowerSelectionCount=0,await animatePanelCameraToRadius(panelCamera,50,100,100),isDesignSceneActive=!1,isStartOfDesignPanel=!1,isPanelRotationActive=!1,designGizmoManager.attachToMesh(null),earthFlowersCamera&&earthFlowersCamera.detachControl(canvas),earthFlowers_object.setEnabled(!1),earthFlowers_object.isVisible=!1,set_instructions_overlay(1),set_instructions_overlay(2),set_instructions_overlay(3),set_instructions_overlay(4),theCurrentPanel.obj.getChildren().length<1?set_current_panel_color(e,2):modified_panels_list.set(e.name,null),panels_from_db.has(e.name)&&modified_panels_list.set(e.name,null);let n=theCurrentPanel.obj.position.z;return theCurrentPanel.obj=null,theCurrentPanel.isActive=!1,theCurrentFlower.obj=null,flowersPanelsMap.size>=1&&((designCamera=new BABYLON.ArcRotateCamera("Design Camera",BABYLON.Tools.ToRadians(25),BABYLON.Tools.ToRadians(85),110,new BABYLON.Vector3(0,0,0),designScene)).checkCollisions=!0,designCamera.target=new BABYLON.Vector3(-30,5,10),designCamera.lowerRadiusLimit=1,designCamera.upperRadiusLimit=300,set_chars_position(1),set_clouds_position(1),nuvolaSpeech3.isVisible=!1,nuvolaSpeech3.setEnabled(!1),designCamera.position=n>0?cameraPosForLeftPanelsPos:cameraPosForRightPanelsPos),e.material.emissiveColor=BABYLON.Color3.Green(),setTimeout(function(){e.material.emissiveColor=new BABYLON.Color3(0,0,0)},7e3),currentPanel=null,designCamera.attachControl(canvas,!0),!0}return isPanelReturned=!1,!1}function focus_on_panel(){if(bookFlowers_object.isVisible&&(theCurrentFlower.obj&&!theCurrentFlower.obj.parent&&(theCurrentFlower.obj=null,theCurrentFlower.hasParent=!1),remove_flowers_not_in_panel(!1)),designScene.activeCamera!==focusCamera&&isStartOfDesignPanel){currentPanel&&(panelFlowerBox.rotationQuaternion=new BABYLON.Quaternion(0,-.0077,0,.9996));for(let e of flowerVarietyMap.values())e.setParent(bookLeftPages),e.rotationQuaternion=new BABYLON.Quaternion(.9683,.0015,-.1033,.2269);set_chars_position(3),set_clouds_position(3);let e=panelDesignRotation.get(theCurrentPanel.obj.name)[0];theCurrentPanel.obj.rotation.y=e[1]+BABYLON.Tools.ToRadians(-55),focusCamera.target=currentPanel,focusCamera.targetScreenOffset=new BABYLON.Vector2(0,1),designLight.direction=new BABYLON.Vector3(-500,300,100),focusCamera.alpha=1.5594,focusCamera.beta=1.6239,focusCamera.radius=12,designScene.activeCamera=focusCamera,set_book_flowers_position(),bookFlowers_object.rotationQuaternion=new BABYLON.Quaternion(.009,.9778,.2058,-.0194)}else{currentPanel&&(panelFlowerBox.rotationQuaternion=panelFlowerBoxInitPos);for(let e of flowerVarietyMap.values())e.setParent(bookLeftPages);designLight.direction=new BABYLON.Vector3(.5,5,-2),set_chars_position(2),set_clouds_position(2);let e=panelDesignRotation.get(theCurrentPanel.obj.name)[0];null!==e&&(theCurrentPanel.obj.rotation=new BABYLON.Vector3(e[0],e[1],e[2])),bookFlowers_object.position=bookFlowersInitPos,bookFlowers_object.rotationQuaternion=bookFlowersInitRot,designScene.activeCamera=panelCamera}theCurrentFlower.obj=null,theCurrentFlower.hasParent=!1}function enable_panel_rotation(e){new BABYLON.PlaneRotationGizmo(new BABYLON.Vector3(0,0,1),BABYLON.Color3.FromHexString("#00b894")).attachedMesh=e}function enable_design_utility(){(designGizmoManager=new BABYLON.GizmoManager(designScene)).attachableMeshes=[],designGizmoManager.positionGizmoEnabled=!1,designGizmoManager.boundingBoxGizmoEnabled=!1,designGizmoManager.rotationGizmoEnabled=!1,designGizmoManager.scaleGizmoEnabled=!1,document.onkeydown=(e=>{if(("p"==e.key||"P"==e.key||"R"==e.key||"r"==e.key||"s"==e.key||"S"==e.key||"o"==e.key||"O"==e.key||"Delete"==e.key)&&(designGizmoManager.positionGizmoEnabled=!1,designGizmoManager.rotationGizmoEnabled=!1,designGizmoManager.scaleGizmoEnabled=!1,designGizmoManager.boundingBoxGizmoEnabled=!1,null!==designGizmoManager._attachedMesh)){if("p"==e.key||"P"==e.key){var n=instruction_map.get(0);$("#overlayTxtBookUpperLeft2").html(n),design_handle_tool("#positionGizmo"),set_gizmo_style("#positionGizmo")}if("r"==e.key||"R"==e.key){n=instruction_map.get(1);$("#overlayTxtBookUpperLeft2").html(n),design_handle_tool("#rotationGizmo"),set_gizmo_style("#rotationGizmo")}if("s"==e.key||"S"==e.key){n=instruction_map.get(2);$("#overlayTxtBookUpperLeft2").html(n),design_handle_tool("#scaleGizmo"),set_gizmo_style("#scaleGizmo")}"o"!=e.key&&"O"!=e.key||(set_instructions_overlay(1),design_handle_tool("off"),set_gizmo_style("off")),"Delete"==e.key&&designGizmoManager._attachedMesh&&(delete_flower_selected(designGizmoManager._attachedMesh),theCurrentFlower.obj=null,theCurrentFlower.hasParent=!1)}}),document.onkeydown({key:"p"})}let currBtn,theFlowerWithGizmo,isCharMovementEnabled,isTakePhotoStatus=!1;function design_handle_tool(e){designGizmoManager&&("off"==e?(designGizmoManager.attachToMesh(null),theCurrentFlower.obj&&(theCurrentFlower.obj.showBoundingBox=!1,theCurrentFlower.obj=null,theCurrentFlower.hasParent=!1),isTakePhotoStatus&&(homeGizmo.attachedMesh=null,homeGizmo2.attachedMesh=null),designGizmoManager.positionGizmoEnabled=!1,designGizmoManager.boundingBoxGizmoEnabled=!1,designGizmoManager.rotationGizmoEnabled=!1,designGizmoManager.scaleGizmoEnabled=!1,$("#gizmoToolsDiv").hide()):"#rotationGizmo"==e?(designGizmoManager.positionGizmoEnabled=!1,designGizmoManager.boundingBoxGizmoEnabled=!1,designGizmoManager.rotationGizmoEnabled=!0,designGizmoManager.gizmos.rotationGizmo.onDragStartObservable.add(function(){isGizmoDragging=!0}),designGizmoManager.gizmos.rotationGizmo.onDragEndObservable.add(function(){isGizmoDragging=!1})):"#positionGizmo"==e?(designGizmoManager.boundingBoxGizmoEnabled=!1,designGizmoManager.rotationGizmoEnabled=!1,designGizmoManager.positionGizmoEnabled=!0,designGizmoManager.gizmos.positionGizmo.onDragStartObservable.add(function(){isGizmoDragging=!0,theFlowerWithGizmo=designGizmoManager.gizmos.positionGizmo.attachedMesh}),designGizmoManager.gizmos.positionGizmo.onDragEndObservable.add(function(){isGizmoDragging=!1})):"#scaleGizmo"==e?(designGizmoManager.positionGizmoEnabled=!1,designGizmoManager.rotationGizmoEnabled=!1,designGizmoManager.boundingBoxGizmoEnabled=!0,designGizmoManager.gizmos.boundingBoxGizmo.setEnabledRotationAxis("xyz"),designGizmoManager.gizmos.boundingBoxGizmo.setEnabledScaling(!0,!0),designGizmoManager.gizmos.boundingBoxGizmo.onDragStartObservable.add(function(){isGizmoDragging=!0}),designGizmoManager.gizmos.boundingBoxGizmo.onScaleBoxDragEndObservable.add(function(){isGizmoDragging=!1}),designGizmoManager.gizmos.boundingBoxGizmo.onRotationSphereDragEndObservable.add(function(){isGizmoDragging=!1})):"delete"==e&&designGizmoManager._attachedMesh&&(delete_flower_selected(designGizmoManager._attachedMesh),theCurrentFlower.obj=null,theCurrentFlower.hasParent=!1))}let isFlowerDraggable,flowerStartingPoint,charLabel,woodSize,postTopWoodSize,postBotWoodSize,isDraggedPanelInLocation=!1,pickedPanelInitSpecs={pos:null,rot:null};function add_designScene_mouse_listener(){designScene.onPointerObservable.add(e=>{switch(e.type){case BABYLON.PointerEventTypes.POINTERUP:e.pickInfo.hit&&mbayePanelsMap.has(e.pickInfo.pickedMesh.name)&&!isPanelRotationActive&&(panelPointerDragBehavior.enabled=!0,panelPointerDragBehavior.moveAttached=!0,panelPointerDragBehavior.useObjectOrienationForDragging=!1,panelPointerDragBehavior.dragDeltaRatio=.2,panelPointerDragBehavior.attach(e.pickInfo.pickedMesh),e.pickInfo.pickedMesh.actionManager=new BABYLON.ActionManager(designScene),e.pickInfo.pickedMesh.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnDoublePickTrigger,returnPanel))),e.pickInfo.hit&&(e.pickInfo.pickedMesh===ruruDesign_obj||e.pickInfo.pickedMesh===nuvolaDesign_obj)&&designScene.activeCamera===designCamera&&isCharMovementEnabled&&(charPointerDragBehavior.enabled=!0,charPointerDragBehavior.moveAttached=!0,charPointerDragBehavior.useObjectOrienationForDragging=!1,charPointerDragBehavior.dragDeltaRatio=.2,charPointerDragBehavior.attach(e.pickInfo.pickedMesh))}});let e=function(e){if(0===e.button&&(2===e.button&&designScene.activeCamera===focusCamera&&focusCamera.attachControl(canvas,!0),designScene&&0===e.button)){let n=designScene.pick(designScene.pointerX,designScene.pointerY);if(n.hit){let t=check_if_mesh_is_flower(theDesignMesh=n.pickedMesh);if(designScene.activeCamera===designCamera&&!t&&mbayePanelsMap.has(theDesignMesh.name)&&(earthFlowersCamera.detachControl(canvas),null!=currentPanel&&theDesignMesh==theCurrentPanel.obj||(set_current_panel(theDesignMesh),$("#panelNoSpan").html(theDesignMesh.name)),isPanelMeshClicked=!0),designScene.activeCamera===designCamera&&isTakePhotoStatus&&(theDesignMesh!==ruruDesign_obj&&theDesignMesh!==nuvolaDesign_obj||(homeGizmo.attachedMesh=theDesignMesh,homeGizmo2.attachedMesh=theDesignMesh)),designScene.activeCamera!==panelCamera||theDesignMesh!==ruruDesign_obj||isMobile()||(e.preventDefault(),Swal.fire({title:"Are you sure you want to save your current game progress?",text:"",imageUrl:"../../front/icons/alert-icon.png",imageWidth:"10vw",imageHeight:"auto",imageAlt:"Warning",showCancelButton:!0,allowOutsideClick:!1,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, save it!",width:"20%",padding:"1rem",background:"rgba(8, 64, 147, 0.62)",customClass:{popup:"ruru-popup-class"}}).then(e=>{e.value&&(returnPanelViaButton(),isRuruClicked=!0)})),bookFlowersMap.has(theDesignMesh.name)&&("wood"===theDesignMesh.name||"Object072"==theDesignMesh.name?remove_book_of_flowers():"postTop_primitive0"==theDesignMesh.name||"postTop_primitive1"==theDesignMesh.name?focus_on_panel():"postBottom_primitive0"==theDesignMesh.name||"postBottom_primitive1"==theDesignMesh.name?show_saving_alert():"wood001_primitive0"!=theDesignMesh.name&&"wood001_primitive1"!=theDesignMesh.name||(e.preventDefault(),take_panel_screenshot())),t&&!isGizmoDragging&&(earthFlowersCamera.detachControl(canvas),earthFlowersCamera.setEnabled(!1),theCurrentFlower.obj!=theDesignMesh?(theCurrentFlower.obj&&(theCurrentFlower.obj.showBoundingBox=!1),theCurrentFlower.hasParent=!1,theCurrentFlower.obj=theDesignMesh,theCurrentFlower.obj.showBoundingBox=!0,designGizmoManager.rotationGizmoEnabled=!1,isRotGizmoOn=!1,designGizmoManager.scalingGizmoEnabled=!1,isScaleGizmoOn=!1,designGizmoManager.positionGizmoEnabled=!0,designGizmoManager.attachToMesh(theDesignMesh),$("#gizmoToolsDiv").css("display","flex"),set_gizmo_style("#positionGizmo"),isPosGizmoOn=!0,o=!0):(theCurrentFlower.obj.showBoundingBox=!1,theCurrentFlower.obj=null,theCurrentFlower.hasParent=!1,o=!1)),isBookFlowersActive&&!isMobile()){if(earthFlowersCamera.detachControl(canvas),check_if_mesh_is_flower_variety(theDesignMesh)){create_black_flower_copy(theDesignMesh);let e=panelDesignRotation.get(theCurrentPanel.obj.name)[0];designScene.activeCamera===focusCamera?theCurrentPanel.obj.rotation=new BABYLON.Vector3(e[0],e[1]+BABYLON.Tools.ToRadians(-55),e[2]):theCurrentPanel.obj.rotation=new BABYLON.Vector3(e[0],e[1],e[2]),o=!0,set_instructions_overlay(4)}}}}},n=function(e){isPanelMeshClicked=!1,isStartOfDesignPanel||(isDraggedPanelInLocation?(set_current_panel_to_location(),isDraggedPanelInLocation=!1):currentPanel&&(currentPanel.position=new BABYLON.Vector3(panelInitPos.x,panelInitPos.y,panelInitPos.z)))},o=!0,t=function(e){if(isCurrentPanelInLocation&&o&&!isGizmoDragging){let e=designScene.pick(designScene.pointerX,designScene.pointerY);if(e.hit&&theCurrentFlower.obj&&currentPanel.name===e.pickedMesh.name&&(theCurrentFlower.obj.parent?theCurrentFlower.obj.setAbsolutePosition(new BABYLON.Vector3(e.pickedPoint.x,e.pickedPoint.y,e.pickedPoint.z+.1)):theCurrentFlower.obj.position=new BABYLON.Vector3(e.pickedPoint.x,e.pickedPoint.y,e.pickedPoint.z+.1),theCurrentFlower.obj.intersectsMesh(currentPanel,!0)&&!theCurrentFlower.obj.parent)){let e=theCurrentFlower.obj.scaling;theCurrentFlower.obj.scaling=e,theCurrentFlower.obj.setParent(currentPanel),add_flower_to_panel(),isFlowerRemoved=!1,theCurrentFlower.hasParent=!0}}if(isPanelMeshClicked&&currentPanel){let e=Math.abs(currentPanel.position.x-panelInitPos.x),n=Math.abs(currentPanel.position.y-panelInitPos.y),o=Math.abs(currentPanel.position.z-panelInitPos.z);isMobile()&&"Safari"===testBrowser()&&(e>=1||n>=1||o>=1)&&!isStartOfDesignPanel&&set_current_panel_to_location(),(e>=4&&e<=8||n>=4&&n<=8||o>=4&&o<=8)&&!isStartOfDesignPanel?isDraggedPanelInLocation=!0:(e>=8||n>=8||o>=8)&&!isStartOfDesignPanel?set_current_panel_to_location():isDraggedPanelInLocation=!1}};canvas.addEventListener("pointerdown",e,!1),canvas.addEventListener("pointerup",n,!1),canvas.addEventListener("pointermove",t,!1),designScene.onDispose=function(){canvas.removeEventListener("pointerdown",e),canvas.removeEventListener("pointerup",n),canvas.removeEventListener("pointermove",t)},designScene.beforeRender=function(){mousemov=!1},designScene.afterRender=function(){!mousemov&&framecount<mxframecount&&currentPanel?(lastAngleDiff.x=lastAngleDiff.x/1.1,lastAngleDiff.y=lastAngleDiff.y/1.1,currentPanel.rotation.x+=lastAngleDiff.x,currentPanel.rotation.y+=lastAngleDiff.y,framecount++,currentRotation.x=currentPanel.rotation.x,currentRotation.y=currentPanel.rotation.y):framecount>=mxframecount&&(framecount=0)}}function check_panel_flower_intersection(){let e=designGizmoManager._attachedMesh;if(e.intersectsMesh(currentPanel,!0)){if(!e.parent){let n=e.scaling;e.scaling=n,e.setParent(currentPanel),add_flower_to_panel(),isFlowerRemoved=!1,theCurrentFlower.hasParent=!0}return!0}return!1}function set_current_panel_to_location(){designCamera.detachControl(canvas),earthFlowersCamera.detachControl(canvas),ruruDesign_obj.actionManager||add_action_mgr(ruruDesign_obj),isAnimatePanelOn=!0,panelPointerDragBehavior.releaseDrag(),panelPointerDragBehavior.detach(),panelPointerDragBehavior.enabled=!1,panelPointerDragBehavior.moveAttached=!1,(panelCamera=new BABYLON.ArcRotateCamera("Panel Camera",BABYLON.Tools.ToRadians(25),BABYLON.Tools.ToRadians(85),130,new BABYLON.Vector3(0,0,0),designScene)).detachControl(canvas),panelCamera.fovMode=BABYLON.Camera.FOVMODE_HORIZONTAL_FIXED,panelCamera.fov=panelCameraDesignFOV,isPanelRotationActive=!0,isStartOfDesignPanel=!0,isCurrentPanelInLocation||(setTimeout(function(){panelInitRot=currentPanel.rotation,earthFlowers_object.setEnabled(!0),earthFlowers_object.isVisible=!0,designScene.activeCamera=panelCamera,panelCamera.target=new BABYLON.Vector3(0,7,20),panelCamera.viewport=new BABYLON.Viewport(0,0,1,1);Math.abs(currentPanel.scaling.x),Math.abs(currentPanel.scaling.y),Math.abs(currentPanel.scaling.z);earthFlowersCamera.position=new BABYLON.Vector3(-48,24,84),earthFlowersCamera.radius=earthCameraDesignRadius,set_chars_position(2),set_clouds_position(2),isDesignSceneActive=!0,isMobile()||set_flowers_to_pickable(),start_design_setup(),$("#takeScreenshotMain").hide(),isMobile()||$("#takeScreenshotPanel").show()},1e3),isCurrentPanelInLocation=!0)}function start_design_setup(){flowersPanelsMap.has(currentPanel)||flowersPanelsMap.set(currentPanel,new Map),panelCamera.radius=500,mbayeDesign_object.position=new BABYLON.Vector3(64.66,4.58,22.55),mbayeDesign_object.rotationQuaternion=new BABYLON.Quaternion(.0017,.9674,-.0057,.253),mbayeDesign_object.scaling=new BABYLON.Vector3(1.25,1.25,1.25),currentPanel.position=currentPanelPos;let e=panelDesignRotation.get(theCurrentPanel.obj.name)[0];null!==e?theCurrentPanel.obj.rotation=new BABYLON.Vector3(e[0],e[1],e[2]):currentPanel.rotation=new BABYLON.Vector3(-.9158,1.8938,0),isAnimatePanelOn=!1,isPanelMovementDone=!0,camera2&&(camera2.dispose(),camera2=new BABYLON.ArcRotateCamera("Screenshot",BABYLON.Tools.ToRadians(25),BABYLON.Tools.ToRadians(85),105,new BABYLON.Vector3(0,0,0),designScene));let n=panelCamera.position;camera2.position=new BABYLON.Vector3(n.x+15,n.y,n.z+10),camera2.setTarget(currentPanel),camera2.radius=20,set_instructions_overlay(2)}function listen_to_panel_rotation(){let e=function(e){if(0!==e.button)return;let n=designScene.pick(designScene.pointerX,designScene.pointerY);if(n.hit&&isStartOfDesignPanel){let o=!1;if(o=!!isMobile()||flowersPanelsMap.get(currentPanel).size>0){let o=n.pickedMesh;currentPanel&&currentPanel===o&&(currentPosition.x=e.clientX,currentPosition.y=e.clientY,currentRotation.x=currentPanel.rotation.x,currentRotation.y=currentPanel.rotation.y,isZoomPanelActive=!0,isCurrPanelClicked=!isGizmoDragging)}}},n=function(){isCurrPanelClicked=!1},o=function(e){if(isStartOfDesignPanel&&isCurrPanelClicked){if(panelCamera&&panelCamera.detachControl(canvas),isCurrPanelClicked&&(mousemov=!0,earthFlowersCamera.detachControl(canvas)),!isCurrPanelClicked)return;currentPanel&&isStartOfDesignPanel&&(oldAngle.x=currentPanel.rotation.x,oldAngle.y=currentPanel.rotation.y,currentPanel.rotation.y+=(e.clientX-currentPosition.x)/600,currentPanel.rotation.x+=(e.clientY-currentPosition.y)/600,newAngle.x=currentPanel.rotation.x,newAngle.y=currentPanel.rotation.y,lastAngleDiff.x=newAngle.x-oldAngle.x,lastAngleDiff.y=newAngle.y-oldAngle.y,currentPosition.x=e.clientX,currentPosition.y=e.clientY)}};canvas.addEventListener("pointerdown",e,!1),canvas.addEventListener("pointerup",n,!1),canvas.addEventListener("pointermove",o,!1),designScene.onDispose=function(){canvas.removeEventListener("pointerdown",e),canvas.removeEventListener("pointerup",n),canvas.removeEventListener("pointermove",o)}}function listen_to_wheelscroll(){designScene&&designScene.onPrePointerObservable.add(function(e,n){if(currentPanel&&(designScene.activeCamera==panelCamera||designScene.activeCamera==focusCamera)){panelCamera.detachControl(canvas),focusCamera.detachControl(canvas);let n=e.event,o=0;if(n.wheelDelta?o=n.wheelDelta:n.detail&&(o=-n.detail),o&&isZoomPanelActive){let e=currentPanel.scaling.x,n=currentPanel.scaling.y,t=currentPanel.scaling.z;o<0?currentPanel.scaling.x>.5?currentPanel.scaling=new BABYLON.Vector3(e-.05,n-.05,t-.05):currentPanel.scaling.x>.004&&currentPanel.scaling.x<.03&&(currentPanel.scaling=new BABYLON.Vector3(e-.001,n-.001,t-.001)):currentPanel.scaling.x<2&&currentPanel.scaling.x>.4?currentPanel.scaling=new BABYLON.Vector3(e+.05,n+.05,t+.05):currentPanel.scaling.x<.028&&(currentPanel.scaling=new BABYLON.Vector3(e+.001,n+.001,t+.001))}}},BABYLON.PointerEventTypes.POINTERWHEEL,!1)}function add_action_mgr(e){e.actionManager=new BABYLON.ActionManager(designScene),e.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOverTrigger,onOverChar)),e.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOutTrigger,onOutChar))}var onOverChar=e=>{if(designScene.activeCamera===designCamera&&isCharMovementEnabled&&(e.source.material.emissiveColor=new BABYLON.Color3(.2,.2,.2),"Mermaid_Body_Rev"===e.source.name&&(e.source.material.subMaterials[0].emissiveColor=new BABYLON.Color3(.2,.2,.2),e.source.material.subMaterials[1].emissiveColor=new BABYLON.Color3(.2,.2,.2))),designScene.activeCamera===panelCamera&&e.source===ruruDesign_obj){let o=document.createElement("span");o.setAttribute("id","partTooltip"),(n=o.style).position="absolute",n.paddingLeft="0.5%",n.paddingRight="0.5%",n.color="#00BFFF",n.fontFamily="Courgette-Regular",n.fontSize="2em",n.top=designScene.pointerY+"px",n.left=designScene.pointerX+20+"px",n.cursor="pointer",document.body.appendChild(o),o.textContent="Save Game",e.source.material.emissiveColor=new BABYLON.Color3(.4,.4,.4)}if(bookFlowersMap.has(e.source.name))if("wood001_primitive0"==e.source.name){woodSize=e.source.scaling,designScene.getMeshByName("wood001_primitive1").scaling=new BABYLON.Vector3(1.05*woodSize.x,1.05*woodSize.y,1.05*woodSize.z),e.source.scaling=new BABYLON.Vector3(1.05*woodSize.x,1.05*woodSize.y,1.05*woodSize.z)}else if("postTop_primitive0"==e.source.name){postTopWoodSize=e.source.scaling,designScene.getMeshByName("postTop_primitive1").scaling=new BABYLON.Vector3(1.05*postTopWoodSize.x,1.05*postTopWoodSize.y,1.05*postTopWoodSize.z),e.source.scaling=new BABYLON.Vector3(1.05*postTopWoodSize.x,1.05*postTopWoodSize.y,1.05*postTopWoodSize.z)}else if("postBottom_primitive0"==e.source.name){postBotWoodSize=e.source.scaling,designScene.getMeshByName("postBottom_primitive1").scaling=new BABYLON.Vector3(1.05*postBotWoodSize.x,1.05*postBotWoodSize.y,1.05*postBotWoodSize.z),e.source.scaling=new BABYLON.Vector3(1.05*postBotWoodSize.x,1.05*postBotWoodSize.y,1.05*postBotWoodSize.z)}if(bookFlowersMap.has(e.source.name)&&"wood"===e.source.name){let e=document.createElement("span");var n;e.setAttribute("id","partTooltip"),(n=e.style).position="absolute",n.paddingLeft="0.5%",n.paddingRight="0.5%",n.color="#00BFFF",n.textShadow="2px 2px 5px black",n.fontFamily="Courgette-Regular",n.fontSize="2em",n.top=designScene.pointerY+"px",n.left=designScene.pointerX+20+"px",n.cursor="pointer",document.body.appendChild(e),e.textContent="Close Book"}flowerVarietyMap.has(e.source.name)},onOutChar=e=>{if(designScene.activeCamera===designCamera&&isCharMovementEnabled&&(e.source.material.emissiveColor=new BABYLON.Color3(0,0,0),"Mermaid_Body_Rev"===e.source.name&&(e.source.material.subMaterials[0].emissiveColor=new BABYLON.Color3(0,0,0),e.source.material.subMaterials[1].emissiveColor=new BABYLON.Color3(0,0,0))),flowerVarietyMap.has(e.source.name)&&(e.source.material.emissiveColor=BABYLON.Color3.Green()),bookFlowersMap.has(e.source.name))if("wood001_primitive0"==e.source.name){e.source.scaling=woodSize,designScene.getMeshByName("wood001_primitive1").scaling=woodSize}else if("postTop_primitive0"==e.source.name){e.source.scaling=postTopWoodSize,designScene.getMeshByName("postTop_primitive1").scaling=postTopWoodSize}else if("postBottom_primitive0"==e.source.name){e.source.scaling=postBotWoodSize,designScene.getMeshByName("postBottom_primitive1").scaling=postBotWoodSize}for(designScene.activeCamera===panelCamera&&e.source===ruruDesign_obj&&(e.source.material.emissiveColor=new BABYLON.Color3(0,0,0));document.getElementById("partTooltip");)document.getElementById("partTooltip").parentNode.removeChild(document.getElementById("partTooltip"))};function animate_ruru_speech(){let e=0;setInterval(function(){e<8&&isStartRuruSpeech2?(ruruSpeech2.setEnabled(!0),ruruSpeech2.isVisible=!0,ruruSpeech3.setEnabled(!1),ruruSpeech3.isVisible=!1):e>=8&&e<15&&isStartRuruSpeech2?(ruruSpeech2.setEnabled(!1),ruruSpeech2.isVisible=!1,ruruSpeech3.setEnabled(!0),ruruSpeech3.isVisible=!0):e=0,e++},1e3)}function set_chars_position(e){1===e?(nuvolaDesign_obj.position=new BABYLON.Vector3(12.5,-8.3,55.92),nuvolaDesign_obj.rotationQuaternion=new BABYLON.Quaternion(.057,-.4064,.0516,.9102),ruruDesign_obj.position=new BABYLON.Vector3(59,8.5,9),ruruDesign_obj.rotationQuaternion=new BABYLON.Quaternion(.6481,-.3413,.2794,.6202)):2===e?(nuvolaDesign_obj.position=new BABYLON.Vector3(354.72,-.45,163.23),nuvolaDesign_obj.rotationQuaternion=new BABYLON.Quaternion(.0585,-.4413,.0794,.891),ruruDesign_obj.position=new BABYLON.Vector3(401.08,38.04,114.31),ruruDesign_obj.rotationQuaternion=new BABYLON.Quaternion(.6671,-.3473,.1862,.6314)):(nuvolaDesign_obj.position=new BABYLON.Vector3(562.69,52.97,6.62),nuvolaDesign_obj.rotationQuaternion=new BABYLON.Quaternion(.0304,-.9951,-.0841,.0099))}function set_clouds_position(e){1===e?(ruruSpeechCloud.isVisible=!1,ruruSpeechCloud.setEnabled(!1),nuvolaSpeechCloud.isVisible=!1,nuvolaSpeechCloud.setEnabled(!1),ruruSpeech2.isVisible=!1,ruruSpeech2.setEnabled(!1),nuvolaSpeech2.isVisible=!1,nuvolaSpeech2.setEnabled(!1),ruruSpeech3.isVisible=!1,ruruSpeech3.setEnabled(!1),nuvolaSpeech3.isVisible=!1,nuvolaSpeech3.setEnabled(!1),isStartRuruSpeech2=!1):2===e?(nuvolaSpeechCloud.position=new BABYLON.Vector3(386.64,17.46,156.72),nuvolaSpeechCloud.rotationQuaternion=new BABYLON.Quaternion(.0403,.6396,-.0343,.7667),ruruSpeechCloud.position=new BABYLON.Vector3(394.43,49.3,115.14),ruruSpeechCloud.rotationQuaternion=new BABYLON.Quaternion(.0606,.5774,-.0598,.8119),ruruSpeechCloud.isVisible=!0,ruruSpeechCloud.setEnabled(!0),nuvolaSpeechCloud.isVisible=!0,nuvolaSpeechCloud.setEnabled(!0),ruruSpeech2.isVisible=!0,ruruSpeech2.setEnabled(!0),nuvolaSpeech2.isVisible=!0,nuvolaSpeech2.setEnabled(!0)):3===e&&(nuvolaSpeechCloud.position=new BABYLON.Vector3(519.04,50.53,73.52),nuvolaSpeechCloud.rotationQuaternion=new BABYLON.Quaternion(.1268,-.1632,-.0212,.978),nuvolaSpeech3.isVisible=!0,nuvolaSpeech3.setEnabled(!0))}let objectUrl,isTrevorFirstAppear=!0;function set_char_movable(e){e?(add_action_mgr(nuvolaDesign_obj),add_action_mgr(ruruDesign_obj),isCharMovementEnabled=!0,ruruSpeechCloud.isVisible=!1,ruruSpeechCloud.setEnabled(!1),nuvolaSpeechCloud.isVisible=!1,nuvolaSpeechCloud.setEnabled(!1),isTrevorFirstAppear?(Swal.fire({width:"10vw",padding:"3em",background:"rgba(8, 64, 147, 0.6) url(front/images3D/designScene/trevorSaved.png) ",title:'\n\n\n\nHi! Take a good photo of your panel on Mbaye! You can reposition RuRu and Nuvola as you wish! Click the "Capture Now" to take a screenshot.',showConfirmButton:!1,position:"top-end",customClass:{popup:"trevor-popup-class"}}),isTrevorFirstAppear=!1):Swal.fire({width:"10vw",padding:"3em",title:"Try to click and drag RURU or NUVOLA anywhere in the page.",background:"rgba(8, 64, 147, 0.6)",showConfirmButton:!1,position:"top-end",showClass:{backdrop:"swal2-backdrop-hide"},customClass:{popup:"screenshot-popup-class"}})):(isCharMovementEnabled=!1,nuvolaDesign_obj.actionManager=null,ruruDesign_obj.actionManager=null,charPointerDragBehavior.enabled=!1,charPointerDragBehavior.attachedNode=null)}function set_panel_children(e){let n=new Map;if(e)for(let o=0;o<e.length;o++)n.set(e[o].uniqueId,e[o]);return n}function load_saved_game(){Promise.all([BABYLON.SceneLoader.ImportMeshAsync(null,"storage/saveState/designPanel/",load_filename,designScene).then(function(e){e.meshes.forEach(function(e){if(mbayePanelsMap.has(e.name)){e.setParent(mbayeDesign_object),null!==mbayePanelsMap.get(e.name)&&mbayePanelsMap.get(e.name).dispose(),e.isPickable=!0,e.material.emissiveColor=new BABYLON.Color3(0,0,0),mbayePanelsMap.set(e.name,e);let n=set_panel_children(e._children);flowersPanelsMap.set(e,n)}})})]).then(()=>{isProgressLoaded=!0})}function save_designed_panels(e){designCamera.detachControl(canvas);let n={};var o={materials:[],geometries:{boxes:[],spheres:[],cylinders:[],toruses:[],grounds:[],planes:[],torusKnots:[],vertexData:[]},meshes:[]};objectUrl&&window.URL.revokeObjectURL(objectUrl);for(const[e,n]of flowersPanelsMap.entries())if(n.size>0){var t=BABYLON.SceneSerializer.SerializeMesh(e,!1,!0);for(let e=0;e<t.meshes.length;e++)o.materials.push(t.materials[e]),o.geometries.vertexData.push(t.geometries.vertexData[e]),o.meshes.push(t.meshes[e])}for(const[e,o]of flowersPanelsMap.entries())if(modified_panels_list.has(e.name)){let t=[];for(const e of o.values())t.push(e.name);0==t.length&&(t="0"),n[e.name]=t}var i=JSON.stringify(o),a=new Blob([i],{type:"octet/stream"});(e.toLowerCase().lastIndexOf(".babylon")!==e.length-8||e.length<9)&&(e+=".babylon"),a&&$.ajax({type:"POST",url:urlDesignPanel,data:{uid:userId,designPath:userId+"_designedPanel.babylon",babylonFile:i,flowersList:n,_token:token},success:function(e){Swal.fire({width:"10vw",padding:"3em",background:"rgba(8, 64, 147, 0.6) url(front/images3D/designScene/trevorSaved.png)",title:"\n\n\n\nYour progress has been saved.",showConfirmButton:!1,position:"top-end",timer:3e3,customClass:{popup:"trevor-popup-class"}}),designCamera.attachControl(canvas,!0),n={},is_design_saved=!0},error:function(e){Swal.fire({width:"10vw",padding:"3em",background:"rgba(8, 64, 147, 0.6) url(front/images3D/designScene/trevorSaved.png) ",title:"\n\n\n\nOops...something went wrong. Your progress was not saved.",showConfirmButton:!1,position:"top-end",timer:3e3,customClass:{title:"error-title-class",popup:"trevor-popup-class"}})}})}var viewport_init_specs=new Map([[1,{designCamRadius:158,earthCamRadius:180,panelCamFOV:1.2,focusCamFOV:1.2}],[2,{designCamRadius:150,earthCamRadius:200,panelCamFOV:1.2,focusCamFOV:1.2}],[3,{designCamRadius:142,earthCamRadius:180,panelCamFOV:1.25,focusCamFOV:1.25}],[4,{designCamRadius:140.5,earthCamRadius:140,panelCamFOV:1.3,focusCamFOV:1.3}],[5,{designCamRadius:138,earthCamRadius:140,panelCamFOV:1.4,focusCamFOV:1.4}],[6,{designCamRadius:134,earthCamRadius:120,panelCamFOV:1.5,focusCamFOV:1.5}]]);function set_camera_viewport_specs(e){let n;viewport_init_specs.has(e)&&(n=viewport_init_specs.get(e)),designCamera.radius=n.designCamRadius,earthCameraDesignRadius=n.earthCamRadius,panelCameraDesignFOV=n.panelCamFOV,focusCameraDesignFOV=n.focusCamFOV}var animateObjectPositionNoEase=function(e,n,o,t){(new BABYLON.CubicEase).setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT),BABYLON.Animation.CreateAndStartAnimation("objPos",e,"position",n,o,e.position,t,0,null)},animatePanelCameraToRadius=async function(e,n,o,t){BABYLON.Animation.CreateAndStartAnimation("at4",e,"radius",n,o,e.radius,t,0,null,panelCameraAnimEnded)},panelCameraAnimEnded=function(){currentScene.activeCamera=designCamera,isPanelMovementDone=!1,isCurrentPanelInLocation=!1,isRuruClicked&&setTimeout(function(){save_designed_panels(userId+"_designedPanel")},500),isRuruClicked=!1};function show_saving_alert(){Swal.fire({title:"Are you sure you want to return the current panel without saving?",text:"This will discard your current progress!",imageUrl:"../../front/icons/alert-icon.png",imageWidth:"10vw",imageHeight:"auto",imageAlt:"Warning",showCancelButton:!0,allowOutsideClick:!1,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, I'm sure!",cancelButtonText:"No, save my panel",width:"20%",padding:"1rem",background:"rgba(8, 64, 147, 0.62)",customClass:{popup:"ruru-popup-class"}}).then(e=>{e.value?returnPanelViaButton():(returnPanelViaButton(),isRuruClicked=!0)})}var engine=new BABYLON.Engine(canvas,!0,{preserveDrawingBuffer:!0,stencil:!0});engine.enableOfflineSupport=!0;var flowerScene=create_earth_flower_scene(),currentScene=create_design_scene();let isFlowerRemoved=!1,panelCameraDesignRadius=500,earthCameraDesignRadius=140,panelCameraDesignFOV=1.4,focusCameraDesignFOV=1.4,focusCameraBookPosition=new BABYLON.Vector3(469.28,23.98,144.33),isProgressLoaded=!1,isStartRuruSpeech2=!1;currentScene.executeWhenReady(function(){$("#loadingScreenOverlay").show(),$("#loadingScreenPercent").html("Loading: 100 %"),loadCounter=100;var e=new BABYLON.SceneOptimizerOptions;e.addOptimization(new BABYLON.HardwareScalingOptimization(0,1.5));new BABYLON.SceneOptimizer(currentScene,e);has_load_game&&!isProgressLoaded&&isMbayeModelReady&&load_saved_game(),viewportAR&&(viewportAR>=1.2&&viewportAR<=1.3?set_camera_viewport_specs(1):viewportAR>=1.31&&viewportAR<=1.43?set_camera_viewport_specs(2):viewportAR>=1.44&&viewportAR<=1.65?set_camera_viewport_specs(3):viewportAR>=1.66&&viewportAR<=1.79?set_camera_viewport_specs(4):viewportAR>=1.8&&viewportAR<=2.1?set_camera_viewport_specs(5):viewportAR>2.1&&viewportAR<=2.2&&set_camera_viewport_specs(6)),(isMobile()||isSmallDevice())&&set_touch_icons(),engine.runRenderLoop(function(){if(currentScene){if(currentPanel&&isOpenBookFlowers)if(bookTask.animationGroups[0].isPlaying)designOrigFlower.scaling.x<80&&(designOrigFlower.scaling.x+=3,designOrigFlower.scaling.y-=3,designOrigFlower.scaling.z+=3),bookTask.meshes[19].scaling.x<.8&&(bookTask.meshes[19].scaling.x+=.03,bookTask.meshes[19].scaling.y+=.03,bookTask.meshes[19].scaling.z-=.03);else{if(flowersMap.has(worldFlowerPicked))for(let e of flowerVarietyMap.values())e.isVisible=!0;isOpenBookFlowers=!1}if(theFlowerWithGizmo&&!theFlowerWithGizmo.intersectsMesh(panelFlowerBox,!0)){theFlowerWithGizmo.position.x,theFlowerWithGizmo.position.y,theFlowerWithGizmo.position.z;designScene.activeCamera===panelCamera?theFlowerWithGizmo.position=new BABYLON.Vector3(.0597,.01639,-.0216):designScene.activeCamera===focusCamera&&(theFlowerWithGizmo.position=new BABYLON.Vector3(.0341,.05115,.00234))}isStartOfDesignPanel&&designScene.activeCamera===panelCamera&&ruruSpeech2&&ruruSpeech3&&!isStartRuruSpeech2&&(animate_ruru_speech(),isStartRuruSpeech2=!0),currentScene.render(),flowerScene.render()}})}),window.addEventListener("resize",function(){engine.resize(),testOrientation(),testFullscreen()}),$(document).ready(function(){testOrientation()});var viewportWidth=$(window).innerWidth(),viewportHeight=$(window).innerHeight(),viewportAR=$(window).innerWidth()/$(window).innerHeight();viewportWidth<viewportHeight&&(viewportAR=$(window).innerHeight()/$(window).innerWidth());let userId=document.getElementById("userId").value;$("#loadingScreenOverlay").on("click",function(e){$(this).remove(),$("#loadingScreenDiv").remove(),$("#infoIconTextdown").hide(),document.getElementById("loadingScreenPercent").style.visibility="hidden";let n="female"===user_gender.toLowerCase()?"Major Thomasina ":"Major Tom ";has_load_game&&isProgressLoaded&&Swal.fire({imageUrl:"../../front/icons/alert-icon.png",imageWidth:"10vw",imageHeight:"auto",position:"top-end",title:"Welcome back, "+n+user_firstname+"! <br/><br/>Your game progress has been loaded successfully!",showConfirmButton:!1,background:"rgba(8, 64, 147, 0.6)",customClass:{popup:"welcome-popup-class"}}),designCamera.attachControl(canvas,!0),openFullscreen(),isMobile()&&Swal.fire({title:"Oops...We're sorry but this feature is not available for mobile at the moment. Please design your panels by accessing the page using desktop browser.",imageUrl:"../../front/icons/alert-icon.png",imageWidth:"10vw",imageHeight:"auto",imageAlt:"Warning",showCancelButton:!0,allowOutsideClick:!1,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"View Panels",cancelButtonText:"Explore",width:"20%",padding:"1rem",background:"rgba(8, 64, 147, 0.62)",customClass:{popup:"ruru-popup-class"}}).then(e=>{e.value&&(window.location.href=urlPanelBlogview)})});let loadCounter=0;setInterval(function(){loadCounter<100&&isWorldFlowersReady&&$("#loadingScreenPercent").html("Loading: "+loadCounter+" %"),loadCounter++},700);let isPanelScreenshotSaved=!1;async function save_design_panel_screenshot(){let e=currentPanel.name;$("#saveScreenshotBtn, #cancelScreenshotBtn").prop("disabled",!0),$("#saveScreenshotBtn, #cancelScreenshotBtn").css({"background-color":"gray",cursor:"not-allowed"}),$("#saveScreenshotBtn").text("Saving..."),$.ajax({type:"POST",url:urlDesignScreenshot,data:{uid:userId,img:screenshotData,panel_no:e,_token:token},success:function(n){Swal.fire({width:"10vw",padding:"3em",background:"rgba(8, 64, 147, 0.6) url(front/images3D/designScene/trevorSaved.png) ",title:"\n\n\n\nScreenshot of panel "+e+" saved succesfully!",showConfirmButton:!0,position:"top-end",width:100,allowOutsideClick:!1,customClass:{popup:"trevor-popup-class"}}).then(async e=>{if(e.value){var n=window.document.createElement("a");n.href=screenshotData,n.download="screenshot";var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!1),n.dispatchEvent(o),$("#showScreenshotModal").modal("hide"),$("#saveScreenshotBtn").css("background-color","#007bff"),$("#cancelScreenshotBtn").css("background-color","red"),$("#saveScreenshotBtn, #cancelScreenshotBtn").css("cursor","pointer"),$("#saveScreenshotBtn, #cancelScreenshotBtn").prop("disabled",!1),$("#saveScreenshotBtn").text("Save Screenshot"),await returnPanelViaButton(),isRuruClicked=!0}})},error:function(e){Swal.fire({width:"10vw",padding:"3em",background:"rgba(8, 64, 147, 0.6) url(front/images3D/designScene/trevorSaved.png) ",title:"\n\n\n\nOops...something went wrong. Your screenshot was not saved.",showConfirmButton:!1,position:"top-end",timer:3e3,customClass:{title:"error-title-class",popup:"trevor-popup-class"}})}})}$("#saveScreenshotBtn").on("click",async function(){if(designScene.activeCamera===designCamera){var e=window.document.createElement("a");e.href=screenshotData,e.download="Mbaye_screenshot";var n=document.createEvent("MouseEvents");n.initEvent("click",!0,!1),e.dispatchEvent(n)}else await save_design_panel_screenshot()});let isScreenshotActive=!0;$(".mainScreenshotIcon").on("click",function(){$(".takeScreenshotMain-submenu").fadeToggle(),set_char_movable(isScreenshotActive),isScreenshotActive=!isScreenshotActive}),$(".panelScreenshotIcon").on("click",function(e){e.preventDefault(),take_panel_screenshot()}),$("#take-screenshot-submenu").on("click",function(e){e.preventDefault(),take_panel_screenshot()}),$("#resetScene-submenu").on("click",function(e){e.preventDefault(),ruruDesign_obj.position=new BABYLON.Vector3(59,8.5,9),ruruDesign_obj.rotationQuaternion=new BABYLON.Quaternion(.6481,-.3413,.2794,.6202),nuvolaDesign_obj.position=new BABYLON.Vector3(12.5,-8.3,55.92),nuvolaDesign_obj.rotationQuaternion=new BABYLON.Quaternion(.057,-.4064,.0516,.9102)}),$(".mainScreenshotIcon").hover(function(){isScreenshotActive?$(".tooltips span").html("Take Screenshot"):$(".tooltips span").html("Disable Screenshot"),$(".tooltips span").css("display","block")},function(){$(".tooltips span").hide()});let isPosGizmoOn=!0,isRotGizmoOn=!1,isScaleGizmoOn=!1;function set_gizmo_style(e){$("#positionGizmo img").css("filter",""),$("#positionGizmo .gizmoLabel").html("Position: ON"),$("#rotationGizmo img").css("filter",""),$("#rotationGizmo .gizmoLabel").html("Rotation: ON"),$("#scaleGizmo img").css("filter",""),$("#scaleGizmo .gizmoLabel").html("Scaling: ON"),"#positionGizmo"===e?($("#positionGizmo img").css("filter","drop-shadow(2px 1px 5px cyan)"),$("#positionGizmo .gizmoLabel").html("Position: OFF")):"#rotationGizmo"===e?($("#rotationGizmo img").css("filter","drop-shadow(2px 1px 5px cyan)"),$("#rotationGizmo .gizmoLabel").html("Rotation: OFF")):"#scaleGizmo"===e&&($("#scaleGizmo img").css("filter","drop-shadow(2px 1px 5px cyan)"),$("#scaleGizmo .gizmoLabel").html("Scaling: OFF"))}$("#positionGizmo").on("click",function(e){isRotGizmoOn=!1,isScaleGizmoOn=!1,(isPosGizmoOn=!isPosGizmoOn)?(design_handle_tool("#positionGizmo"),set_gizmo_style("#positionGizmo")):(design_handle_tool("off"),set_gizmo_style("off"))}),$("#rotationGizmo").on("click",function(e){isPosGizmoOn=!1,isScaleGizmoOn=!1,(isRotGizmoOn=!isRotGizmoOn)?(design_handle_tool("#rotationGizmo"),set_gizmo_style("#rotationGizmo")):(design_handle_tool("off"),set_gizmo_style("off"))}),$("#scaleGizmo").on("click",function(e){isRotGizmoOn=!1,isPosGizmoOn=!1,(isScaleGizmoOn=!isScaleGizmoOn)?(design_handle_tool("#scaleGizmo"),set_gizmo_style("#scaleGizmo")):(design_handle_tool("off"),set_gizmo_style("off"))}),$("#deleteGizmo").on("click",function(e){design_handle_tool("delete"),set_gizmo_style("off")});let instruction_map=new Map([[0,'DRAG THE <b style="color:green">GREEN ARROW</b> TO MOVE <b style="color:green">UP AND DOWN</b>.<br>DRAG THE <b style="color:red">RED ARROW</b> TO MOVE <b style="color:red">LEFT AND RIGHT</b>.<BR>DRAG THE <b style="color:#3897c5">BLUE ARROW</b> TO MOVE <b style="color:#3897c5">BACKWARD AND FORWARD</b>.'],[1,'CLICK THE <b style="color:green">GREEN WHEEL</b> TO ROTATE ALONG THE <b style="color:green">X AXIS</b><br>CLICK THE <b style="color:red">RED ARROW</b> TO ROTATE ALONG THE <b style="color:red">Y AXIS</b>.<br/>CLICK THE <b style="color:#3897c5">BLUE ARROW</b> TO ROTATE ALONG THE <b style="color:#3897c5">Z AXIS</b>.'],[2,'WHEN YOU WANT TO RESIZE YOUR CHOSEN FLOWER, YOU<br> CAN <b style="color:#3897c5">CLICK AND DRAG THE CORNERS</b> OF THE BOX THAT<br> APPEARS AROUND THE FLOWER. ']]);$("#infoIcon").on("click",function(){isStartOfDesignPanel?isStartOfDesignPanel&&(isBookFlowersActive?designGizmoManager._attachedMesh&&null!==designGizmoManager._attachedMesh?show_overlay_text(4):show_overlay_text(3):show_overlay_text(2)):show_overlay_text(1)});let isIns2Active=!1;function set_circle_type(){try{isIns2Active?(circleType=new CircleType(document.getElementById("textCurve")),circleType.radius(100)):circleType&&circleType.destroy()}catch(e){}}function show_overlay_text(e){1==e?($("#instruction-left-div").toggle(),$("#infoIconTextastro").toggle(),$("#overlayTxtDown").toggle(),$("#arrowGIF2").toggle()):2==e?($("#instructionDivDragLeft").toggle(),$("#instructionDivDragRight").toggle(),$("#overlayTxtdragTop").toggle(),$("#overlayTxtdragBottom").toggle(),isIns2Active=!isIns2Active,$("#textCurve").toggle(),set_circle_type()):3==e?($("#overlayTxtBook").toggle(),$("#overlayTxtBookRight").toggle(),$("#overlayTxtflowerBorder").toggle()):4==e&&($("#overlayTxtBookUpperLeft").toggle(),$("#overlayTxtBookUpperLeft2").toggle(),$("#overlayTxtBookSideLeft").toggle(),$("#overlayTxtsave").toggle())}function set_instructions_overlay(e){1==e?($("#overlayTxtBookUpperLeft").hide(),$("#overlayTxtBookUpperLeft2").hide(),$("#overlayTxtBookSideLeft").hide(),$("#overlayTxtflowerBorder").hide(),$("#overlayTxtsave").hide(),isIns2Active=!1,set_circle_type()):2==e?($("#instruction-left-div").hide(),$("#infoIconTextastro").hide(),$("#overlayTxtDown").hide(),$("#arrowGIF2").hide()):3==e?($("#instructionDivDragLeft").hide(),$("#instructionDivDragRight").hide(),$("#overlayTxtdragTop").hide(),$("#overlayTxtdragBottom").hide(),$("#textCurve").hide()):4==e&&($("#overlayTxtBook").hide(),$("#overlayTxtBookRight").hide())}