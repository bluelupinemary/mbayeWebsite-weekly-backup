let canvas,engine,theAstroFace,theAstroBackButton,astronaut_screenBag,insCamera,hl,starColor,astronaut,navigator_obj,DISC_CAM_INIT_POS={x:2.83,y:.44,z:580.01},cameraInitState={position:null,a:null,b:null,r:null,upperA:null,lowerA:null,upperB:null,lowerB:null,upperR:null,lowerR:null,angularY:null},cameraCurrtState={position:null,a:null,b:null,r:null,upperA:null,lowerA:null,upperB:null,lowerB:null,upperR:null,lowerR:null,angularY:null},astroInitState={x:0,y:0,z:0},createContactScene=function(){canvas=document.getElementById("canvas"),(engine=new BABYLON.Engine(canvas,!0,{preserveDrawingBuffer:!0,stencil:!0})).enableOfflineSupport=!0,scene=new BABYLON.Scene(engine),BABYLON.Database.IDBStorageEnabled=!0;let e=new BABYLON.CubeTexture.CreateFromPrefilteredData("front/textures/environment.dds",scene);return e.gammaSpace=!1,scene.environmentTexture=e,load_3D_mesh(),create_skybox(),insCamera=create_camera(),create_light(),hl=new BABYLON.HighlightLayer("hl1",scene),starColor=new BABYLON.HighlightLayer("starColor",scene),scene};function create_camera(){let e=new BABYLON.ArcRotateCamera("Main Camera",BABYLON.Tools.ToRadians(0),BABYLON.Tools.ToRadians(0),30,new BABYLON.Vector3(-198.34,80.42,162.37),scene);return e.fovMode=BABYLON.Camera.FOVMODE_HORIZONTAL_FIXED,e.fov=1.4,e.attachControl(canvas,!0),e.upperAlphaLimit=1e3,e.lowerRadiusLimit=3,e.upperRadiusLimit=2e3,e.wheelPrecision=10,e.panningSensibility=100,e.target=new BABYLON.Vector3(0,0,0),e.panningDistanceLimit=500,e.pinchPrecision=100,e.checkCollisions=!0,cameraInitState.position=new BABYLON.Vector3(-198.34,80.42,162.37),cameraInitState.a=e.alpha,cameraInitState.b=e.beta,cameraInitState.r=e.radius,cameraInitState.upperA=e.upperAlphaLimit,cameraInitState.lowerA=e.lowerAlphaLimit,cameraInitState.upperB=e.upperBetaLimit,cameraInitState.lowerB=e.lowerBetaLimit,cameraInitState.upperR=e.upperRadiusLimit,cameraInitState.lowerR=e.lowerRadiusLimit,cameraInitState.angularY=e.angularSensibilityY,e}function create_light(){let e=new BABYLON.HemisphericLight("hemiLight",new BABYLON.Vector3(-30,200,10),scene);e.diffuse=new BABYLON.Color3(1,1,1),e.radius=500,e.specular=new BABYLON.Color3(0,0,0),e.groundColor=new BABYLON.Color3(.3,.3,.3)}function create_skybox(){let e=BABYLON.MeshBuilder.CreateBox("contactSkybox",{size:8500},scene);e.isPickable=!1,e.checkCollisions=!0;let t=new BABYLON.StandardMaterial("contactSkyboxMaterial",scene);t.backFaceCulling=!1;return t.reflectionTexture=new BABYLON.CubeTexture.CreateFromImages(["front/skybox/px.png","front/skybox/py.png","front/skybox/pz.png","front/skybox/nx.png","front/skybox/ny.png","front/skybox/nz.png"],scene),t.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,t.disableLighting=!0,t.specular=new BABYLON.Vector3(0,0,0),e.material=t,t.freeze(),e.freezeWorldMatrix(),e}let astroHelmetFace,closeButton,homeGizmo,homeGizmo2,isAstroBtnClicked,astronautParts={savePnl:null,launchPnl:null};function load_3D_mesh(){let e,t;"female"===(user_gender=document.getElementById("userGender").value).toLowerCase()?(e="front/objects/instructionsScene/thomasina/",t="MajorThomasina3.babylon"):(e="front/objects/instructionsScene/tom/",t="MajorTom2.babylon");var n=0;Promise.all([BABYLON.SceneLoader.ImportMeshAsync(null,e,t,scene,function(e){if(e.lengthComputable)n=(100*e.loaded/e.total).toFixed();else{var t=e.loaded/1048576;n+=Math.floor(100*t)/100}document.getElementById("loadingScreenPercent").innerHTML="Loading: "+n+" %"}).then(function(e){for(let t=0;t<e.meshes.length;t++)e.meshes[t].isPickable=!0,e.meshes[t].checkCollisions=!0,"face"===e.meshes[t].name?theAstroFace=e.meshes[t]:"helmetFace"===e.meshes[t].name?(e.meshes[t].visibility=.5,astroHelmetFace=e.meshes[t]):"helmet"===e.meshes[t].name?e.meshes[t].material.backFaceCulling=!1:"body"===e.meshes[t].name?astronaut=e.meshes[t]:"screenBag"===e.meshes[t].name?astronaut_screenBag=e.meshes[t]:"chest_pnl"===e.meshes[t].name||add_action_mgr_astrobody(e.meshes[t]),t===e.meshes.length-1&&(n=100);astronaut.rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(130),0),"female"===user_gender&&(astronaut.rotation.x=BABYLON.Tools.ToRadians(20))})]).then(()=>{add_mouse_listener(),astronaut.scaling=new BABYLON.Vector3(50,50,50),"male"===user_gender?(closeButton=init_image("closeButtonImage","front/images3D/close-btn.png",2,2,1,{x:49.359868370497246,y:92.87028130188578,z:-10.283994973560922},{x:0,y:-.45346209720749636,z:0,w:.8912755614265313})).setParent(astronaut_screenBag):(closeButton=init_image("closeButtonImage","front/images3D/close-btn.png",2,2,1,{x:45.568324243867394,y:89.60969552988975,z:-10.438664217669247},{x:0,y:-.45346209720749636,z:0,w:.8912755614265313})).setParent(astronaut_screenBag),editPhoto=init_image("editPhotoPlane","",12,10,1,{x:-13.342880249023438,y:41.2667236328125,z:13.468323707580566},{x:-.00564010140713232,y:-.42304049137026456,z:.004882885377763448,w:.9060800738354235}),add_action_mgr_astrobody(editPhoto),defaultPhoto=init_image("defaultPlane","front/images3D/instructionsScene/default.png",16.7,35,1,{x:36.01,y:84.92,z:-26.63},{x:.004992,y:-.42275,z:.004892,w:.90621})})}function enable_gizmo(e){let t=new BABYLON.UtilityLayerRenderer(scene);t.utilityLayerScene.autoClearDepthAndStencil=!1,homeGizmo=new BABYLON.PositionGizmo(t),homeGizmo2=new BABYLON.RotationGizmo(t),homeGizmo.attachedMesh=e,homeGizmo.scaleRatio=2,homeGizmo2.attachedMesh=e}function create_face_texture(e){let t=new BABYLON.StandardMaterial("facePhoto",scene);t.diffuseColor=new BABYLON.Color3(0,0,0),t.emissiveColor=new BABYLON.Color3(.5,.5,.5),t.diffuseTexture=new BABYLON.Texture(e,scene),t.diffuseTexture.hasAlpha=!0,t.backFaceCulling=!1,theAstroFace.material=t,theAstroFace.material.canRescale=!0,theAstroFace.material.diffuseTexture.level=2,theAstroFace.material.diffuseTexture.uScale=1,theAstroFace.material.diffuseTexture.vScale=1,theAstroFace.material.backFaceCulling=!0}function create_instruction_texture(){let e=new BABYLON.StandardMaterial("btn1-instruction-matl",scene);e.diffuseColor=new BABYLON.Color3(1,1,1),e.emissiveColor=new BABYLON.Color3(.5,.5,.5),e.diffuseTexture=new BABYLON.Texture("front/images3D/instructionsScene/"+imgpathArr[imgTextureCtr],scene),e.diffuseTexture.hasAlpha=!0,e.backFaceCulling=!1,e.diffuseLevel=2,astronaut_screenBag.material=e,astronaut_screenBag.material.diffuseTexture.coordinatesMode=BABYLON.Texture.EQUIRECTANGULAR_MODE,defaultPhoto.isVisible=!1}function focus_screen_bag(){"female"===user_gender?(insCamera.position=new BABYLON.Vector3(57.19931654007222,79.61831607853095,-45.16515639438304),insCamera.alpha=insCamera.upperAlphaLimit=insCamera.lowerAlphaLimit=5.5944,insCamera.beta=insCamera.upperBetaLimit=insCamera.lowerBetaLimit=1.5688,insCamera.target=new BABYLON.Vector3(-16.14230839723912,79.42866515898578,15.216712441248943),insCamera.radius=95):(insCamera.position=new BABYLON.Vector3(55.4837,83.6616,-40.5666),insCamera.alpha=insCamera.upperAlphaLimit=insCamera.lowerAlphaLimit=5.5944,insCamera.beta=insCamera.upperBetaLimit=insCamera.lowerBetaLimit=1.5688,insCamera.target=new BABYLON.Vector3(-14.5869,83.4855,17.1187),insCamera.radius=95)}function closeBtn(){insCamera.setTarget(new BABYLON.Vector3(0,0,0)),insCamera.attachControl(canvas,!0),insCamera.position=cameraCurrtState.position,insCamera.alpha=cameraCurrtState.a,insCamera.beta=cameraCurrtState.b,insCamera.radius=cameraCurrtState.r,insCamera.upperAlphaLimit=cameraCurrtState.upperA,insCamera.upperBetaLimit=cameraCurrtState.upperB,insCamera.lowerAlphaLimit=cameraCurrtState.lowerA,insCamera.lowerBetaLimit=cameraCurrtState.lowerB,defaultPhoto.isVisible=!0}function set_curr_camera_state(){cameraCurrtState.position=insCamera.position,cameraCurrtState.a=insCamera.alpha,cameraCurrtState.b=insCamera.beta,cameraCurrtState.r=insCamera.radius,cameraCurrtState.upperA=insCamera.upperAlphaLimit,cameraCurrtState.upperB=insCamera.upperBetaLimit,cameraCurrtState.lowerA=insCamera.lowerAlphaLimit,cameraCurrtState.lowerB=insCamera.lowerBetaLimit}function checkScreenAndDoubleClick(e){let t=e[0],n=e[1];isMobile()?isAstroBtnClicked?(isAstroBtnClicked=!1,show_alert_box(t,n)):(isAstroBtnClicked=!0,setTimeout(function(){isAstroBtnClicked&&(isAstroBtnClicked=!1,Swal.fire({width:"10vw",padding:"3em",title:"Double Tap to enter the page.",showConfirmButton:!1,position:"top-end",showClass:{backdrop:"swal2-backdrop-hide"},timer:2e3,width:100,customClass:{popup:"trevor-popup-class"}}))},500)):show_alert_box(t,n)}function show_alert_box(e,t){Swal.fire({title:"Are you sure you want to view the "+e+" page? ",imageUrl:"../../front/icons/alert-icon.png",imageWidth:"10vw",imageHeight:"auto",imageAlt:"Warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",allowOutsideClick:!1,confirmButtonText:"Yes, I'm sure!",width:"20%",padding:"1rem",background:"rgba(8, 64, 147, 0.62)"}).then(e=>{e.value&&(window.location.href=t)})}function init_image(e,t,n,i,a,r,o){var s=BABYLON.MeshBuilder.CreatePlane(e,{height:n,width:i},scene);s.scaling=new BABYLON.Vector3(a,a,a),s.position=new BABYLON.Vector3(r.x,r.y,r.z);var c=new BABYLON.StandardMaterial(e+"matl",scene);return"editPhotoPlane"===e?(c.backFaceCulling=!1,s.scaling=new BABYLON.Vector3(.52,.76,.62),c.alpha=.1,s.rotationQuaternion=new BABYLON.Quaternion(o.x,o.y,o.z,o.w)):"defaultPlane"===e?(s.rotationQuaternion=new BABYLON.Quaternion(o.x,o.y,o.z,o.w),c.diffuseTexture=new BABYLON.Texture(t,scene),c.opacityTexture=new BABYLON.Texture(t,scene)):(s.rotationQuaternion=new BABYLON.Quaternion(o.x,o.y,o.z,o.w),c.diffuseTexture=new BABYLON.Texture(t,scene),c.opacityTexture=new BABYLON.Texture(t,scene),c.ambientColor=new BABYLON.Color3(1,1,1),c.emissiveColor=new BABYLON.Color3(.5,.5,.5),c.diffuseTexture.hasAlpha=!0),s.material=c,s}function validateEmail(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}let imgpathArr,partTooltip,isPlane2Selected=!1,isLaunchEnabled=!1,imgTextureCtr=0;function add_mouse_listener(){var e=function(e){if(scene){var t=scene.pick(scene.pointerX,scene.pointerY);if(t.hit){let n=t.pickedMesh.name;if(astronaut_map.has(n)){let t=astronaut_map.get(n);if(e.preventDefault(),"Music"===t[0]){load_music(musicPlayerVideos[current_video].id,musicPlayerVideos[current_video].start),$("#musicVideoDiv").css("display","block")}else checkScreenAndDoubleClick(t)}else instructionBtn_map.has(n)?(imgTextureCtr=0,imgpathArr=instructionBtn_map.get(n),create_instruction_texture(),set_curr_camera_state(),focus_screen_bag()):"ArrowUp"===n?update_instruction_texture("up"):"ArrowDown"===n?update_instruction_texture("down"):"closeButtonImage"===n&&closeBtn()}}};canvas.addEventListener("pointerdown",e,!1),canvas.addEventListener("pointerup",function(e){},!1),canvas.addEventListener("pointermove",function(e){},!1),scene.onDispose=function(){canvas.removeEventListener("pointerdown",e)}}function update_instruction_texture(e){imgpathArr&&("up"===e?(++imgTextureCtr>=imgpathArr.length&&(imgTextureCtr=0),create_instruction_texture()):(--imgTextureCtr<0&&(imgTextureCtr=imgpathArr.length-1),create_instruction_texture()))}function add_action_mgr_astrobody(e){e.actionManager=new BABYLON.ActionManager(scene),e.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOverTrigger,onOverAstronaut)),e.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOutTrigger,onOutAstronaut))}var onOverAstronaut=e=>{(partTooltip=document.createElement("span")).setAttribute("id","partTooltip");var t=partTooltip.style;t.position="absolute",t.padding="0.2%",t.color="white",t.fontFamily="Courgette-Regular",t.fontSize="1.5em",t.backgroundColor="#0b91c3a3",t.opacity="0.7",t.top=scene.pointerY+"px",t.left=scene.pointerX+"px",t.cursor="pointer",t.pointerEvents="none",astronaut_map.has(e.meshUnderPointer.name)&&(document.body.appendChild(partTooltip),hl.addMesh(e.source,new BABYLON.Color3(0,.8,.8)),partTooltip.textContent=astronaut_map.get(e.meshUnderPointer.name)[0])},onOutAstronaut=e=>{for(;document.getElementById("partTooltip");)hl.removeMesh(e.source),document.getElementById("partTooltip").parentNode.removeChild(document.getElementById("partTooltip"))};function set_touch_icons(){$(".touch-rotate").attr("src","front/images3D/icons/rotateTouch.png"),$(".touch-zoom").attr("src","front/images3D/icons/zoomTouch.png"),$(".touch-panning").attr("src","front/images3D/icons/panningTouch.png")}function set_camera_viewport_specs(e){let t;viewport_init_specs.has(e)&&(t=viewport_init_specs.get(e)),insCamera.radius=t.insCamera}$("#infoIcon").on("click",function(){$("#instructionsDiv1").toggle(),$("#instructionsDiv2").toggle(),$("#instructionsDiv3").toggle()});var screenSize,viewportWidth=$(window).innerWidth(),viewportHeight=$(window).innerHeight(),viewportAR=$(window).innerWidth()/$(window).innerHeight();function checkViewportSize(){viewportAR&&(viewportAR>=1.2&&viewportAR<=1.3?screenSize=1:viewportAR>=1.31&&viewportAR<=1.4399?screenSize=2:viewportAR>=1.44&&viewportAR<=1.65?screenSize=3:viewportAR>=1.66&&viewportAR<=1.79?screenSize=4:viewportAR>=1.8&&viewportAR<=2.1?screenSize=5:(viewportAR>2.1&&viewportAR<=2.2||viewportAR>2.2)&&(screenSize=6))}viewportWidth<viewportHeight&&(viewportAR=$(window).innerHeight()/$(window).innerWidth());let img_path,user_gender,yt_player,isImgPathSet=!1,isSceneLoaded=!1;$(window).on("load",function(){setup_music_player(),isImgPathSet=!0,img_path=document.getElementById("userPhoto").src,isSceneLoaded=!0}),$(document).ready(function(){var e=createContactScene();e.executeWhenReady(function(){userId&&""!=userId||(astroHelmetFace&&(astroHelmetFace.visibility=1),(closeButton=init_image("closeButtonImage","front/images3D/close-btn.png",2,2,1,{x:49.359868370497246,y:92.87028130188578,z:-10.283994973560922},{x:0,y:-.45346209720749636,z:0,w:.8912755614265313})).setParent(astronaut_screenBag)),(isMobile()||isSmallDevice())&&set_touch_icons(),checkViewportSize(),engine.runRenderLoop(function(){isSceneLoaded&&e.render(),isImgPathSet&&theAstroFace&&(isImgPathSet=!1,create_face_texture(img_path))}),document.getElementById("loadingScreenDiv").style.display="none",document.getElementById("loadingScreenPercent").style.display="none"})}),window.addEventListener("resize",function(){engine.resize(),testFullscreen(),testOrientation()});let isMusicChanged=!1,theClick=0;function setup_music_player(){$(".player").empty();var e=document.getElementById("player");yt_player=new YT.Player(e,{host:"https://www.youtube.com",height:"0",width:"0",videoId:"",playerVars:{autoplay:0,loop:1,start:0,fs:0,enablejsapi:1,origin:window.location.href,widget_referrer:window.location.href},events:{onReady:onPlayerReady}})}function onPlayerReady(e){}function load_music(e,t){$(".player").empty(),yt_player.loadVideoById(e,t),yt_player.playVideo(),isMusicPlaying=!0}function stop_music(){yt_player.stopVideo(),isMusicPlaying=!1}function pause_music(){yt_player.pauseVideo(),isMusicPlaying=!1}function play_music(){yt_player.playVideo(),isMusicPlaying=!0}$("#musicVideoDivHeader #close-btn").on("click",function(e){$("#musicVideoDiv").hide(),pause_music()});let isMusicFullscreen=!1;$("#musicVideoDivHeader #fullscreen-btn, #musicVideoDivHeader #minimize-btn").on("click",function(e){isMusicFullscreen?($("#musicVideoDiv").removeClass("musicVideoDiv2"),$("#musicVideoDiv").addClass("musicVideoDiv"),$("#musicVideoDivHeader #fullscreen-btn").show(),$("#musicVideoDivHeader #minimize-btn").hide(),$(".wikiFullscreenLabel").html("Fullscreen")):($("#musicVideoDiv").removeClass("musicVideoDiv"),$("#musicVideoDiv").addClass("musicVideoDiv2"),$("#musicVideoDivHeader #fullscreen-btn").hide(),$("#musicVideoDivHeader #minimize-btn").show(),$(".wikiFullscreenLabel").html("Minimize")),isMusicFullscreen=!isMusicFullscreen});let current_video=0;function playNextSong(){musicPlayerVideos.length-1>current_video?current_video+=1:musicPlayerVideos.length-1==current_video&&(current_video=0),load_music(musicPlayerVideos[current_video].id,musicPlayerVideos[current_video].start)}function playPrevSong(){0!=current_video?current_video-=1:current_video=0,load_music(musicPlayerVideos[current_video].id,musicPlayerVideos[current_video].start)}