let canvas,engine,theAstroFace,storyCamera,hl,starColor,skybox,earth_obj,mbaye_obj,collage_wall,DISC_CAM_INIT_POS={x:2.83,y:.44,z:580.01},cameraInitState={position:null,a:null,b:null,r:null,upperA:null,lowerA:null,upperB:null,lowerB:null,upperR:null,lowerR:null,angularY:null},astroInitState={x:0,y:0,z:0},currentStage=24,createChapter2Scene=function(){canvas=document.getElementById("canvas"),(engine=new BABYLON.Engine(canvas,!0,{preserveDrawingBuffer:!0,stencil:!0})).enableOfflineSupport=!0,scene=new BABYLON.Scene(engine),BABYLON.Database.IDBStorageEnabled=!0;let e=new BABYLON.CubeTexture.CreateFromPrefilteredData("front/textures/environment.dds",scene);return e.gammaSpace=!1,scene.environmentTexture=e,load_3D_mesh(),skybox=create_skybox(),storyCamera=create_camera(),storyLight=create_light(),load_orig_flowers(),hl=new BABYLON.HighlightLayer("hl1",scene),scene};var WALL_INIT_POS=new BABYLON.Vector3(-9.12,0,-1500);function load_3D_mesh(){var e=0;Promise.all([BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/storyMbayeScene/","MbayeRandomPanels.glb",scene,function(t){if(t.lengthComputable)e=(100*t.loaded/t.total).toFixed();else{var a=t.loaded/1048576;e+=Math.floor(100*a)/100}document.getElementById("loadingScreenPercent").innerHTML="Loading: "+e+" %"}).then(function(e){e.meshes[0].scaling=new BABYLON.Vector3(3,3,-3),mbaye_obj=e.meshes[0],e.meshes.forEach(function(e){if(e.isPickable=!1,"MbayeBody"===e.name||"BodyPanels"===e.name){let t=new BABYLON.PBRMaterial("pbr",scene);e.material=t,e.material.backFaceCulling=!1,t.albedoColor=new BABYLON.Color3(.5,.5,.5),t.emissiveColor=new BABYLON.Color3(0,0,0),t.metallic=1,t.metallicF0Factor=.5,t.roughness=.15,t.microSurface=1}else"R_EYEAventurine_primitive1"!==e.name&&"L_EYEAventurine_primitive1"!==e.name||(e.material.albedoColor=new BABYLON.Color3(.01,.2,.07))})}),BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/feetMbayeScene/","FrontRFoot.babylon",scene).then(function(e){e.meshes[0].scaling=new BABYLON.Vector3(12,12,12),e.meshes[0].isPickable=!0,rfoot_obj=e.meshes[0],rfoot_obj.checkCollisions=!0,rfoot_meshes=e.meshes,rfoot_obj.setEnabled(!1),rfoot_obj.isVisible=!1,e.meshes.forEach(function(e){e.isPickable=!0})}),BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/storyMbayeScene/","collageWall2.glb",scene).then(function(e){e.meshes[0].scaling=new BABYLON.Vector3(.7,.4,-.5),e.meshes[1].name="collageWall",(collage_wall=e.meshes[1]).isVisible=!1,e.meshes[0].position=WALL_INIT_POS})]).then(()=>{(earth_obj=init_earth()).setEnabled(!1),setup_collage()})}let currTimer,worldFlowers,video31,dome,currStageObjMap=new Map,stage32map=new Map,stage25map=[];function setup_stage(e){let t=[];if(currTimer&&clearTimeout(currTimer),remove_texts(),remove_stage_objects(),34.5===e?(e="after34",stageMap.has(e)&&(t=stageMap.get(e).imagesUsed)):stageMap.has(e)&&(t=stageMap.get(e).imagesUsed),setTimeout(function(){create_texts(e)},100),24===e)load_music("Bpm4BOzwIec",2),check_if_in_3d_map(),$(".firstVideoOverlayText").css("font-size","3vw"),mbaye_obj.setEnabled(!0),mbaye_obj.isVisible=!0,setCamDefault(500),mbaye_obj.rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(-105),0),storyCamera.targetScreenOffset=new BABYLON.Vector2(0,-2),animateCameraToRadius(storyCamera,25,frameCount,80),isMbayeRotateActive=!0,storyCamera.attachControl(canvas,!0);else if(25===e){for($(".firstVideoOverlayText").css("font-size","3vw"),setCamDefault(500),mbaye_obj.setEnabled(!1),mbaye_obj.isVisible=!1,dome&&dome.dispose(),i=0;i<t.length;i++){let a=stageMap.get(e).imagePos,o=init_photo(t[i],{w:300,h:300},a[i],e);o.visibility=0,i<18?add_delay(o,2e3,2500):add_delay(o,1e3,1e3),currStageObjMap.set(o.name,o),stage25map.push(o)}currTimer=setTimeout(function(){for(i=0;i<stage25map.length;i++)i<18?animateObjectFadeOut(stage25map[i],30,200,1):animateObjectFadeOut(stage25map[i],30,200,0)},4e3),storyCamera.detachControl(canvas,!0)}else if(26===e){$("#firstVideoOverlayText").css("color","#0ab7ea"),setup_3D_photo(),set_camera_specs(e);let a=init_photo(t[0],{w:500,h:500},{x:-200,y:-20,z:-30},e);currStageObjMap.set(a.name,a),add_delay(a,2e3,3e3),storyCamera.attachControl(canvas,!0)}else if(27===e){$("#firstVideoOverlayText").css({color:"#0ab7ea","font-size":"3.2vw"}),setCamDefault(),set_camera_specs(e),dome&&dome.dispose();let a=init_photo(t[1],{w:700,h:700},{x:-800,y:200,z:-1200},e),o=init_photo(t[2],{w:700,h:700},{x:0,y:0,z:-1200},e),i=init_photo(t[0],{w:700,h:700},{x:800,y:200,z:-1200},e);currStageObjMap.set(a.name,a),currStageObjMap.set(o.name,o),currStageObjMap.set(i.name,i),a&&animateObjectPosition(a,20,frameCount,new BABYLON.Vector3(-800,200,0)),o&&animateObjectPosition(o,10,100,new BABYLON.Vector3(0,0,-600)),i&&animateObjectPosition(i,20,frameCount,new BABYLON.Vector3(800,200,0)),hl.addMesh(a,new BABYLON.Color3(0,.5,.5)),hl.addMesh(o,new BABYLON.Color3(0,.5,.5)),hl.addMesh(i,new BABYLON.Color3(0,.5,.5)),storyCamera.detachControl(canvas,!0)}else if(28===e)mbaye_obj.setEnabled(!1),mbaye_obj.isVisible=!1,$("#firstVideoOverlayText").css({color:"#efad0c","font-size":"3.5vw"}),setCamLateralLeft(),setFlowerVisibility(),(worldFlowers=init_photo(t[0],{w:600,h:600},{x:1200,y:0,z:-300},e)).rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(-90),0),set_camera_specs(e),currStageObjMap.set(worldFlowers.name,worldFlowers);else if(29===e){$(".firstVideoOverlayText").css("font-size","3vw"),mbaye_obj.setEnabled(!1),mbaye_obj.isVisible=!1,setCamDefault(400),removeFlowers(),set_camera_specs(e),scene.animatables.forEach(function(e){e.stop()});let a=1e3;for(i=0;i<t.length;i++){let o=stageMap.get(e).imagePos,s=init_photo(t[i],{w:300,h:300},o[i],e);add_delay(s,a,2e3),currStageObjMap.set(s.name,s),a+=1e3}}else if(30===e){setCamDefault(),mbaye_obj.setEnabled(!1),mbaye_obj.isVisible=!1,set_camera_specs(e),$(".firstVideoOverlayText").css("font-size","3vw");let a=init_photo(t[0],{w:250,h:300},{x:0,y:200,z:-400},e),o=init_photo(t[1],{w:250,h:300},{x:-900,y:300,z:-400},e),i=init_photo(t[2],{w:250,h:300},{x:-700,y:-250,z:-400},e),s=init_photo(t[3],{w:250,h:300},{x:900,y:300,z:-400},e),n=init_photo(t[4],{w:250,h:300},{x:700,y:-250,z:-400},e),r=init_photo(t[5],{w:250,h:300},{x:0,y:200,z:-400},e),l=init_photo(t[6],{w:250,h:300},{x:-900,y:300,z:-400},e),c=init_photo(t[7],{w:250,h:300},{x:-700,y:-250,z:-400},e),m=init_photo(t[8],{w:250,h:300},{x:900,y:300,z:-400},e),d=init_photo(t[9],{w:250,h:300},{x:700,y:-250,z:-400},e);r.material.emissiveColor=BABYLON.Color3.Green(),l.material.emissiveColor=BABYLON.Color3.Green(),c.material.emissiveColor=BABYLON.Color3.Green(),m.material.emissiveColor=BABYLON.Color3.Green(),d.material.emissiveColor=BABYLON.Color3.Green();let u=init_photo(t[10],{w:400,h:400},{x:800,y:250,z:-800},e),b=init_photo(t[11],{w:400,h:400},{x:-400,y:-280,z:-800},e),y=init_photo(t[12],{w:350,h:350},{x:-800,y:300,z:-800},e),p=init_photo(t[13],{w:250,h:250},{x:400,y:-350,z:-800},e);if(u.rotation.y=BABYLON.Tools.ToRadians(-110),y.rotation.y=BABYLON.Tools.ToRadians(110),p.rotation.y=BABYLON.Tools.ToRadians(-100),b.rotation.y=BABYLON.Tools.ToRadians(100),u.visibility=0,b.visibility=0,y.visibility=0,p.visibility=0,r.visibility=0,l.visibility=0,c.visibility=0,m.visibility=0,d.visibility=0,currStageObjMap.set(a.name,a),currStageObjMap.set(o.name,o),currStageObjMap.set(i.name,i),currStageObjMap.set(s.name,s),currStageObjMap.set(n.name,n),currStageObjMap.set(r.name,r),currStageObjMap.set(l.name,l),currStageObjMap.set(c.name,c),currStageObjMap.set(m.name,m),currStageObjMap.set(d.name,d),currStageObjMap.set(u.name,u),currStageObjMap.set(y.name,y),currStageObjMap.set(b.name,b),currStageObjMap.set(p.name,p),add_delay(a,500,2500),add_delay(o,500,2500),add_delay(i,500,2500),add_delay(s,500,2500),add_delay(n,500,2500),currTimer=setTimeout(function(){animateObjectFadeOut(a,30,200,0),animateObjectFadeOut(o,30,200,0),animateObjectFadeOut(i,30,200,0),animateObjectFadeOut(s,30,200,0),animateObjectFadeOut(n,30,200,0),animateObjectFadeOut(r,30,200,1),animateObjectFadeOut(l,30,200,1),animateObjectFadeOut(c,30,200,1),animateObjectFadeOut(m,30,200,1),animateObjectFadeOut(d,30,200,1)},3e3),currTimer=setTimeout(function(){animateObjectRotation(u,20,100,new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(0),0)),animateObjectRotation(y,20,100,new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(0),0)),animateObjectRotation(p,20,100,new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(0),0)),animateObjectRotation(b,20,100,new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(0),0)),animateObjectFadeOut(u,50,200,1),animateObjectFadeOut(b,50,200,1),animateObjectFadeOut(y,50,200,1),animateObjectFadeOut(p,50,200,1)},5e3),play_music(),video31){$("#stage31VideoLayer").css("display","none");try{video31.pause(),video31.currentTime=0}catch(e){}}}else if(31===e)stop_music(),$(".firstVideoOverlayText").css("font-size","4.5vw"),setCamDefault(80),mbaye_obj.isVisible=!1,mbaye_obj.setEnabled(!1),scene.animatables.forEach(function(e){e.stop()}),$("#stage31VideoLayer").css("display","block"),(video31=document.getElementById("theVid")).play(),video31.muted=!1,video31.loop=!0;else if(32===e){load_music("Ji-6gfWQq-s",1),$("#firstVideoOverlayText").css({"font-size":"4.2vw"}),setCamDefault(75),mbaye_obj.rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(-105),0),mbaye_obj.isVisible=!0,mbaye_obj.setEnabled(!0),$("#stage31VideoLayer").css("display","none");try{video31.pause(),video31.currentTime=0}catch(e){}change_collage_photo(e),collage_wall.isVisible=!0,add_delay(collage_wall,1e3,2e3)}else if(33===e){$("#firstVideoOverlayText").css({color:"#efad0c","font-size":"4.2vw"}),collage_wall.isVisible=!1,collage_wall.setEnabled(!1),setCamDefault(100),mbaye_obj.rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(-105),0),mbaye_obj.isVisible=!1,mbaye_obj.setEnabled(!1);let a=init_photo(t[0],{w:1100,h:600},{x:0,y:0,z:-500},e);currStageObjMap.set(a.name,a),currTimer=setTimeout(function(){animateObjectFadeOut(a,30,200,0)},2e3),currTimer=setTimeout(function(){mbaye_obj.isVisible=!0,mbaye_obj.setEnabled(!0),animateObjectRotationNoEase(mbaye_obj,20,frameCount,new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(255),0)),add_delay(mbaye_obj,100,1e3)},3500)}else if(34===e){$(".firstVideoOverlayText").css("font-size","3vw"),mbaye_obj.isVisible=!1,mbaye_obj.setEnabled(!1),setCamDefault(1500),animateCameraToRadius(storyCamera,20,frameCount,300);let a=init_photo(t[0],{w:600,h:500},{x:0,y:0,z:-500},e);currStageObjMap.set(a.name,a)}else"after34"===e&&(rfoot_obj.isVisible=!0,rfoot_obj.setEnabled(!0),$("#firstVideoOverlayText").css({"font-size":"3.7vw"}),rfoot_obj.rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(90),0),setCamSuperior(300),storyCamera.targetScreenOffset=new BABYLON.Vector2(0,-4),animateCameraToRadius(storyCamera,40,frameCount,45),storyCamera.attachControl(canvas,!0))}function set_camera_specs(e){26===e?(storyCamera.lowerAlphaLimit=.9059762890318959,storyCamera.upperAlphaLimit=2.152565254742033,storyCamera.lowerBetaLimit=1.154381248012086,storyCamera.upperBetaLimit=2.3110118760751495,storyCamera.upperRadiusLimit=600):27===e?(storyCamera.lowerAlphaLimit=null,storyCamera.upperAlphaLimit=1e3,storyCamera.lowerBetaLimit=.01,storyCamera.upperBetaLimit=3.1315926535897933,storyCamera.upperRadiusLimit=1500,storyCamera.radius=1500):28===e?storyCamera.upperRadiusLimit=150:29===e?storyCamera.upperRadiusLimit=1500:30===e&&(storyCamera.radius=900)}function setup_3D_photo(){dome&&dome.dispose(),(dome=new BABYLON.PhotoDome("testdome","front/images3D/storyMbayeScene/flower.jpg",{resolution:64,size:1e3},scene)).rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(-130),0)}let isSoundIconClicked=!1;$(document).ready(function(){setup_music_player();var e=createChapter2Scene();initialize_icons(),e.executeWhenReady(function(){document.getElementById("loadingScreenDiv").style.display="none",document.getElementById("loadingScreenPercent").style.display="none",$(".firstVideoOverlayText").css("display","block"),$(".dropdown-list").css("display","block"),show_3D_icons(),rotate_sky(),currentStage=24,setup_stage(24);let t=!1,a=!1;engine.runRenderLoop(function(){e&&(e.render(),yt_player&&currentStage<32?Math.ceil(yt_player.getCurrentTime())>=180&&!t?(stop_music(),play_music(),t=!0):t=!1:yt_player&&currentStage>=32&&currentStage<=34&&(Math.ceil(yt_player.getCurrentTime())>=90&&!a?(stop_music(),play_music(),a=!0):a=!1))}),window.addEventListener("resize",function(){engine.resize(),testOrientation(),testFullscreen()})})}),$("#continueBtn").on("click",function(e){if(currentStage<35)$("#continueBtnDiv").css("visibility","hidden"),$("#prevBtnDiv").css("visibility","hidden"),34==currentStage?(setup_stage(34.5),currentStage++):setup_stage(++currentStage),check_if_in_3d_map();else{let e=3;$.ajax({type:"get",url:urlStory,data:{chapter_no:e,_token:token},success:function(t){window.location.href=urlStory+"?cNo="+e}})}}),$("#prevBtn").on("click",function(e){if(--currentStage<=35&&currentStage>=24)$("#continueBtnDiv").css("visibility","hidden"),$("#prevBtnDiv").css("visibility","hidden"),setup_stage(currentStage),check_if_in_3d_map();else if(currentStage<24){let e=1;$.ajax({type:"get",url:urlStory,data:{chapter_no:e,_token:token},success:function(t){window.location.href=urlStory+"?cNo="+e}})}});