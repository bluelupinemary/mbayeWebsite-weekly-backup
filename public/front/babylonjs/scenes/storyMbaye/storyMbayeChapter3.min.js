let canvas,engine,theAstroFace,storyCamera,hl,starColor,skybox,rfoot_obj,collage_wall,DISC_CAM_INIT_POS={x:2.83,y:.44,z:580.01},cameraInitState={position:null,a:null,b:null,r:null,upperA:null,lowerA:null,upperB:null,lowerB:null,upperR:null,lowerR:null,angularY:null},astroInitState={x:0,y:0,z:0},currentStage=35,createChapter3Scene=function(){canvas=document.getElementById("canvas"),(engine=new BABYLON.Engine(canvas,!0,{preserveDrawingBuffer:!0,stencil:!0})).enableOfflineSupport=!0,scene=new BABYLON.Scene(engine),BABYLON.Database.IDBStorageEnabled=!0;let e=new BABYLON.CubeTexture.CreateFromPrefilteredData("front/textures/environment.dds",scene);return e.gammaSpace=!1,scene.environmentTexture=e,load_3D_mesh(),skybox=create_skybox(),storyCamera=create_camera(),storyLight=create_light(),load_orig_flowers(3),hl=new BABYLON.HighlightLayer("hl1",scene),scene};var WALL_INIT_POS=new BABYLON.Vector3(-9.12,0,-1100);function load_3D_mesh(){Promise.all([BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/feetMbayeScene/","FrontRFoot.babylon",scene).then(function(e){e.meshes[0].scaling=new BABYLON.Vector3(12,12,12),e.meshes[0].isPickable=!0,(rfoot_obj=e.meshes[0]).checkCollisions=!0,rfoot_meshes=e.meshes,e.meshes.forEach(function(e){e.isPickable=!0})}),BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/storyMbayeScene/","collageWall2.glb",scene).then(function(e){e.meshes[0].scaling=new BABYLON.Vector3(.7,.4,-.5),e.meshes[1].name="collageWall",(collage_wall=e.meshes[1]).isVisible=!1,e.meshes[0].position=WALL_INIT_POS})]).then(()=>{setup_collage()})}let earth_obj,currTimer,worldFlowers,videoDisc,dome,currStageObjMap=new Map;function setup_stage(e){let t=[];if(currTimer&&clearTimeout(currTimer),remove_texts(),remove_stage_objects(),remove_highlighted_objects(hl),stageMap.has(e)&&(t=stageMap.get(e).imagesUsed),setTimeout(function(){create_texts(e)},100),35===e)load_music("5Gvrp20_WXM",20),check_if_in_3d_map(),$(".firstVideoOverlayText").css("font-size","3vw"),storyCamera.radius=45,rfoot_obj.setEnabled(!0),rfoot_obj.isVisible=!0,rfoot_obj.rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(90),0),storyCamera.targetScreenOffset=new BABYLON.Vector2(0,2),animateObjectRotationNoEase(rfoot_obj,10,frameCount,new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(450),0)),storyCamera.attachControl(canvas,!0);else if(36===e){$(".firstVideoOverlayText").css("font-size","4.5vw"),setCamDefault(150),storyCamera.targetScreenOffset=new BABYLON.Vector2(0,0),rfoot_obj.isVisible=!1,rfoot_obj.setEnabled(!1);let o=init_photo(t[0],{w:700,h:450},{x:0,y:0,z:0},e);currStageObjMap.set(o.name,o),animateCameraToRadius(storyCamera,20,frameCount,500),storyCamera.detachControl(canvas,!0)}else if(37===e)$("#firstVideoOverlayText").css({color:"#37fff6","font-size":"3vw"}),scene.animatables.forEach(function(e){e.stop()}),rfoot_obj.isVisible=!1,rfoot_obj.setEnabled(!1),setCamDefault(50),change_collage_photo(e),collage_wall.isVisible=!0,collage_wall.setEnabled(!0);else if(38===e){$("#firstVideoOverlayText").css({color:"#efad0c","font-size":"3.5vw"}),collage_wall.isVisible=!1,collage_wall.setEnabled(!1),rfoot_obj.isVisible=!1,rfoot_obj.setEnabled(!1),storyCamera.radius=140,storyCamera.alpha=1.5784,storyCamera.beta=1.5814;let o=1e3;for(i=0;i<t.length;i++){let a=stageMap.get(e).imagePos,s=init_photo(t[i],{w:70,h:70},a[i],e);add_delay(s,o,2e3),currStageObjMap.set(s.name,s),o+=2e3}if(videoDisc)try{let e=videoDisc.material.diffuseTexture.video;e.pause(),e.currentTime=0}catch(e){}}else if(39===e)$("#firstVideoOverlayText").css({"font-size":"3vw"}),setCamDefault(500),rfoot_obj.isVisible=!1,rfoot_obj.setEnabled(!1),rfoot_obj.position=new BABYLON.Vector3(0,0,0),(videoDisc=init_video("videoStage39",550,e)).material.diffuseTexture.uOffset=.16,videoDisc.material.diffuseTexture.uScale=.7,currStageObjMap.set(videoDisc.name,videoDisc),hl.addMesh(videoDisc,new BABYLON.Color3(0,.5,.5));else if(40===e){if($("#firstVideoOverlayText").css({"font-size":"4vw"}),videoDisc)try{let e=videoDisc.material.diffuseTexture.video;e.pause(),e.currentTime=0}catch(e){}setCamDefault(850),rfoot_obj.isVisible=!1,rfoot_obj.setEnabled(!1),rfoot_obj.position=new BABYLON.Vector3(0,0,0);let o=[],a=stageMap.get(e).imagePos;for(i=0;i<t.length;i++){let s=init_photo(t[i],{w:250,h:300},a[i],e);o.push(s),currStageObjMap.set(s.name,s),i>4&&(s.visibility=0)}currTimer=setTimeout(function(){for(i=0;i<o.length;i++)i<5?animateObjectFadeOut(o[i],30,200,0):animateObjectFadeOut(o[i],30,200,1)},2e3)}else if(41===e)$("#firstVideoOverlayText").css({"font-size":"3.5vw"}),rfoot_obj.rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(90),0),rfoot_obj.isVisible=!1,rfoot_obj.setEnabled(!1),setCamLateralLeft(),storyCamera.alpha=2.8724466335934786,storyCamera.beta=1.3812596352337896,setFlowerVisibility(!0),storyCamera.upperRadiusLimit=1800,storyCamera.radius=1e3,animateCameraToRadius(storyCamera,20,frameCount,1700);else if(42===e){$("#firstVideoOverlayText").css({"font-size":"3.7vw"}),setFlowerVisibility(!1),setCamDefault(300),storyCamera.radius=300,rfoot_obj.isVisible=!1,rfoot_obj.setEnabled(!1),storyCamera.targetScreenOffset=new BABYLON.Vector2(0,0),storyCamera.upperRadiusLimit=1500;let o=init_photo(t[0],{w:700,h:700},{x:0,y:0,z:-1e3},e);currStageObjMap.set(o.name,o),play_music()}else if(43===e){$("#firstVideoOverlayText").css({"font-size":"4vw"}),setCamDefault(180),rfoot_obj.isVisible=!1,rfoot_obj.setEnabled(!1);let o=init_photo(t[0],{w:1200,h:600},{x:0,y:0,z:-500},e);currStageObjMap.set(o.name,o),add_delay(o,1e3,4e3)}else if(44===e)$("#firstVideoOverlayText").css({"font-size":"3.5vw"}),setCamDefault(300),rfoot_obj.isVisible=!1,rfoot_obj.setEnabled(!1),change_collage_photo(e),collage_wall.isVisible=!0,collage_wall.setEnabled(!0),animateCameraToRadius(storyCamera,30,frameCount,800);else if(45===e){$("#firstVideoOverlayText").css({"font-size":"3.2vw"}),collage_wall.isVisible=!1,collage_wall.setEnabled(!1),rfoot_obj.position=new BABYLON.Vector3(-70,-25,390),rfoot_obj.rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(115),0),rfoot_obj.isVisible=!0,rfoot_obj.setEnabled(!0),setCamDefault(200);let o=[],a=stageMap.get(e).imagePos;for(i=0;i<t.length;i++){let a=init_photo(t[i],{w:10,h:10},{x:-80,y:-25,z:380},e);o.push(a),currStageObjMap.set(a.name,a),hl.addMesh(a,new BABYLON.Color3(0,.5,.5))}currTimer=setTimeout(function(){for(i=0;i<o.length;i++)animateObjectPosition(o[i],20,frameCount,a[i]),animateObjectScaling(o[i],20,frameCount,new BABYLON.Vector3(15,15,15))},3e3),animateCameraToRadius(storyCamera,50,frameCount,500)}}function setup_3D_photo(){dome&&dome.dispose(),(dome=new BABYLON.PhotoDome("testdome","front/textures/storyMbaye/collage-37-1.png",{resolution:64,size:1e3},scene)).rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(-130),0)}let isSoundIconClicked=!1;$(document).ready(function(){setup_music_player();var e=createChapter3Scene();let t;if(e.isLoading){let e=0;t=setInterval(function(){e<101&&(document.getElementById("loadingScreenPercent").innerHTML="Loading: "+e+" %",e++)},250)}initialize_icons(),e.executeWhenReady(function(){clearInterval(t),document.getElementById("loadingScreenPercent").innerHTML="Loading: 100%",document.getElementById("loadingScreenDiv").style.display="none",document.getElementById("loadingScreenPercent").style.display="none",$(".firstVideoOverlayText").css("display","block"),$(".dropdown-list").css("display","block"),show_3D_icons(),rotate_sky(),currentStage=35,setup_stage(35),engine.runRenderLoop(function(){e&&e.render()}),window.addEventListener("resize",function(){engine.resize(),testOrientation(),testFullscreen()})})}),$("#continueBtn").on("click",function(e){if(currentStage<45)$("#continueBtnDiv").css("visibility","hidden"),$("#prevBtnDiv").css("visibility","hidden"),setup_stage(++currentStage),check_if_in_3d_map();else{let e=4;$.ajax({type:"get",url:urlStory,data:{chapter_no:e,_token:token},success:function(t){window.location.href=urlStory+"?cNo="+e}})}}),$("#prevBtn").on("click",function(e){if(--currentStage<=45&&currentStage>=35)$("#continueBtnDiv").css("visibility","hidden"),$("#prevBtnDiv").css("visibility","hidden"),setup_stage(currentStage),check_if_in_3d_map();else if(currentStage<35){let e=2;$.ajax({type:"get",url:urlStory,data:{chapter_no:e,_token:token},success:function(t){window.location.href=urlStory+"?cNo="+e}})}});