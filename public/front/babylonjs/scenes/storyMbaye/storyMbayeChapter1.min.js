let canvas,engine,theAstroFace,storyCamera,hl,starColor,skybox,currentStage,earth_obj,collage_wall,DISC_CAM_INIT_POS={x:2.83,y:.44,z:580.01},cameraInitState={position:null,a:null,b:null,r:null,upperA:null,lowerA:null,upperB:null,lowerB:null,upperR:null,lowerR:null,angularY:null},astroInitState={x:0,y:0,z:0},createChapter1Scene=function(){canvas=document.getElementById("canvas"),(engine=new BABYLON.Engine(canvas,!0,{preserveDrawingBuffer:!0,stencil:!0})).enableOfflineSupport=!0,scene=new BABYLON.Scene(engine),BABYLON.Database.IDBStorageEnabled=!0;let e=new BABYLON.CubeTexture.CreateFromPrefilteredData("front/textures/environment.dds",scene);return e.gammaSpace=!1,scene.environmentTexture=e,load_3D_mesh(),skybox=create_skybox(),storyCamera=create_camera(),storyLight=create_light(),hl=new BABYLON.HighlightLayer("hl1",scene),scene};var WALL_INIT_POS=new BABYLON.Vector3(-9.12,0,-1500);function load_3D_mesh(){var e=0;Promise.all([BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/storyMbayeScene/","collageWall2.glb",scene,function(t){if(t.lengthComputable)e=(100*t.loaded/t.total).toFixed();else{var a=t.loaded/1048576;e+=Math.floor(100*a)/100}document.getElementById("loadingScreenPercent").innerHTML="Loading: "+e+" %"}).then(function(e){e.meshes[0].scaling=new BABYLON.Vector3(.7,.4,-.5),e.meshes[1].name="collageWall",collage_wall=e.meshes[1],e.meshes[0].position=WALL_INIT_POS})]).then(()=>{(earth_obj=init_earth()).setEnabled(!1)})}let currTimer,currStageObjMap=new Map;function setup_stage(e){if(2===e){load_music("PrWpQsLxMOM",1),setCamDefault(),remove_texts(),remove_stage_objects(),remove_highlighted_objects(hl);stageMap.get(e).imagesUsed;setup_collage(),setTimeout(function(){create_texts(e)},100);let t=init_photo("burj.png",{w:40,h:80},{x:0,y:55,z:-889.87},e);t.setEnabled(!1),currStageObjMap.set(t.name,t),currTimer=setTimeout(function(){t.setEnabled(!0),animateObjectScaling(t,20,frameCount,new BABYLON.Vector3(10,10,10)),animateCameraToRadius(storyCamera,20,frameCount,500)},6e3)}else if(e>=3){collage_wall&&(collage_wall.isVisible=!1),currTimer&&clearTimeout(currTimer),remove_texts(),remove_stage_objects(),remove_highlighted_objects(hl);let t=stageMap.get(e).imagesUsed;if(setTimeout(function(){create_texts(e)},100),3===e)setCamDefault(),animateCameraToRadius(storyCamera,20,frameCount,500),change_collage_photo(e),collage_wall.isVisible=!0,add_delay(collage_wall,3e3,5e3);else if(4===e){setCamDefault(),$(".firstVideoOverlayText").css("font-size","3.8vw");let t=init_disc(e);currStageObjMap.set(t.name,t),setCamInferior(),collage_wall.setEnabled(!1),currTimer=setTimeout(function(){t&&animateObjectScaling(t,20,frameCount,new BABYLON.Vector3(1.7,1.7,1.7))},100)}else if(5===e){setCamDefault(),storyLight.intensity=.5;let a=init_photo(t[0],{w:500,h:400},{x:0,y:-1e3,z:-100},e),i=init_photo(t[1],{w:500,h:400},{x:-500,y:-1e3,z:200},e),o=init_photo(t[2],{w:600,h:480},{x:600,y:-1e3,z:200},e);currStageObjMap.set(a.name,a),add_delay(a,2e3,3e3),currStageObjMap.set(i.name,i),add_delay(i,4e3,3e3),currStageObjMap.set(o.name,o),add_delay(o,6e3,3e3),setCamSuperior()}else if(6===e){let a=init_photo(t[0],{w:600,h:480},{x:520,y:-1e3,z:-150},e);add_delay(a,2e3,5e3),currStageObjMap.set(a.name,a)}else if(7===e){storyCamera.attachControl(canvas,!0);let a=init_photo(t[0],{w:500,h:400},{x:650,y:-1e3,z:-220},e),i=init_photo(t[1],{w:600,h:480},{x:-600,y:-1e3,z:100},e);currStageObjMap.set(a.name,a),add_delay(a,2e3,4e3),currStageObjMap.set(i.name,i),add_delay(i,5e3,4e3)}else if(8===e)load_music("Rf637J1TRT4",1),isMuted&&yt_player.pauseVideo(),$("#firstVideoOverlayText").css("color","white"),$("#firstVideoOverlayText").css("-webkit-text-stroke","2px #06508dbf"),setCamDefault(),animateCameraToRadius(storyCamera,20,frameCount,500),change_collage_photo(e),collage_wall.setEnabled(!0),collage_wall.isVisible=!0,add_delay(collage_wall,2e3,5e3);else if(9===e){$("#firstVideoOverlayText").css({color:"#efad0c","text-shadow":"-2px 1px 10px #000000","-webkit-text-stroke":"","font-weight":""});let t=init_disc(e);currStageObjMap.set(t.name,t),setCamInferior(),currTimer=setTimeout(function(){t&&animateObjectScaling(t,20,frameCount,new BABYLON.Vector3(1.9,1.9,1.9))},100)}else if(10===e){collage_wall.isVisible=!1,currTimer&&clearTimeout(currTimer);let t=init_disc(e,400);currStageObjMap.set(t.name,t),currTimer=setTimeout(function(){t&&animateObjectPosition(t,20,frameCount,new BABYLON.Vector3(-400,1e3,0))},1e3)}else if(11===e){$(".firstVideoOverlayText").css("font-size","3vw"),$("#firstVideoOverlayText").css("color","#1bbceb"),$("#firstVideoOverlayText").css("-webkit-text-stroke","2px #06508dbf"),setCamDefault(),animateCameraToRadius(storyCamera,20,frameCount,500),change_collage_photo(e),collage_wall.isVisible=!0,add_delay(collage_wall,2e3,5e3);let a=init_photo(t[0],{w:50,h:50},{x:-60,y:0,z:-800},e);a.setEnabled(!1),currStageObjMap.set(a.name,a),currTimer=setTimeout(function(){a.setEnabled(!0),animateObjectScaling(a,20,frameCount,new BABYLON.Vector3(20,20,5))},8e3)}else if(12===e){$(".firstVideoOverlayText").css("font-size","4.2vw"),$("#firstVideoOverlayText").css({color:"#efad0c","text-shadow":"-2px 1px 10px #000000","-webkit-text-stroke":"","font-weight":""}),setCamInferior(),collage_wall.setEnabled(!1);let t=init_disc(e,300);currStageObjMap.set(t.name,t)}else if(13===e){$(".firstVideoOverlayText").css("font-size","3vw"),setCamDefault(500),earth_obj.setEnabled(!0);let a=init_photo(t[0],{w:20,h:20},{x:0,y:0,z:0},e),i=init_photo(t[1],{w:20,h:20},{x:0,y:0,z:0},e);currStageObjMap.set(a.name,a),currTimer=setTimeout(function(){a&&animateObjectPosition(a,20,frameCount,new BABYLON.Vector3(150,-30,0)),animateObjectScaling(a,20,frameCount,new BABYLON.Vector3(10,10,5))},100),currTimer=setTimeout(function(){i&&animateObjectPosition(i,20,frameCount,new BABYLON.Vector3(-300,100,0)),animateObjectScaling(i,20,frameCount,new BABYLON.Vector3(10,10,5))},1e3),currStageObjMap.set(i.name,i)}else if(14===e){$(".firstVideoOverlayText").css("font-size","3vw"),earth_obj.setEnabled(!1),setCamInferior();let t=init_disc(e,300);currStageObjMap.set(t.name,t)}else if(15===e)$(".firstVideoOverlayText").css("font-size","3vw"),earth_obj.position=new BABYLON.Vector3(-100,0,0),earth_obj.setEnabled(!0),setCamDefault(400);else if(16===e)setCamDefault(),$(".firstVideoOverlayText").css("font-size","3vw"),earth_obj.position=new BABYLON.Vector3(0,0,0),change_collage_photo(e),collage_wall.setEnabled(!0),collage_wall.isVisible=!0,isEarthRotating=!1,earth_obj.position=new BABYLON.Vector3(250,-120,1100),earth_obj.rotation=new BABYLON.Vector3(0,-3.5,0),currTimer=setTimeout(function(){isEarthRotating=!0},2e3),storyCamera.detachControl(canvas,!0);else if(17===e)$("#firstVideoOverlayText").css("color","#0ab7ea"),create_snow_emitter(),setCamDefault(490),change_collage_photo(e),collage_wall.isVisible=!0,add_delay(collage_wall,100,2e3),collage_wall.position=new BABYLON.Vector3(0,0,1600),isEarthRotating=!1,earth_obj.rotation=new BABYLON.Vector3(0,1,.3),earth_obj.setEnabled(!1),earth_obj.isVisible=!1,storyCamera.attachControl(canvas,!0);else if(18===e)storyCamera.detachControl(canvas),$("#firstVideoOverlayText").css({color:"#efad0c","font-size":"3.5vw"}),earth_obj.position=new BABYLON.Vector3(270,-120,500),earth_obj.setEnabled(!0),earth_obj.isVisible=!0,setCamDefault(490),animateCameraToRadius(storyCamera,50,frameCount,900),collage_wall.position=new BABYLON.Vector3(0,0,-1100),change_collage_photo(e),collage_wall.isVisible=!0,add_delay(collage_wall,1e3,2e3),currTimer=setTimeout(function(){isEarthRotating=!0},3e3),storyCamera.detachControl(canvas,!0);else if(19===e)$("#firstVideoOverlayText").css({"font-size":"3vw"}),earth_obj.setEnabled(!1),earth_obj.isVisible=!1,collage_wall.position.z=-1200,collage_wall.isVisible=!0,change_collage_photo(e),add_delay(collage_wall,2e3,5e3),setCamDefault(),animateCameraToRadius(storyCamera,15,frameCount,100);else if(20===e)$("#firstVideoOverlayText").css({"font-size":"4.2vw"}),change_collage_photo(e),collage_wall.isVisible=!1,setCamDefault(1e3),currTimer=setTimeout(function(){collage_wall.isVisible=!0,animateCameraToRadius(storyCamera,20,frameCount,100),add_delay(collage_wall,1e3,5e3)},1e3);else if(21===e){$("#firstVideoOverlayText").css({"font-size":"3.2vw"}),earth_obj.position=new BABYLON.Vector3(-270,-120,500),earth_obj.rotation=new BABYLON.Vector3(0,0,0),earth_obj.setEnabled(!0),earth_obj.isVisible=!0;let a=init_photo(t[0],{w:500,h:500},{x:700,y:170,z:-300},e),i=init_photo(t[1],{w:500,h:500},{x:150,y:-170,z:-300},e);currStageObjMap.set(a.name,a),currStageObjMap.set(i.name,i),setCamDefault(600),animateCameraToRadius(storyCamera,50,frameCount,900),isEarthRotating=!0}else if(22===e){$("#firstVideoOverlayText").css({"font-size":"3.2vw"}),setCamInferior(),earth_obj.setEnabled(!1),earth_obj.isVisible=!1;let a=init_photo(t[0],{w:700,h:700},{x:0,y:1e3,z:0},e);a.rotation=new BABYLON.Vector3(BABYLON.Tools.ToRadians(90),BABYLON.Tools.ToRadians(0),BABYLON.Tools.ToRadians(180)),currStageObjMap.set(a.name,a)}else 23===e&&($("#firstVideoOverlayText").css({"font-size":"3.2vw"}),setCamDefault(50),animateCameraToRadius(storyCamera,30,frameCount,1200),change_collage_photo(e),collage_wall.isVisible=!0,storyCamera.detachControl(canvas,!0))}}function create_snow_emitter(){var e=BABYLON.Mesh.CreatePlane("sky",500,scene);e.position=new BABYLON.Vector3(0,600,-300),e.isVisible=!1,e.scaling=new BABYLON.Vector3(10,1,10);var t=new BABYLON.ParticleSystem("particleSys",2e5,scene);t.renderingGroupId=2,t.particleTexture=new BABYLON.Texture(texturePath+"flare.png",scene),t.emitter=e,t.minEmitBox=new BABYLON.Vector3(-100,0,-100),t.maxEmitBox=new BABYLON.Vector3(100,0,100),t.color1=new BABYLON.Color4(1,1,1,1),t.color2=new BABYLON.Color4(1,1,1,.7),t.colorDead=new BABYLON.Color4(0,0,.2,0),t.minSize=5,t.maxSize=10,t.minLifeTime=.3,t.maxLifeTime=15,t.emitRate=1e3,t.blendMode=BABYLON.ParticleSystem.BLENDMODE_ONEONE,t.gravity=new BABYLON.Vector3(0,-9.81,0),t.direction1=new BABYLON.Vector3(-7,-8,3),t.direction2=new BABYLON.Vector3(7,-8,-3),t.minAngularSpeed=0,t.maxAngularSpeed=Math.PI,t.minEmitPower=1,t.maxEmitPower=3,t.updateSpeed=.02,currStageObjMap.set(e.name,e),currStageObjMap.set(t.name,t),t.start()}let isSoundIconClicked=!1;$(document).ready(function(){setup_music_player();var e=createChapter1Scene();initialize_icons(),e.executeWhenReady(function(){document.getElementById("loadingScreenDiv").style.display="none",document.getElementById("loadingScreenPercent").style.display="none",$(".firstVideoOverlayText").css("display","block"),$(".dropdown-list").css("display","block"),show_3D_icons(),rotate_sky(),currentStage=2,setup_stage(2),engine.runRenderLoop(function(){e&&e.render()})})}),window.addEventListener("resize",function(){engine.resize(),testOrientation(),testFullscreen()}),$("#continueBtn").on("click",function(e){if(currentStage<23)$("#continueBtnDiv").css("visibility","hidden"),$("#prevBtnDiv").css("visibility","hidden"),setup_stage(++currentStage),check_if_in_3d_map();else{let e=2;$.ajax({type:"get",url:urlStory,data:{chapter_no:e,_token:token},success:function(t){window.location.href=urlStory+"?cNo="+e}})}}),$("#prevBtn").on("click",function(e){2==--currentStage&&$("#prevBtnDiv").css("visibility","hidden"),currentStage<23&&currentStage>1&&($("#continueBtnDiv").css("visibility","hidden"),$("#prevBtnDiv").css("visibility","hidden"),setup_stage(currentStage),check_if_in_3d_map())});