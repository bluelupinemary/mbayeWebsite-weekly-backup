let canvas,engine,theAstroFace,storyCamera,hl,starColor,skybox,head_obj,collage_wall,DISC_CAM_INIT_POS={x:2.83,y:.44,z:580.01},cameraInitState={position:null,a:null,b:null,r:null,upperA:null,lowerA:null,upperB:null,lowerB:null,upperR:null,lowerR:null,angularY:null},astroInitState={x:0,y:0,z:0},currentStage=24,faceFlowersMap=new Map,createChapter5Scene=function(){canvas=document.getElementById("canvas"),(engine=new BABYLON.Engine(canvas,!0,{preserveDrawingBuffer:!0,stencil:!0})).enableOfflineSupport=!0,scene=new BABYLON.Scene(engine),BABYLON.Database.IDBStorageEnabled=!0;let e=new BABYLON.CubeTexture.CreateFromPrefilteredData("front/textures/environment.dds",scene);return e.gammaSpace=!1,scene.environmentTexture=e,load_3D_mesh(),skybox=create_skybox(),storyCamera=create_camera(),storyLight=create_light(),hl=new BABYLON.HighlightLayer("hl1",scene),flowerColor=new BABYLON.HighlightLayer("hl1",scene),scene};var WALL_INIT_POS=new BABYLON.Vector3(-9.12,0,-1100);function load_3D_mesh(){Promise.all([BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/headMbayeScene/","HeadMbaye0803.glb",scene).then(function(e){e.meshes[0].scaling=new BABYLON.Vector3(12,12,-12),e.meshes[0].isPickable=!0,(head_obj=e.meshes[0]).checkCollisions=!0,e.meshes[0].rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(90),0),head_obj.isVisible=!1,head_obj.setEnabled(!1),e.meshes.forEach(function(e){if("FP7"===e.name&&(e.hasVertexAlpha=!1),e.isPickable=!0,"Head"===e.name||"FP1"===e.name||"FP2"===e.name||"FP3"===e.name||"FP4"===e.name||"FP5"===e.name||"FP6"===e.name||"FP7"===e.name||"FP8"===e.name||"FP9"===e.name||"FP10"===e.name||"FP11"===e.name||"FP12"===e.name||"FP13"===e.name||"FP14"===e.name||"FP15"===e.name||"FP16"===e.name||"FP17"===e.name||"FP18"===e.name||"FP17_primitive0"===e.name||"FP17_primitive1"===e.name||"FP8_primitive0"===e.name||"FP8_primitive1"===e.name){let t=new BABYLON.PBRMaterial("pbr",scene);e.material=t,e.material.backFaceCulling=!1,t.albedoColor=new BABYLON.Color3(.5,.5,.5),t.emissiveColor=new BABYLON.Color3(0,0,0),t.metallic=1,t.metallicF0Factor=.5,t.roughness=.15,t.microSurface=1}else if("L_EYEAventurine"===e.name||"R_EYEAventurine"===e.name)e.material.albedoColor=new BABYLON.Color3(.01,.2,.07);else if("L_EYEObsidian"===e.name||"R_EYEObsidian"===e.name||"__root__"===e.name);else if("HeadCover"===e.name)e.isVisible=!1;else{let t=new BABYLON.StandardMaterial("pbr",scene);e.material.transparencyMode=0,e.visibility=0,e.material=t,faceFlowersMap.set(e.name,e)}})}),BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/storyMbayeScene/","collageWall2.glb",scene).then(function(e){e.meshes[0].scaling=new BABYLON.Vector3(.7,.4,-.5),e.meshes[1].name="collageWall",(collage_wall=e.meshes[1]).isVisible=!1,e.meshes[0].position=WALL_INIT_POS})]).then(()=>{setup_collage()})}let earth_obj,currTimer,videoDisc,worldFlowers,dome,currStageObjMap=new Map;function setup_stage(e){let t=[];if(currTimer&&clearTimeout(currTimer),remove_texts(),remove_stage_objects(),stageMap.has(e)&&(t=stageMap.get(e).imagesUsed),setTimeout(function(){create_texts(e)},100),62===e){setCamDefault(150),load_music("zBFvHDdh7oo",2),$(".firstVideoOverlayText").css("font-size","5.5vw");let a=init_photo(t[0],{w:1200,h:600},{x:0,y:0,z:-700},e);currStageObjMap.set(a.name,a),add_delay(a,1e3,4e3),animateObjectPosition(a,20,frameCount,new BABYLON.Vector3(0,0,-500))}else if(63===e){setCamDefault(150),$(".firstVideoOverlayText").css("font-size","4.9vw");let a=1e3,n=stageMap.get(e).imagePos,s=stageMap.get(e).imageScale;for(i=0;i<t.length;i++){let o=init_photo(t[i],{w:200,h:200},{x:0,y:0,z:-600},e);add_delay(o,a,2e3),currStageObjMap.set(o.name,o),animateObjectPosition(o,20,frameCount,n[i]),animateObjectScaling(o,20,frameCount,s[i]),a+=1e3}}else if(64===e)setCamDefault(150),$(".firstVideoOverlayText").css("font-size","4.5vw");else if(65===e)setCamDefault(150),$(".firstVideoOverlayText").css("font-size","4vw");else if(66===e)setCamDefault(150),$(".firstVideoOverlayText").css("font-size","4.5vw");else if(67===e){setCamDefault(150),$(".firstVideoOverlayText").css("font-size","4.5vw");let a=stageMap.get(e).imagePos,n=1e3;for(i=0;i<t.length;i++){let s=init_photo(t[i],{w:200,h:200},{x:0,y:0,z:-800},e);add_delay(s,n,2e3),currStageObjMap.set(s.name,s),animateObjectPosition(s,20,frameCount,a[i]),n+=1e3,0==i&&(s.scaling=new BABYLON.Vector3(2,2,2))}}else if(68===e){setCamDefault(150),$(".firstVideoOverlayText").css("font-size","4.5vw");let a=stageMap.get(e).imagePos;for(i=0;i<t.length;i++){let n=init_photo(t[i],{w:200,h:200},a[i],e);add_delay(n,3e3,2e3),currStageObjMap.set(n.name,n)}}else if(69===e){setCamDefault(150),$(".firstVideoOverlayText").css("font-size","5vw");let a=init_photo(t[0],{w:500,h:500},new BABYLON.Vector3(0,0,-600),e);currStageObjMap.set(a.name,a),animateObjectScaling(a,20,frameCount,new BABYLON.Vector3(1.7,1.7,1))}else if(70===e){setCamDefault(150),$(".firstVideoOverlayText").css("font-size","4.5vw");let a=2e3,n=stageMap.get(e).imagePos;for(i=0;i<t.length;i++){let s=init_photo(t[i],{w:500,h:500},n[i],e);if(add_delay(s,a,3e3),a+=3e3,0===i){setTimeout(function(){animateObjectFadeOut(s,30,200,0)},6e3)}currStageObjMap.set(s.name,s)}}else if(71===e){setCamDefault(150),$(".firstVideoOverlayText").css("font-size","3.8vw");let a=stageMap.get(e).imagePos;for(i=0;i<t.length;i++){let n=init_photo(t[i],{w:200,h:200},a[i],e);add_delay(n,2e3,3e3),currStageObjMap.set(n.name,n)}}else if(72===e){setCamDefault(150),$(".firstVideoOverlayText").css("font-size","5vw");let a=init_photo(t[0],{w:1200,h:600},{x:0,y:0,z:-500},e);add_delay(a,2e3,3e3),currStageObjMap.set(a.name,a)}else if(72===e){setCamDefault(150),$(".firstVideoOverlayText").css("font-size","5vw");let a=init_photo(t[0],{w:1200,h:600},{x:0,y:0,z:-500},e);add_delay(a,2e3,3e3),currStageObjMap.set(a.name,a)}else if(73===e){setCamDefault(300),$("#firstVideoOverlayText").css({color:"#0ab7ea","font-size":"4.5vw"}),setup_3D_photo();let a=init_photo(t[0],{w:500,h:400},{x:-200,y:-30,z:-200},e);currStageObjMap.set(a.name,a),add_delay(a,2e3,3e3)}else if(74===e){setCamDefault(550),$("#firstVideoOverlayText").css({color:"#efad0c","font-size":"4.5vw"}),dome&&dome.dispose();let a=init_photo(t[0],{w:700,h:500},{x:0,y:0,z:-100},e);currStageObjMap.set(a.name,a),add_delay(a,2e3,3e3)}else if(75===e){setCamDefault(400),$("#firstVideoOverlayText").css("font-size","4.5vw");let a=init_photo(t[0],{w:710,h:750},{x:400,y:0,z:-500},e);currStageObjMap.set(a.name,a),add_delay(a,1e3,3e3)}else if(76===e){setCamDefault(500),$("#firstVideoOverlayText").css("font-size","4vw");let a=init_photo(t[0],{w:763,h:722},{x:400,y:-20,z:-400},e);currStageObjMap.set(a.name,a),add_delay(a,1e3,3e3)}}function set_camera_specs(e){73===e&&(storyCamera.lowerAlphaLimit=.9059762890318959,storyCamera.upperAlphaLimit=2.152565254742033,storyCamera.lowerBetaLimit=1.154381248012086,storyCamera.upperBetaLimit=2.3110118760751495,storyCamera.upperRadiusLimit=600)}function setup_3D_photo(){dome&&dome.dispose(),(dome=new BABYLON.PhotoDome("testdome","front/images3D/storyMbayeScene/flower.jpg",{resolution:64,size:1e3},scene)).rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(-130),0)}let isSoundIconClicked=!1;$(document).ready(function(){setup_music_player();var e=createChapter5Scene();let t;if(e.isLoading){let e=0;t=setInterval(function(){e<101&&(document.getElementById("loadingScreenPercent").innerHTML="Loading: "+e+" %",e++)},250)}initialize_icons(),e.executeWhenReady(function(){clearInterval(t),document.getElementById("loadingScreenPercent").innerHTML="Loading: 100%",document.getElementById("loadingScreenDiv").style.display="none",document.getElementById("loadingScreenPercent").style.display="none",$(".firstVideoOverlayText").css("display","block"),$(".dropdown-list").css("display","block"),show_3D_icons(),rotate_sky(),currentStage=62,setup_stage(62),engine.runRenderLoop(function(){e&&e.render()}),window.addEventListener("resize",function(){engine.resize(),testOrientation(),testFullscreen()})})}),$("#continueBtn").on("click",function(e){currentStage<76&&($("#continueBtnDiv").css("visibility","hidden"),$("#prevBtnDiv").css("visibility","hidden"),setup_stage(++currentStage))}),$("#prevBtn").on("click",function(e){if(--currentStage<=76&&currentStage>=62)$("#continueBtnDiv").css("visibility","hidden"),$("#prevBtnDiv").css("visibility","hidden"),setup_stage(currentStage);else if(currentStage<62){let e=4;$.ajax({type:"get",url:urlStory,data:{chapter_no:e,_token:token},success:function(t){window.location.href=urlStory+"?cNo="+e}})}});