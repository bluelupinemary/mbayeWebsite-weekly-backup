let canvas,engine,theAstroFace,storyCamera,hl,starColor,skybox,head_obj,collage_wall,DISC_CAM_INIT_POS={x:2.83,y:.44,z:580.01},cameraInitState={position:null,a:null,b:null,r:null,upperA:null,lowerA:null,upperB:null,lowerB:null,upperR:null,lowerR:null,angularY:null},astroInitState={x:0,y:0,z:0},currentStage=24,faceFlowersMap=new Map,createChapter4Scene=function(){canvas=document.getElementById("canvas"),(engine=new BABYLON.Engine(canvas,!0,{preserveDrawingBuffer:!0,stencil:!0})).enableOfflineSupport=!0,scene=new BABYLON.Scene(engine),BABYLON.Database.IDBStorageEnabled=!0;let e=new BABYLON.CubeTexture.CreateFromPrefilteredData("front/textures/environment.dds",scene);return e.gammaSpace=!1,scene.environmentTexture=e,load_3D_mesh(),skybox=create_skybox(),storyCamera=create_camera(),storyLight=create_light(),hl=new BABYLON.HighlightLayer("hl1",scene),flowerColor=new BABYLON.HighlightLayer("hl1",scene),scene};var WALL_INIT_POS=new BABYLON.Vector3(-9.12,0,-1100);function load_3D_mesh(){Promise.all([BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/headMbayeScene/","HeadMbaye0803.glb",scene).then(function(e){e.meshes[0].scaling=new BABYLON.Vector3(12,12,-12),e.meshes[0].isPickable=!0,(head_obj=e.meshes[0]).checkCollisions=!0,e.meshes[0].rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(90),0),head_obj.isVisible=!1,head_obj.setEnabled(!1),e.meshes.forEach(function(e){if("FP7"===e.name&&(e.hasVertexAlpha=!1),e.isPickable=!0,"Head"===e.name||"FP1"===e.name||"FP2"===e.name||"FP3"===e.name||"FP4"===e.name||"FP5"===e.name||"FP6"===e.name||"FP7"===e.name||"FP8"===e.name||"FP9"===e.name||"FP10"===e.name||"FP11"===e.name||"FP12"===e.name||"FP13"===e.name||"FP14"===e.name||"FP15"===e.name||"FP16"===e.name||"FP17"===e.name||"FP18"===e.name||"FP17_primitive0"===e.name||"FP17_primitive1"===e.name||"FP8_primitive0"===e.name||"FP8_primitive1"===e.name){let t=new BABYLON.PBRMaterial("pbr",scene);e.material=t,e.material.backFaceCulling=!1,t.albedoColor=new BABYLON.Color3(.5,.5,.5),t.emissiveColor=new BABYLON.Color3(0,0,0),t.metallic=1,t.metallicF0Factor=.5,t.roughness=.15,t.microSurface=1}else if("L_EYEAventurine"===e.name||"R_EYEAventurine"===e.name)e.material.albedoColor=new BABYLON.Color3(.01,.2,.07);else if("L_EYEObsidian"===e.name||"R_EYEObsidian"===e.name||"__root__"===e.name);else if("HeadCover"===e.name)e.isVisible=!1;else{let t=new BABYLON.StandardMaterial("pbr",scene);e.material.transparencyMode=0,e.visibility=0,e.material=t,faceFlowersMap.set(e.name,e)}})}),BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/storyMbayeScene/","collageWall2.glb",scene).then(function(e){e.meshes[0].scaling=new BABYLON.Vector3(.7,.4,-.5),e.meshes[1].name="collageWall",(collage_wall=e.meshes[1]).isVisible=!1,e.meshes[0].position=WALL_INIT_POS})]).then(()=>{setup_collage()})}let earth_obj,currTimer,videoDisc,worldFlowers,dome,currStageObjMap=new Map;function setup_stage(e){let t=[];if(currTimer&&clearTimeout(currTimer),remove_texts(),remove_stage_objects(),stageMap.has(e)&&(t=stageMap.get(e).imagesUsed),setTimeout(function(){create_texts(e)},100),47===e){$("#firstVideoOverlayText").css({"font-size":"3.5vw"}),load_music("fZVi07gz28w",3),setCamDefault(200),collage_wall.isVisible=!1,collage_wall.setEnabled(!1);let a=init_photo(t[0],{w:1200,h:600},{x:0,y:0,z:-500},e);currStageObjMap.set(a.name,a)}else if(48===e){setCamDefault(150),$(".firstVideoOverlayText").css("font-size","3.2vw");let a=1e3;for(i=0;i<t.length;i++){let o=stageMap.get(e).imagePos,n=init_photo(t[i],{w:200,h:200},{x:20,y:-15,z:-250},e);add_delay(n,a,3e3),currStageObjMap.set(n.name,n),animateObjectPosition(n,20,frameCount,o[i]),a+=1e3}}else if(49===e){setCamDefault(150),$(".firstVideoOverlayText").css("font-size","3.2vw");let a=1e3;for(i=0;i<t.length;i++){let o=stageMap.get(e).imagePos,n=init_photo(t[i],{w:200,h:200},o[i],e);add_delay(n,a,4e3),currStageObjMap.set(n.name,n),a+=3e3}storyCamera.detachControl(canvas,!0)}else if(50===e){setCamDefault(120),head_obj.rotation.y=BABYLON.Tools.ToRadians(90),head_obj.isVisible=!0,head_obj.setEnabled(!0),$(".firstVideoOverlayText").css("font-size","3.2vw"),animateObjectRotationNoEase(head_obj,40,frameCount,new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(270),0));let a=[];for(i=0;i<t.length;i++){let o=init_photo(t[i],{w:25,h:25},{x:0,y:0,z:0},e);o.rotation.y=BABYLON.Tools.ToRadians(180),o.visibility=0,currStageObjMap.set(o.name,o),o.setParent(head_obj),a.push(o),hl.addMesh(o,new BABYLON.Color3(0,.5,.5))}currTimer=setTimeout(function(){let t=stageMap.get(e).imagePos;for(i=0;i<a.length;i++)animateObjectFadeOut(a[i],30,200,1),animateObjectPosition(a[i],25,100,t[i])},5e3),storyCamera.attachControl(canvas,!0)}else if(51===e){setCamDefault(100),head_obj.rotation.y=BABYLON.Tools.ToRadians(90),head_obj.isVisible=!1,head_obj.setEnabled(!1),$(".firstVideoOverlayText").css({"font-size":"4.7vw",color:"#0ee6e6"}),scene.animatables.forEach(function(e){e.stop()});let a=[],o=stageMap.get(e).imageScale,n=(stageMap.get(e).startPos,stageMap.get(e).imagePos);for(i=0;i<t.length;i++){s=o[i];let r=init_photo(t[i],{w:50,h:50},{x:n[i].x,y:n[i].y-800,z:n[i].z},e);r.scaling=new BABYLON.Vector3(s.x,s.y,s.z),currStageObjMap.set(r.name,r),a.push(r),hl.addMesh(r,new BABYLON.Color3(0,.5,.5))}animateObjectPositionNoEase(a[0],40,frameCount,n[0]),animateObjectPositionNoEase(a[1],25,frameCount,n[1]),animateObjectPositionNoEase(a[2],30,frameCount,n[2]),animateObjectPositionNoEase(a[3],25,frameCount,n[3]),animateObjectPositionNoEase(a[4],35,frameCount,n[4]),storyCamera.detachControl(canvas,!0)}else if(52===e)head_obj.isVisible=!0,head_obj.setEnabled(!0),head_obj.position=BABYLON.Vector3.Zero(),head_obj.rotation.y=BABYLON.Tools.ToRadians(90),setCamDefault(200),highlightFlowers(),$("#firstVideoOverlayText").css({color:"#efad0c","font-size":"3.7vw"}),scene.animatables.forEach(function(e){e.stop()}),animateCameraToRadius(storyCamera,50,frameCount,100),isHeadRotateActive=!0,storyCamera.attachControl(canvas,!0);else if(53===e){unhighlightFlowers(),$("#firstVideoOverlayText").css({color:"#efad0c","font-size":"3.8vw"}),head_obj.isVisible=!1,head_obj.setEnabled(!1);let t=init_disc(e);currStageObjMap.set(t.name,t),setCamInferior(),animateObjectPosition(t,20,frameCount,new BABYLON.Vector3(0,500,0)),storyCamera.detachControl(canvas,!0)}else if(54===e){setCamDefault(200),$("#firstVideoOverlayText").css({color:"#efad0c","font-size":"4.3vw"}),head_obj.isVisible=!1,head_obj.setEnabled(!1);let a=init_photo(t[0],{w:1200,h:600},{x:0,y:0,z:-500},e);currStageObjMap.set(a.name,a),add_delay(a,2e3,5e3)}else if(55===e){setCamDefault(200),$("#firstVideoOverlayText").css({color:"#0ee6e6","font-size":"5vw"}),head_obj.isVisible=!1,head_obj.setEnabled(!1);let a=init_photo(t[0],{w:1200,h:600},{x:1e3,y:0,z:-500},e);currStageObjMap.set(a.name,a),animateObjectPosition(a,20,frameCount,new BABYLON.Vector3(0,0,-500)),add_delay(a,2e3,5e3)}else if(56===e){setCamDefault(200),$("#firstVideoOverlayText").css({color:"#efad0c","font-size":"4.2vw"}),head_obj.isVisible=!1,head_obj.setEnabled(!1);let a=init_photo(t[0],{w:1200,h:600},{x:1e3,y:0,z:-500},e);currStageObjMap.set(a.name,a),animateObjectPosition(a,20,frameCount,new BABYLON.Vector3(0,0,-500)),add_delay(a,2e3,5e3)}else if(57===e){setCamDefault(150),$(".firstVideoOverlayText").css("font-size","4.2vw");let a=stageMap.get(e).imagePos,o=[];for(i=0;i<t.length;i++){let n=init_photo(t[i],{w:200,h:200},a[i],e);o.push(n),hl.addMesh(n,new BABYLON.Color3(0,.5,.5)),currStageObjMap.set(n.name,n)}}else if(58===e){setCamDefault(200),$("#firstVideoOverlayText").css({color:"#0ee6e6","font-size":"4.2vw"});let a=stageMap.get(e).imagePos,o=stageMap.get(e).startPos,n=stageMap.get(e).imageScale,s=[];for(i=0;i<t.length;i++){let a=init_photo(t[i],{w:200,h:200},o[i],e);s.push(a),a.scaling=new BABYLON.Vector3(n[i].x,n[i].y,n[i].z),currStageObjMap.set(a.name,a)}for(i=0;i<s.length;i++)animateObjectPosition(s[i],30,frameCount,a[i])}else if(59===e)$("#firstVideoOverlayText").css({color:"#efad0c","font-size":"4.2vw"}),setCamDefault(500),(videoDisc=init_video("59Welding",550,e)).material.diffuseTexture.uOffset=.16,videoDisc.material.diffuseTexture.uScale=.7,currStageObjMap.set(videoDisc.name,videoDisc),hl.addMesh(videoDisc,new BABYLON.Color3(0,.5,.5));else if(60===e){if(setCamDefault(),videoDisc)try{let e=videoDisc.material.diffuseTexture.video;e.pause(),e.currentTime=0}catch(e){}$("#firstVideoOverlayText").css({color:"#efad0c","font-size":"5vw"});let t=init_disc(e);animateObjectPosition(t,50,frameCount,new BABYLON.Vector3(0,500,0)),currStageObjMap.set(t.name,t),setCamInferior()}else if(61===e){setCamDefault(200),$("#firstVideoOverlayText").css({color:"#0ee6e6","font-size":"3.5vw"});let a=[],o=stageMap.get(e).imagePos,n=stageMap.get(e).startPos,s=init_photo(t[0],{w:200,h:250},n[0],e);for(currStageObjMap.set(s.name,s),a.push(s),i=1;i<t.length;i++){let o=init_photo(t[i],{w:450,h:250},n[i],e);a.push(o),currStageObjMap.set(o.name,o)}for(i=0;i<a.length;i++)animateObjectPosition(a[i],30,frameCount,o[i])}}function highlightFlowers(){faceFlowersMap.forEach(function(e){e.material.emissiveColor=new BABYLON.Color3(0,1,0),e.visibility=1,flowerColor.addMesh(e,BABYLON.Color3.Green()),flowerColor.innerGlow=!1})}function unhighlightFlowers(){faceFlowersMap.forEach(function(e){e.visibility=0,flowerColor.removeMesh(e)})}function setup_3D_photo(){dome&&dome.dispose(),(dome=new BABYLON.PhotoDome("testdome","front/textures/storyMbaye/collage-37-1.png",{resolution:64,size:1e3},scene)).rotation=new BABYLON.Vector3(0,BABYLON.Tools.ToRadians(-130),0)}let isSoundIconClicked=!1;$(document).ready(function(){setup_music_player();var e=createChapter4Scene();let t;if(e.isLoading){let e=0;t=setInterval(function(){e<101&&(document.getElementById("loadingScreenPercent").innerHTML="Loading: "+e+" %",e++)},250)}initialize_icons(),e.executeWhenReady(function(){clearInterval(t),document.getElementById("loadingScreenPercent").innerHTML="Loading: 100%",document.getElementById("loadingScreenDiv").style.display="none",document.getElementById("loadingScreenPercent").style.display="none",$(".firstVideoOverlayText").css("display","block"),$(".dropdown-list").css("display","block"),show_3D_icons(),rotate_sky(),currentStage=47,setup_stage(47),engine.runRenderLoop(function(){e&&e.render()}),window.addEventListener("resize",function(){engine.resize(),testOrientation(),testFullscreen()})})}),$("#continueBtn").on("click",function(e){if(currentStage<61)$("#continueBtnDiv").css("visibility","hidden"),$("#prevBtnDiv").css("visibility","hidden"),setup_stage(++currentStage),check_if_in_3d_map();else{let e=5;$.ajax({type:"get",url:urlStory,data:{chapter_no:e,_token:token},success:function(t){window.location.href=urlStory+"?cNo="+e}})}}),$("#prevBtn").on("click",function(e){if(--currentStage<=61&&currentStage>=47)$("#continueBtnDiv").css("visibility","hidden"),$("#prevBtnDiv").css("visibility","hidden"),setup_stage(currentStage),check_if_in_3d_map();else if(currentStage<47){let e=3;$.ajax({type:"get",url:urlStory,data:{chapter_no:e,_token:token},success:function(t){window.location.href=urlStory+"?cNo="+e}})}});