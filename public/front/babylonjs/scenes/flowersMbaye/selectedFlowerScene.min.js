let selectedFlowerCamera,earthFlowersSkybox,earthFlowers_object,isZoomPanelActive=!0,isEarthFlowersHit=!1;const MAX_NUM_FLOWERS=5;let worldFlowerPicked,isWorldFlowersReady,worldLoadedPercent,flowerMat,objHighlight,light2,nuvola_obj,solar_obj,book_obj,bookLeftPages,bookRightPages,solar_carpet,nuvola_carpet,mermaidSpeechCloud,nuvolaSpeech1;function createSelectedFlowerScene(){selectedFlowerScene=new BABYLON.Scene(engine),engine.enableOfflineSupport=!0,selectedFlowerScene.enableSceneOffline=!0,BABYLON.Database.IDBStorageEnabled=!0,selectedFlowerScene.autoClear=!1,create_selected_flower_camera(),create_selected_flower_skybox();let e=new BABYLON.HemisphericLight("selectedFlowersLight",new BABYLON.Vector3(-.5,.2,-.9),selectedFlowerScene);return light2=new BABYLON.HemisphericLight("speechCloudLight",new BABYLON.Vector3(.83,10,.56),selectedFlowerScene),e.radius=300,light2.radius=300,e.intensity=1,light2.intensity=.9,load_earth_with_flowers_mesh(),add_mouse_listener_selected_flower(),create_orig_flower(),objHighlight=new BABYLON.HighlightLayer("objHighlight",selectedFlowerScene),selectedFlowerScene}function create_selected_flower_camera(){(selectedFlowerCamera=new BABYLON.ArcRotateCamera("selectedFlowerCamera",BABYLON.Tools.ToRadians(0),BABYLON.Tools.ToRadians(0),30,new BABYLON.Vector3(-160.247,78.31,86.79),selectedFlowerScene)).checkCollisions=!0,selectedFlowerCamera.panningSensibility=500,selectedFlowerCamera.fovMode=BABYLON.Camera.FOVMODE_HORIZONTAL_FIXED,selectedFlowerCamera.fov=1.4,selectedFlowerCamera.maxZ=21e3,selectedFlowerCamera.lowerRadiusLimit=35,selectedFlowerCamera.upperRadiusLimit=400,selectedFlowerCamera.wheelPrecision=10,selectedFlowerCamera.angularSensibilityX=2e3,selectedFlowerCamera.angularSensibilityY=2e3,selectedFlowerCamera.alpha=2.44,selectedFlowerCamera.beta=1.15}function reset_selected_flower_camera(){selectedFlowerCamera.position=new BABYLON.Vector3(-164.375,75.92,80.21),selectedFlowerCamera.alpha=2.48,selectedFlowerCamera.beta=1.17,selectedFlowerCamera.radius=200,selectedFlowerCamera.target=new BABYLON.Vector3(-18.22,-1.59,-32.2)}let theMatl,grownCarpetMatl,locatedCarpetMatl,chosenFlower,flower3D_nuvola=[];function load_earth_with_flowers_mesh(){Promise.all([BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/flowersMbayeScene/","nuvolaCarpet.glb",selectedFlowerScene).then(function(e){(nuvola_obj=e.meshes[0]).isPickable=!0,nuvola_obj.scaling=new BABYLON.Vector3(.07,.07,.07),e.meshes[4].name="nuvola",nuvola_carpet=e.meshes[9],e.meshes[10].name="pinkBottom",flower3D_nuvola.push(e.meshes[12]),flower3D_nuvola.push(e.meshes[11]),flower3D_nuvola.push(e.meshes[13]),e.meshes[12].isVisible=!1,e.meshes[11].isVisible=!1,e.meshes[13].isVisible=!1,nuvola_carpet_bot=e.meshes[10],nuvola_bot_matl=e.meshes[10].material,nuvola_obj.position=new BABYLON.Vector3(-54.38,26.42,-78.922),nuvola_obj.rotationQuaternion=new BABYLON.Quaternion(-.0023,.7212,-.0022,.6925),light2.includedOnlyMeshes.push(e.meshes[12]),light2.includedOnlyMeshes.push(e.meshes[11]),light2.includedOnlyMeshes.push(e.meshes[13]),add_obj_action_mgr(e.meshes[4]),add_obj_action_mgr(e.meshes[12]),add_obj_action_mgr(e.meshes[11]),add_obj_action_mgr(e.meshes[13]),add_obj_action_mgr(e.meshes[10])}),BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/flowersMbayeScene/","solarCarpet.glb",selectedFlowerScene).then(function(e){(solar_obj=e.meshes[0]).isPickable=!0,solar_obj.scaling=new BABYLON.Vector3(.07,.07,.07),solar_carpet=e.meshes[1],e.meshes[9].name="blueBottom",solar_bot_matl=e.meshes[9].material,solar_carpet_bot=e.meshes[9],e.meshes[3].name="solarLamp",solar_obj.position=new BABYLON.Vector3(26.44,9.25,19.39),solar_obj.rotationQuaternion=new BABYLON.Quaternion(4e-4,.0272,.0332,-.998),add_obj_action_mgr(e.meshes[3]),add_obj_action_mgr(e.meshes[9])}),BABYLON.SceneLoader.ImportMeshAsync(null,"front/objects/flowersMbayeScene/","bookFlowersCarpet.glb",selectedFlowerScene).then(function(e){e.meshes.forEach(function(e){"wood001_primitive1"===e.name?e.isPickable=!1:"Object072"===e.name?bookLabel=e:"leftTop"===e.name?(bookLeftPages=e,light2.includedOnlyMeshes.push(bookLeftPages)):"rightTop"===e.name?(bookRightPages=e,light2.includedOnlyMeshes.push(bookRightPages)):"wood001_primitive0"!==e.name&&"Home"!==e.name&&"MbayeFeet"!==e.name&&"MbayeHead"!==e.name&&"DesignAPanel"!==e.name||(bookPartsMap.set(e.name,null),add_obj_action_mgr(e),"MbayeHead"===e.name&&(e.renderingGroupId=1))}),bookTask=e,e.animationGroups[0].loopAnimation=!1,e.animationGroups[0].stop(),e.meshes[0].scaling=new BABYLON.Vector3(.07,.07,-.07),e.meshes[0].position=new BABYLON.Vector3(-82.56,24.73,25.66),e.meshes[0].rotationQuaternion=new BABYLON.Quaternion(.0421,.8852,-.1091,.4498),book_obj=e.meshes[0]})]).then(()=>{selectedFlowerCamera.setTarget(new BABYLON.Vector3(0,0,0)),set_scene_active_meshes(selectedFlowerScene,!1),nuvolaSpeech1=create_mesh("nuvolaSpeech1","front/images3D/flowersScene/nuvolaFlower1.png",50,70,.8,{x:-35.98,y:52.42,z:-177.76},{x:-.0366,y:-.9784,z:.0284,w:-.1985},selectedFlowerScene),nuvolaSpeech2=create_mesh("nuvolaSpeech1","front/images3D/flowersScene/nuvolaFlower2.png",50,70,.8,{x:-35.98,y:52.42,z:-177.76},{x:-.0366,y:-.9784,z:.0284,w:-.1985},selectedFlowerScene),nuvolaSpeech1.material.emissiveColor=new BABYLON.Color3(1,1,1),nuvolaSpeech2.material.emissiveColor=new BABYLON.Color3(1,1,1),nuvolaSpeech1.isVisible=!1,nuvolaSpeech2.isVisible=!1})}function enable_gizmo2(e){designUtilLayer=new BABYLON.UtilityLayerRenderer(selectedFlowerScene),designUtilLayer.utilityLayerScene.autoClearDepthAndStencil=!1,homeGizmo=new BABYLON.RotationGizmo(designUtilLayer),homeGizmo.attachedMesh=e,homeGizmo.scaleRatio=1,homeGizmo2=new BABYLON.PositionGizmo(designUtilLayer),homeGizmo2.attachedMesh=e,homeGizmo2.scaleRatio=2,homeGizmo.onDragStartObservable.add(()=>{}),homeGizmo2.onDragStartObservable.add(()=>{})}function create_selected_flower_skybox(){var e=BABYLON.MeshBuilder.CreateBox("skybox",{size:8300},selectedFlowerScene);e.position.y=-500,e.position.z=1e3,e.rotation.y=BABYLON.Tools.ToRadians(-60),e.checkCollisions=!0;var o=new BABYLON.StandardMaterial("skybox",selectedFlowerScene);o.backFaceCulling=!1;o.reflectionTexture=new BABYLON.CubeTexture.CreateFromImages(["front/finalSkybox/px.png","front/finalSkybox/py.png","front/finalSkybox/pz.png","front/finalSkybox/nx.png","front/finalSkybox/ny.png","front/finalSkybox/nz.png"],selectedFlowerScene),o.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,o.disableLighting=!0,o.specular=new BABYLON.Vector3(0,0,0),e.material=o,o.freeze(),e.freezeWorldMatrix()}function open_book_of_flowers(e){set_orig_flower(e),set_flower_field(e),set_flower_label(e),bookTask.animationGroups[0].play()}function set_flower_label(e){let o=new BABYLON.StandardMaterial("labelMatl",selectedFlowerScene);o.diffuseTexture=new BABYLON.Texture("front/images3D/flowers2D/label/"+e+".png",selectedFlowerScene),o.diffuseTexture.hasAlpha=!0,o.diffuseTexture.uScale=3.4,o.diffuseTexture.vScale=-9.2,o.diffuseTexture.uOffset=.77,o.diffuseTexture.vOffset=-1.15,o.specularColor=new BABYLON.Color3(0,0,0),o.backFaceCulling=!1,bookLabel.material=o}function set_carpet_countries(e){(grownCarpetMatl=new BABYLON.StandardMaterial("grownInCarpet",selectedFlowerScene)).diffuseTexture=new BABYLON.Texture("front/textures/flowersMbaye/grown/"+e+".png",selectedFlowerScene),grownCarpetMatl.diffuseTexture.hasAlpha=!0,grownCarpetMatl.diffuseTexture.vScale=-1,grownCarpetMatl.diffuseTexture.uScale=-1,grownCarpetMatl.specularColor=new BABYLON.Color3(0,0,0),(locatedCarpetMatl=new BABYLON.StandardMaterial("locatedInCarpet",selectedFlowerScene)).diffuseTexture=new BABYLON.Texture("front/textures/flowersMbaye/located/"+e+".png",selectedFlowerScene),locatedCarpetMatl.diffuseTexture.hasAlpha=!0,locatedCarpetMatl.diffuseTexture.vScale=-1,locatedCarpetMatl.diffuseTexture.uScale=-1,locatedCarpetMatl.specularColor=new BABYLON.Color3(0,0,0),solar_carpet.material=grownCarpetMatl,nuvola_carpet.material=locatedCarpetMatl}function set_carpet_bot(e){if(1===e){let e=new BABYLON.StandardMaterial("solarCarpetBot",selectedFlowerScene);e.diffuseTexture=new BABYLON.Texture("front/textures/flowersMbaye/solarBottomText.png",selectedFlowerScene),e.diffuseTexture.hasAlpha=!0,e.diffuseTexture.vScale=1,e.diffuseTexture.uScale=-1,e.specularColor=new BABYLON.Color3(0,0,0),solar_carpet_bot.material=e}else if(2===e){let e=new BABYLON.StandardMaterial("solarCarpetBot",selectedFlowerScene);e.diffuseTexture=new BABYLON.Texture("front/textures/flowersMbaye/nuvolaBottomText.png",selectedFlowerScene),e.diffuseTexture.hasAlpha=!0,e.diffuseTexture.vScale=1,e.diffuseTexture.uScale=-1,e.specularColor=new BABYLON.Color3(0,0,0),nuvola_carpet_bot.material=e}else solar_carpet_bot.material=solar_bot_matl,nuvola_carpet_bot.material=nuvola_bot_matl}function create_orig_flower(){let e=BABYLON.Mesh.CreatePlane("origFlower",10,selectedFlowerScene);e.position=new BABYLON.Vector3(-115.44,38.96,49.62),e.rotationQuaternion=new BABYLON.Quaternion(-.1399,-.4303,-.1012,.8853),e.isPickable=!0,e.setParent(bookLeftPages),e.isVisible=!1,e.setEnabled(!1),chosenFlower=e,light2.includedOnlyMeshes.push(e)}function remove_book_materials(){for(bookLeftPages.material&&(bookTask.animationGroups[0].reset(),bookLeftPages.material.dispose(),chosenFlower.material.dispose(),chosenFlower.isVisible=!1,chosenFlower.setEnabled(!1)),i=0;i<flower3D_nuvola.length;i++)flower3D_nuvola[i].isVisible=!1}function set_orig_flower(e){let o=new BABYLON.StandardMaterial(e,selectedFlowerScene);o.diffuseTexture=new BABYLON.Texture("front/images3D/flowers2D/orig/"+e+".png",selectedFlowerScene),o.diffuseTexture.hasAlpha=!0,o.specularColor=new BABYLON.Color3(0,0,0),o.backFaceCulling=!1,o.diffuseTexture.uScale=-1,chosenFlower.material=o,chosenFlower.scaling=new BABYLON.Vector3(.01,.01,.01),chosenFlower.name=e,chosenFlower.isVisible=!0,chosenFlower.setEnabled(!0);var t=new BABYLON.Animation("starAnimation","scaling",30,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),a=chosenFlower.scaling.add(new BABYLON.Vector3(.8,.8,.8)),r=[];r.push({frame:0,value:chosenFlower.scaling}),r.push({frame:20,value:chosenFlower.scaling}),r.push({frame:60,value:a}),t.setKeys(r),chosenFlower.animations.push(t),selectedFlowerScene.beginAnimation(chosenFlower,0,60,!0),chosenFlower.isVisible=!0,chosenFlower.setEnabled(!0)}let flowers3D=[];function create_3D_flower(e){if(flowers3DMap.has(e)){let o=flowers3DMap.get(e);for(i=0;i<o.length;i++){let e=BABYLON.Mesh.CreatePlane(o[i],13,selectedFlowerScene);e.isPickable=!0;let t=new BABYLON.StandardMaterial(o[i]+"matl",selectedFlowerScene);t.diffuseTexture=new BABYLON.Texture("front/images3D/flowers2D/3D/"+o[i]+".png",selectedFlowerScene),t.diffuseTexture.hasAlpha=!0,t.specularColor=new BABYLON.Color3(0,0,0),t.backFaceCulling=!1,e.material=t,light2.includedOnlyMeshes.push(e),0==i?(e.position=new BABYLON.Vector3(-73.34,27.6,-50.2),e.rotationQuaternion=new BABYLON.Quaternion(.1279,.6883,-.7027,.1249)):1==i?(e.position=new BABYLON.Vector3(-77.82,28.5,-38.95),e.rotationQuaternion=new BABYLON.Quaternion(.1967,.7024,-.6541,.1989)):2==i&&(e.position=new BABYLON.Vector3(-58.14,27.8,-38.41),e.rotationQuaternion=new BABYLON.Quaternion(.0486,.7075,-.703,.0457)),animate_3D_flower(e,i),flowers3D.push(e)}}}function set_3D_flower(e){let o=flowers3DMap.get(e);if(o)for(i=0;i<o.length;i++)if(i<3){let e=new BABYLON.StandardMaterial(o[i]+"matl",selectedFlowerScene);e.diffuseTexture=new BABYLON.Texture("front/images3D/flowers2D/3D/"+o[i]+".png",selectedFlowerScene),0===i?(e.diffuseTexture.uScale=-6.14,e.diffuseTexture.vScale=-8.15,e.diffuseTexture.uOffset=1.74,e.diffuseTexture.vOffset=.28):1===i?(e.diffuseTexture.uScale=-6.2,e.diffuseTexture.vScale=-8,e.diffuseTexture.uOffset=-.42,e.diffuseTexture.vOffset=-.42):2===i&&(e.diffuseTexture.uScale=-5.5,e.diffuseTexture.vScale=-8.78,e.diffuseTexture.uOffset=.28,e.diffuseTexture.vOffset=-.07),e.diffuseTexture.hasAlpha=!0,e.specularColor=new BABYLON.Color3(0,0,0),e.backFaceCulling=!1,flower3D_nuvola[i].material=e,flower3D_nuvola[i].name=o[i],flower3D_nuvola[i].isVisible=!0}}function delete_3D_flowers(){for(i=0;i<flowers3D.length;i++)flowers3D[i].dispose()}function animate_3D_flower(e,o){let t=30,a=70,r=e.position.add(new BABYLON.Vector3(0,3,0));0==o?t=35:1==o&&(t=20,a=70,r=e.position.add(new BABYLON.Vector3(0,2,0)));var l=new BABYLON.Animation("starAnimation","position",30,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),n=[];n.push({frame:0,value:e.position}),n.push({frame:t,value:r}),n.push({frame:a,value:e.position}),l.setKeys(n),e.animations.push(l),selectedFlowerScene.beginAnimation(e,0,a,!0)}function is_3d_flower(e){if(flowers3DMap.has(chosenFlower.name)){let o=flowers3DMap.get(chosenFlower.name);for(o.length>3?$(".modelArrow").css("display","block"):$(".modelArrow").css("display","none"),i=0;i<o.length;i++)if(e===o[i])return!0}return!1}function set_flower_field(e){let o=new BABYLON.StandardMaterial("flowerFieldMatl",selectedFlowerScene);o.diffuseTexture=new BABYLON.Texture("front/images3D/flowers2D/field/"+e+".png",selectedFlowerScene),o.specularColor=new BABYLON.Color3(0,0,0),o.backFaceCulling=!1,bookLeftPages.material=o,bookRightPages.material=o}let isVideoEnabled=!1,currNuvolaText=1;function add_mouse_listener_selected_flower(){var e=function(e){if(0===e.button){var o=selectedFlowerScene.pick(selectedFlowerScene.pointerX,selectedFlowerScene.pointerY);if(o.hit&&0===e.button){var t=o.pickedMesh;showSelectedFlowerScene&&("solarLamp"===t.name?(isVideoEnabled&&($("#musicVideoDiv").hide(),isVideoEnabled=!1),$("#flowersWikipediaDiv").hide(),$("#flowerModelDiv").hide(),set_instructions_overlay(2),currScene="flowersScene",isFlowerClicked=!1,flowersCamera.attachControl(canvas,!0),selectedFlowerCamera.detachControl(canvas),remove_book_materials(),stop_flower_music(),delete_3D_flowers(),showSelectedFlowerScene=!1,isShowFlowerScene=!0,set_scene_active_meshes(selectedFlowerScene,!1),set_scene_active_meshes(flowersScene,!0),$("#wikipediaIcon").hide()):"wood001_primitive0"===t.name?isVideoEnabled?($("#musicVideoDiv").hide(),isVideoEnabled=!1):(isVideoEnabled=!0,$("#musicVideoDiv").css("display","flex")):"Home"===t.name?(e.preventDefault(),show_alert_box("Are you sure you want to go to the HOME page?","/")):"DesignAPanel"===t.name?(e.preventDefault(),show_alert_box("Are you sure you want to Design A Panel now?","/designPanel")):"MbayeFeet"===t.name?(e.preventDefault(),show_alert_box("Are you sure you want to view Mbaye's Feet now?","/feetMbaye")):"MbayeHead"===t.name&&(e.preventDefault(),show_alert_box("Are you sure you want to view Mbaye's Head now?","/headMbaye")),is_3d_flower(t.name)&&showFlowerModelDiv(t.name),"blueBottom"===t.name?showPage2("https://en.wikipedia.org/wiki/Persian_carpet"):"pinkBottom"===t.name&&showPage2("https://en.wikipedia.org/wiki/Oriental_rug"))}}},o=function(){isEarthFlowersHit=!1},t=function(e){};canvas.addEventListener("pointerdown",e,!1),canvas.addEventListener("pointerup",o,!1),canvas.addEventListener("pointermove",t,!1),selectedFlowerScene.onDispose=function(){canvas.removeEventListener("pointerdown",e),canvas.removeEventListener("pointerup",o),canvas.removeEventListener("pointermove",t)}}function add_obj_action_mgr(e){e.actionManager=new BABYLON.ActionManager(flowersScene),e.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOverTrigger,onOverPart)),e.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOutTrigger,onOutPart))}var onOverPart=e=>{if(showSelectedFlowerScene){let t=document.createElement("span");t.setAttribute("id","partTooltip");var o=t.style;o.position="absolute",o.color="#00BFFF",o.fontFamily="Courgette-Regular",o.fontSize="2rem",o.textShadow="1px 1px 3px black",o.fontSize="2rem",o.top=selectedFlowerScene.pointerY+"px",o.left=selectedFlowerScene.pointerX+20+"px",o.cursor="pointer",o.pointerEvents="none","solarLamp"===e.source.name?(document.body.appendChild(t),t.textContent="Pick another flower",e.source.material.emissiveColor=new BABYLON.Color3(.07,.04,0)):"nuvola"===e.source.name?1==currNuvolaText?(nuvolaSpeech2.isVisible=!1,nuvolaSpeech2.setEnabled(!1),nuvolaSpeech1.isVisible=!0,nuvolaSpeech1.setEnabled(!0),currNuvolaText=0):(nuvolaSpeech2.isVisible=!0,nuvolaSpeech2.setEnabled(!0),currNuvolaText=1):is_3d_flower(e.source.name)?(e.source.material.specularColor=new BABYLON.Color3(0,.6,0),document.body.appendChild(t),t.textContent="View Flower"):bookPartsMap.has(e.source.name)?e.source.material.emissiveColor=new BABYLON.Color3(0,.09,0):"blueBottom"===e.source.name?set_carpet_bot(1):"pinkBottom"===e.source.name&&set_carpet_bot(2)}},onOutPart=e=>{for(is_3d_flower(e.source.name)&&(e.source.material.specularColor=new BABYLON.Color3(0,0,0)),e.source.material.emissiveColor=new BABYLON.Color3(0,0,0);document.getElementById("partTooltip");)document.getElementById("partTooltip").parentNode.removeChild(document.getElementById("partTooltip"));showSelectedFlowerScene&&("nuvola"===e.source.name?(nuvolaSpeech1.isVisible=!1,nuvolaSpeech1.setEnabled(!1),nuvolaSpeech2.isVisible=!1,nuvolaSpeech2.setEnabled(!1)):"blueBottom"!==e.source.name&&"pinkBottom"!==e.source.name||set_carpet_bot(0))};function show_alert_box(e,o){Swal.fire({title:e,imageUrl:"../../front/icons/alert-icon.png",imageWidth:"10vw",imageHeight:"auto",imageAlt:"Warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, I'm sure!",allowOutsideClick:!1,width:"20%",padding:"1rem",background:"rgba(8, 64, 147, 0.62)"}).then(e=>{e.value&&(window.location.href=o)})}